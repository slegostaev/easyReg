function dtmlXMLLoaderObject(e,t,s,i){return this.xmlDoc="",this.async="undefined"!=typeof s?s:!0,this.onloadAction=e||null,this.mainObject=t||null,this.waitCall=null,this.rSeed=i||!1,this}function callerFunction(e,t){return this.handler=function(s){return s||(s=window.event),e(s,t),!0},this.handler}function getAbsoluteLeft(e){return getOffset(e).left}function getAbsoluteTop(e){return getOffset(e).top}function getOffsetSum(e){for(var t=0,s=0;e;)t+=parseInt(e.offsetTop),s+=parseInt(e.offsetLeft),e=e.offsetParent;return{top:t,left:s}}function getOffsetRect(e){var t=e.getBoundingClientRect(),s=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||s.scrollTop,n=window.pageXOffset||i.scrollLeft||s.scrollLeft,a=i.clientTop||s.clientTop||0,d=i.clientLeft||s.clientLeft||0,o=t.top+r-a,l=t.left+n-d;return{top:Math.round(o),left:Math.round(l)}}function getOffset(e){return e.getBoundingClientRect?getOffsetRect(e):getOffsetSum(e)}function convertStringToBoolean(e){switch("string"==typeof e&&(e=e.toLowerCase()),e){case"1":case"true":case"yes":case"y":case 1:case!0:return!0;default:return!1}}function getUrlSymbol(e){return-1!=e.indexOf("?")?"&":"?"}function dhtmlDragAndDropObject(){return window.dhtmlDragAndDrop?window.dhtmlDragAndDrop:(this.lastLanding=0,this.dragNode=0,this.dragStartNode=0,this.dragStartObject=0,this.tempDOMU=null,this.tempDOMM=null,this.waitDrag=0,window.dhtmlDragAndDrop=this,this)}function _dhtmlxError(){return this.catches||(this.catches=new Array),this}function dhtmlXHeir(e,t){for(var s in t)"function"==typeof t[s]&&(e[s]=t[s]);return e}function dhtmlxEvent(e,t,s){e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent&&e.attachEvent("on"+t,s)}function dataProcessor(e){return this.serverProcessor=e,this.action_param="!nativeeditor_status",this.object=null,this.updatedRows=[],this.autoUpdate=!0,this.updateMode="cell",this._tMode="GET",this.post_delim="_",this._waitMode=0,this._in_progress={},this._invalid={},this.mandatoryFields=[],this.messages=[],this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",error:"color:red;",clear:"font-weight:normal;text-decoration:none;"},this.enableUTFencoding(!0),dhtmlxEventable(this),this}function dhtmlXComboFromSelect(e,t){"string"==typeof e&&(e=document.getElementById(e)),t=t||e.getAttribute("width")||(window.getComputedStyle?window.getComputedStyle(e,null).width:e.currentStyle?e.currentStyle.width:0),t&&"auto"!=t||(t=e.offsetWidth||100);var s=document.createElement("SPAN");e.parentNode.insertBefore(s,e),e.style.display="none";for(var i=e.getAttribute("opt_type"),r=new dhtmlXCombo(s,e.name,t,i,e.tabIndex),n=[],a=-1,d=0;d<e.options.length;d++){e.options[d].selected&&(a=d);var o=e.options[d].innerHTML,l=e.options[d].getAttribute("value");("undefined"==typeof l||null===l)&&(l=o),n[d]={value:l,text:o,img_src:e.options[d].getAttribute("img_src")}}return n.length&&r.addOption(n),e.parentNode.removeChild(e),a>=0&&r.selectOption(a,null,!0),e.onchange&&r.attachEvent("onChange",e.onchange),"rtl"==e.style.direction&&r.setRTL&&r.setRTL(!0),r}function dhtmlXCombo(e,t,s,i,r){return"string"==typeof e&&(e=document.getElementById(e)),this.dhx_Event(),this.optionType=i!=window.undefined&&dhtmlXCombo_optionTypes[i]?i:"default",this._optionObject=dhtmlXCombo_optionTypes[this.optionType],this._disabled=!1,window.dhx_glbSelectAr||(window.dhx_glbSelectAr=[],window.dhx_openedSelect=null,window.dhx_SelectId=1,dhtmlxEvent(document.body,"click",this.closeAll),dhtmlxEvent(document.body,"keydown",function(e){try{9==(e||event).keyCode&&window.dhx_glbSelectAr[0].closeAll()}catch(t){}return!0})),"SELECT"==e.tagName?dhtmlXComboFromSelect(e):(this._createSelf(e,t,s,r),void dhx_glbSelectAr.push(this))}function dhtmlXRange(e,t,s){var i="object"==typeof e?e:document.getElementById(e);try{i.focus()}catch(r){}var n=i.value.length;if(t--,(0>t||t>s||t>n)&&(t=0),s>n&&(s=n),t!=s)if(i.setSelectionRange)i.setSelectionRange(t,s);else if(i.createTextRange){var a=i.createTextRange();a.moveStart("character",t),a.moveEnd("character",s-n);try{a.select()}catch(d){}}}window.dhtmlx||(dhtmlx=function(e){for(var t in e)dhtmlx[t]=e[t];return dhtmlx}),dhtmlx.extend_api=function(e,t,s){var i=window[e];i&&(window[e]=function(e){if(e&&"object"==typeof e&&!e.tagName){var s=i.apply(this,t._init?t._init(e):arguments);for(var r in dhtmlx)t[r]&&this[t[r]](dhtmlx[r]);for(var r in e)t[r]?this[t[r]](e[r]):0==r.indexOf("on")&&this.attachEvent(r,e[r])}else var s=i.apply(this,arguments);return t._patch&&t._patch(this),s||this},window[e].prototype=i.prototype,s&&dhtmlXHeir(window[e].prototype,s))},dhtmlxAjax={get:function(e,t){var s=new dtmlXMLLoaderObject(!0);return s.async=arguments.length<3,s.waitCall=t,s.loadXML(e),s},post:function(e,t,s){var i=new dtmlXMLLoaderObject(!0);return i.async=arguments.length<4,i.waitCall=s,i.loadXML(e,!0,t),i},getSync:function(e){return this.get(e,null,!0)},postSync:function(e,t){return this.post(e,t,null,!0)}},dtmlXMLLoaderObject.count=0,dtmlXMLLoaderObject.prototype.waitLoadFunction=function(e){var t=!0;return this.check=function(){if(e&&null!=e.onloadAction&&(!e.xmlDoc.readyState||4==e.xmlDoc.readyState)){if(!t)return;t=!1,dtmlXMLLoaderObject.count++,"function"==typeof e.onloadAction&&e.onloadAction(e.mainObject,null,null,null,e),e.waitCall&&(e.waitCall.call(this,e),e.waitCall=null)}},this.check},dtmlXMLLoaderObject.prototype.getXMLTopNode=function(e,t){if(this.xmlDoc.responseXML){var s=this.xmlDoc.responseXML.getElementsByTagName(e);if(0==s.length&&-1!=e.indexOf(":"))var s=this.xmlDoc.responseXML.getElementsByTagName(e.split(":")[1]);var i=s[0]}else var i=this.xmlDoc.documentElement;if(i)return this._retry=!1,i;if(!this._retry){this._retry=!0;var t=this.xmlDoc;return this.loadXMLString(this.xmlDoc.responseText.replace(/^[\s]+/,""),!0),this.getXMLTopNode(e,t)}return dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),document.createElement("DIV")},dtmlXMLLoaderObject.prototype.loadXMLString=function(e,t){if(_isIE)this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async=this.async,this.xmlDoc.onreadystatechange=function(){},this.xmlDoc.loadXML(e);else{var s=new DOMParser;this.xmlDoc=s.parseFromString(e,"text/xml")}t||(this.onloadAction&&this.onloadAction(this.mainObject,null,null,null,this),this.waitCall&&(this.waitCall(),this.waitCall=null))},dtmlXMLLoaderObject.prototype.loadXML=function(e,t,s,i){this.rSeed&&(e+=(-1!=e.indexOf("?")?"&":"?")+"a_dhx_rSeed="+(new Date).valueOf()),this.filePath=e,this.xmlDoc=!_isIE&&window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),this.async&&(this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this)),this.xmlDoc.open(t?"POST":"GET",e,this.async),i?(this.xmlDoc.setRequestHeader("User-Agent","dhtmlxRPC v0.1 ("+navigator.userAgent+")"),this.xmlDoc.setRequestHeader("Content-type","text/xml")):t&&this.xmlDoc.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.xmlDoc.send(null||s),this.async||new this.waitLoadFunction(this)()},dtmlXMLLoaderObject.prototype.destructor=function(){return this._filterXPath=null,this._getAllNamedChilds=null,this._retry=null,this.async=null,this.rSeed=null,this.filePath=null,this.onloadAction=null,this.mainObject=null,this.xmlDoc=null,this.doXPath=null,this.doXPathOpera=null,this.doXSLTransToObject=null,this.doXSLTransToString=null,this.loadXML=null,this.loadXMLString=null,this.doSerialization=null,this.xmlNodeToJSON=null,this.getXMLTopNode=null,this.setXSLParamValue=null,null},dtmlXMLLoaderObject.prototype.xmlNodeToJSON=function(e){for(var t={},s=0;s<e.attributes.length;s++)t[e.attributes[s].name]=e.attributes[s].value;t._tagvalue=e.firstChild?e.firstChild.nodeValue:"";for(var s=0;s<e.childNodes.length;s++){var i=e.childNodes[s].tagName;i&&(t[i]||(t[i]=[]),t[i].push(this.xmlNodeToJSON(e.childNodes[s])))}return t},dhtmlDragAndDropObject.prototype.removeDraggableItem=function(e){e.onmousedown=null,e.dragStarter=null,e.dragLanding=null},dhtmlDragAndDropObject.prototype.addDraggableItem=function(e,t){e.onmousedown=this.preCreateDragCopy,e.dragStarter=t,this.addDragLanding(e,t)},dhtmlDragAndDropObject.prototype.addDragLanding=function(e,t){e.dragLanding=t},dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(e){return!e&&!window.event||2!=(e||event).button?window.dhtmlDragAndDrop.waitDrag?(window.dhtmlDragAndDrop.waitDrag=0,document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU,document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM,!1):(window.dhtmlDragAndDrop.dragNode&&window.dhtmlDragAndDrop.stopDrag(e),window.dhtmlDragAndDrop.waitDrag=1,window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup,window.dhtmlDragAndDrop.tempDOMM=document.body.onmousemove,window.dhtmlDragAndDrop.dragStartNode=this,window.dhtmlDragAndDrop.dragStartObject=this.dragStarter,document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy,document.body.onmousemove=window.dhtmlDragAndDrop.callDrag,window.dhtmlDragAndDrop.downtime=(new Date).valueOf(),e&&e.preventDefault?(e.preventDefault(),!1):!1):void 0},dhtmlDragAndDropObject.prototype.callDrag=function(e){if(e||(e=window.event),dragger=window.dhtmlDragAndDrop,!((new Date).valueOf()-dragger.downtime<100)){if(!dragger.dragNode){if(!dragger.waitDrag)return dragger.stopDrag(e,!0);if(dragger.dragNode=dragger.dragStartObject._createDragNode(dragger.dragStartNode,e),!dragger.dragNode)return dragger.stopDrag();dragger.dragNode.onselectstart=function(){return!1},dragger.gldragNode=dragger.dragNode,document.body.appendChild(dragger.dragNode),document.body.onmouseup=dragger.stopDrag,dragger.waitDrag=0,dragger.dragNode.pWindow=window,dragger.initFrameRoute()}if(dragger.dragNode.parentNode!=window.document.body&&dragger.gldragNode){var t=dragger.gldragNode;dragger.gldragNode.old&&(t=dragger.gldragNode.old),t.parentNode.removeChild(t);var s=dragger.dragNode.pWindow;if(t.pWindow&&t.pWindow.dhtmlDragAndDrop.lastLanding&&t.pWindow.dhtmlDragAndDrop.lastLanding.dragLanding._dragOut(t.pWindow.dhtmlDragAndDrop.lastLanding),_isIE){var i=document.createElement("Div");i.innerHTML=dragger.dragNode.outerHTML,dragger.dragNode=i.childNodes[0]}else dragger.dragNode=dragger.dragNode.cloneNode(!0);dragger.dragNode.pWindow=window,dragger.gldragNode.old=dragger.dragNode,document.body.appendChild(dragger.dragNode),s.dhtmlDragAndDrop.dragNode=dragger.dragNode}if(dragger.dragNode.style.left=e.clientX+15+(dragger.fx?-1*dragger.fx:0)+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px",dragger.dragNode.style.top=e.clientY+3+(dragger.fy?-1*dragger.fy:0)+(document.body.scrollTop||document.documentElement.scrollTop)+"px",e.srcElement)r=e.srcElement;else var r=e.target;dragger.checkLanding(r,e)}},dhtmlDragAndDropObject.prototype.calculateFramePosition=function(e){if(window.name){for(var t=parent.frames[window.name].frameElement.offsetParent,s=0,i=0;t;)s+=t.offsetLeft,i+=t.offsetTop,t=t.offsetParent;if(parent.dhtmlDragAndDrop){var r=parent.dhtmlDragAndDrop.calculateFramePosition(1);s+=1*r.split("_")[0],i+=1*r.split("_")[1]}if(e)return s+"_"+i;this.fx=s,this.fy=i}return"0_0"},dhtmlDragAndDropObject.prototype.checkLanding=function(e,t){e&&e.dragLanding?(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding),this.lastLanding=e,this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,t.clientX,t.clientY,t),this.lastLanding_scr=_isIE?t.srcElement:t.target):e&&"BODY"!=e.tagName?this.checkLanding(e.parentNode,t):(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding,t.clientX,t.clientY,t),this.lastLanding=0,this._onNotFound&&this._onNotFound())},dhtmlDragAndDropObject.prototype.stopDrag=function(e,t){if(dragger=window.dhtmlDragAndDrop,!t){dragger.stopFrameRoute();var s=dragger.lastLanding;dragger.lastLanding=null,s&&s.dragLanding._drag(dragger.dragStartNode,dragger.dragStartObject,s,_isIE?event.srcElement:e.target)}dragger.lastLanding=null,dragger.dragNode&&dragger.dragNode.parentNode==document.body&&dragger.dragNode.parentNode.removeChild(dragger.dragNode),dragger.dragNode=0,dragger.gldragNode=0,dragger.fx=0,dragger.fy=0,dragger.dragStartNode=0,dragger.dragStartObject=0,document.body.onmouseup=dragger.tempDOMU,document.body.onmousemove=dragger.tempDOMM,dragger.tempDOMU=null,dragger.tempDOMM=null,dragger.waitDrag=0},dhtmlDragAndDropObject.prototype.stopFrameRoute=function(e){e&&window.dhtmlDragAndDrop.stopDrag(1,1);for(var t=0;t<window.frames.length;t++)try{window.frames[t]!=e&&window.frames[t].dhtmlDragAndDrop&&window.frames[t].dhtmlDragAndDrop.stopFrameRoute(window)}catch(s){}try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=e&&parent.dhtmlDragAndDrop.stopFrameRoute(window)}catch(s){}},dhtmlDragAndDropObject.prototype.initFrameRoute=function(e,t){e&&(window.dhtmlDragAndDrop.preCreateDragCopy(),window.dhtmlDragAndDrop.dragStartNode=e.dhtmlDragAndDrop.dragStartNode,window.dhtmlDragAndDrop.dragStartObject=e.dhtmlDragAndDrop.dragStartObject,window.dhtmlDragAndDrop.dragNode=e.dhtmlDragAndDrop.dragNode,window.dhtmlDragAndDrop.gldragNode=e.dhtmlDragAndDrop.dragNode,window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag,window.waitDrag=0,!_isIE&&t&&(!_isFF||1.8>_FFrv)&&window.dhtmlDragAndDrop.calculateFramePosition());try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=e&&parent.dhtmlDragAndDrop.initFrameRoute(window)}catch(s){}for(var i=0;i<window.frames.length;i++)try{window.frames[i]!=e&&window.frames[i].dhtmlDragAndDrop&&window.frames[i].dhtmlDragAndDrop.initFrameRoute(window,!e||t?1:0)}catch(s){}},_isFF=!1,_isIE=!1,_isOpera=!1,_isKHTML=!1,_isMacOS=!1,_isChrome=!1,_FFrv=!1,_KHTMLrv=!1,_OperaRv=!1,-1!=navigator.userAgent.indexOf("Macintosh")&&(_isMacOS=!0),navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=!0),-1!=navigator.userAgent.indexOf("Safari")||-1!=navigator.userAgent.indexOf("Konqueror")?(_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),_KHTMLrv>525?(_isFF=!0,_FFrv=1.9):_isKHTML=!0):-1!=navigator.userAgent.indexOf("Opera")?(_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):-1!=navigator.appName.indexOf("Microsoft")?(_isIE=!0,-1==navigator.appVersion.indexOf("MSIE 8.0")&&-1==navigator.appVersion.indexOf("MSIE 9.0")&&-1==navigator.appVersion.indexOf("MSIE 10.0")||"BackCompat"==document.compatMode||(_isIE=8)):(_isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])),dtmlXMLLoaderObject.prototype.doXPath=function(e,t,s,i){if(_isKHTML||!_isIE&&!window.XPathResult)return this.doXPathOpera(e,t);if(_isIE)return t||(t=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),t||dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),null!=s&&t.setProperty("SelectionNamespaces","xmlns:xsl='"+s+"'"),"single"==i?t.selectSingleNode(e):t.selectNodes(e)||new Array(0);var r=t;t||(t=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),t||dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),-1!=t.nodeName.indexOf("document")?r=t:(r=t,t=t.ownerDocument);var n=XPathResult.ANY_TYPE;"single"==i&&(n=XPathResult.FIRST_ORDERED_NODE_TYPE);var a=new Array,d=t.evaluate(e,r,function(){return s},n,null);if(n==XPathResult.FIRST_ORDERED_NODE_TYPE)return d.singleNodeValue;for(var o=d.iterateNext();o;)a[a.length]=o,o=d.iterateNext();return a},_dhtmlxError.prototype.catchError=function(e,t){this.catches[e]=t},_dhtmlxError.prototype.throwError=function(e,t,s){return this.catches[e]?this.catches[e](e,t,s):this.catches.ALL?this.catches.ALL(e,t,s):(alert("Error type: "+arguments[0]+"\nDescription: "+arguments[1]),null)},window.dhtmlxError=new _dhtmlxError,dtmlXMLLoaderObject.prototype.doXPathOpera=function(e,t){var s=e.replace(/[\/]+/gi,"/").split("/"),i=null,r=1;if(!s.length)return[];if("."==s[0])i=[t];else{if(""!=s[0])return[];i=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(s[r].replace(/\[[^\]]*\]/g,"")),r++}for(r;r<s.length;r++)i=this._getAllNamedChilds(i,s[r]);return-1!=s[r-1].indexOf("[")&&(i=this._filterXPath(i,s[r-1])),i},dtmlXMLLoaderObject.prototype._filterXPath=function(e,t){for(var s=new Array,t=t.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,""),i=0;i<e.length;i++)e[i].getAttribute(t)&&(s[s.length]=e[i]);return s},dtmlXMLLoaderObject.prototype._getAllNamedChilds=function(e,t){var s=new Array;_isKHTML&&(t=t.toUpperCase());for(var i=0;i<e.length;i++)for(var r=0;r<e[i].childNodes.length;r++)_isKHTML?e[i].childNodes[r].tagName&&e[i].childNodes[r].tagName.toUpperCase()==t&&(s[s.length]=e[i].childNodes[r]):e[i].childNodes[r].tagName==t&&(s[s.length]=e[i].childNodes[r]);return s},dtmlXMLLoaderObject.prototype.xslDoc=null,dtmlXMLLoaderObject.prototype.setXSLParamValue=function(e,t,s){s||(s=this.xslDoc),s.responseXML&&(s=s.responseXML);var i=this.doXPath("/xsl:stylesheet/xsl:variable[@name='"+e+"']",s,"http://www.w3.org/1999/XSL/Transform","single");null!=i&&(i.firstChild.nodeValue=t)},dtmlXMLLoaderObject.prototype.doXSLTransToObject=function(e,t){if(e||(e=this.xslDoc),e.responseXML&&(e=e.responseXML),t||(t=this.xmlDoc),t.responseXML&&(t=t.responseXML),_isIE){var s=new ActiveXObject("Msxml2.DOMDocument.3.0");try{t.transformNodeToObject(e,s)}catch(i){s=t.transformNode(e)}}else{this.XSLProcessor||(this.XSLProcessor=new XSLTProcessor,this.XSLProcessor.importStylesheet(e));var s=this.XSLProcessor.transformToDocument(t)}return s},dtmlXMLLoaderObject.prototype.doXSLTransToString=function(e,t){var s=this.doXSLTransToObject(e,t);return"string"==typeof s?s:this.doSerialization(s)},dtmlXMLLoaderObject.prototype.doSerialization=function(e){if(e||(e=this.xmlDoc),e.responseXML&&(e=e.responseXML),_isIE)return e.xml;var t=new XMLSerializer;return t.serializeToString(e)},dhtmlxEventable=function(obj){obj.attachEvent=function(e,t,s){return e="ev_"+e.toLowerCase(),this[e]||(this[e]=new this.eventCatcher(s||this)),e+":"+this[e].addEvent(t)},obj.callEvent=function(e,t){return e="ev_"+e.toLowerCase(),this[e]?this[e].apply(this,t):!0},obj.checkEvent=function(e){return!!this["ev_"+e.toLowerCase()]},obj.eventCatcher=function(obj){var dhx_catch=[],z=function(){for(var e=!0,t=0;t<dhx_catch.length;t++)if(null!=dhx_catch[t]){var s=dhx_catch[t].apply(obj,arguments);e=e&&s}return e};return z.addEvent=function(ev){return"function"!=typeof ev&&(ev=eval(ev)),ev?dhx_catch.push(ev)-1:!1},z.removeEvent=function(e){dhx_catch[e]=null},z},obj.detachEvent=function(e){if(0!=e){var t=e.split(":");this[t[0]].removeEvent(t[1])}},obj.detachAllEvents=function(){for(var e in this)0==e.indexOf("ev_")&&delete this[e]},obj=null},window.dhtmlx||(window.dhtmlx={}),function(){function e(e,t){var i=e.callback;s(!1),e.box.parentNode.removeChild(e.box),c=e.box=null,i&&i(t)}function t(t){if(c){t=t||event;var s=t.which||event.keyCode;return dhtmlx.message.keyboard&&((13==s||32==s)&&e(c,!0),27==s&&e(c,!1)),t.preventDefault&&t.preventDefault(),!(t.cancelBubble=!0)}}function s(e){s.cover||(s.cover=document.createElement("DIV"),s.cover.onkeydown=t,s.cover.className="dhx_modal_cover",document.body.appendChild(s.cover));document.body.scrollHeight;s.cover.style.display=e?"inline-block":"none"}function i(e,t){var s="dhtmlx_"+e.toLowerCase().replace(/ /g,"_")+"_button";return"<div class='dhtmlx_popup_button "+s+"' result='"+t+"' ><div>"+e+"</div></div>"}function r(e){u.area||(u.area=document.createElement("DIV"),u.area.className="dhtmlx_message_area",u.area.style[u.position]="5px",document.body.appendChild(u.area)),u.hide(e.id);var t=document.createElement("DIV");return t.innerHTML="<div>"+e.text+"</div>",t.className="dhtmlx-info dhtmlx-"+e.type,t.onclick=function(){u.hide(e.id),e=null},"bottom"==u.position&&u.area.firstChild?u.area.insertBefore(t,u.area.firstChild):u.area.appendChild(t),e.expire>0&&(u.timers[e.id]=window.setTimeout(function(){u.hide(e.id)},e.expire)),u.pull[e.id]=t,t=null,e.id}function n(t,s,r){var n=document.createElement("DIV");n.className=" dhtmlx_modal_box dhtmlx-"+t.type,n.setAttribute("dhxbox",1);var a="";if(t.width&&(n.style.width=t.width),t.height&&(n.style.height=t.height),t.title&&(a+='<div class="dhtmlx_popup_title">'+t.title+"</div>"),a+='<div class="dhtmlx_popup_text"><span>'+(t.content?"":t.text)+'</span></div><div  class="dhtmlx_popup_controls">',s&&(a+=i(t.ok||"OK",!0)),r&&(a+=i(t.cancel||"Cancel",!1)),t.buttons)for(var d=0;d<t.buttons.length;d++)a+=i(t.buttons[d],d);if(a+="</div>",n.innerHTML=a,t.content){var o=t.content;"string"==typeof o&&(o=document.getElementById(o)),"none"==o.style.display&&(o.style.display=""),n.childNodes[t.title?1:0].appendChild(o)}return n.onclick=function(s){s=s||event;var i=s.target||s.srcElement;i.className||(i=i.parentNode),"dhtmlx_popup_button"==i.className.split(" ")[0]&&(result=i.getAttribute("result"),result="true"==result||("false"==result?!1:result),e(t,result))},t.box=n,(s||r)&&(c=t),n}function a(e,i,r){var a=e.tagName?e:n(e,i,r);e.hidden||s(!0),document.body.appendChild(a);var d=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-a.offsetWidth)/2)),o=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-a.offsetHeight)/2));return a.style.top="top"==e.position?"-3px":o+"px",a.style.left=d+"px",a.onkeydown=t,a.focus(),e.hidden&&dhtmlx.modalbox.hide(a),a}function d(e){return a(e,!0,!1)}function o(e){return a(e,!0,!0)}function l(e){return a(e)}function h(e,t,s){return"object"!=typeof e&&("function"==typeof t&&(s=t,t=""),e={text:e,type:t,callback:s}),e}function _(e,t,s,i){return"object"!=typeof e&&(e={text:e,type:t,expire:s,id:i}),e.id=e.id||u.uid(),e.expire=e.expire||u.expire,e}var c=null;document.attachEvent?document.attachEvent("onkeydown",t):document.addEventListener("keydown",t,!0),dhtmlx.alert=function(){return text=h.apply(this,arguments),text.type=text.type||"confirm",d(text)},dhtmlx.confirm=function(){return text=h.apply(this,arguments),text.type=text.type||"alert",o(text)},dhtmlx.modalbox=function(){return text=h.apply(this,arguments),text.type=text.type||"alert",l(text)},dhtmlx.modalbox.hide=function(e){for(;e&&e.getAttribute&&!e.getAttribute("dhxbox");)e=e.parentNode;e&&(e.parentNode.removeChild(e),s(!1))};var u=dhtmlx.message=function(e){e=_.apply(this,arguments),e.type=e.type||"info";var t=e.type.split("-")[0];switch(t){case"alert":return d(e);case"confirm":return o(e);case"modalbox":return l(e);default:return r(e)}};u.seed=(new Date).valueOf(),u.uid=function(){return u.seed++},u.expire=4e3,u.keyboard=!0,u.position="top",u.pull={},u.timers={},u.hideAll=function(){for(var e in u.pull)u.hide(e)},u.hide=function(e){var t=u.pull[e];t&&t.parentNode&&(window.setTimeout(function(){t.parentNode.removeChild(t),t=null},2e3),t.className+=" hidden",u.timers[e]&&window.clearTimeout(u.timers[e]),delete u.pull[e])}}(),dataProcessor.prototype={setTransactionMode:function(e,t){this._tMode=e,this._tSend=t},escape:function(e){return this._utf?encodeURIComponent(e):escape(e)},enableUTFencoding:function(e){this._utf=convertStringToBoolean(e)},setDataColumns:function(e){this._columns="string"==typeof e?e.split(","):e},getSyncState:function(){return!this.updatedRows.length},enableDataNames:function(e){this._endnm=convertStringToBoolean(e)},enablePartialDataSend:function(e){this._changed=convertStringToBoolean(e)},setUpdateMode:function(e,t){this.autoUpdate="cell"==e,this.updateMode=e,this.dnd=t},ignore:function(e,t){this._silent_mode=!0,e.call(t||window),this._silent_mode=!1},setUpdated:function(e,t,s){if(!this._silent_mode){var i=this.findRow(e);s=s||"updated";var r=this.obj.getUserData(e,this.action_param);r&&"updated"==s&&(s=r),t?(this.set_invalid(e,!1),this.updatedRows[i]=e,this.obj.setUserData(e,this.action_param,s),this._in_progress[e]&&(this._in_progress[e]="wait")):this.is_invalid(e)||(this.updatedRows.splice(i,1),this.obj.setUserData(e,this.action_param,"")),t||this._clearUpdateFlag(e),this.markRow(e,t,s),t&&this.autoUpdate&&this.sendData(e)}},_clearUpdateFlag:function(){},markRow:function(e,t,s){var i="",r=this.is_invalid(e);if(r&&(i=this.styles[r],t=!0),this.callEvent("onRowMark",[e,t,s,r])&&(i=this.styles[t?s:"clear"]+i,this.obj[this._methods[0]](e,i),r&&r.details)){i+=this.styles[r+"_cell"];for(var n=0;n<r.details.length;n++)r.details[n]&&this.obj[this._methods[1]](e,n,i)}},getState:function(e){return this.obj.getUserData(e,this.action_param)},is_invalid:function(e){return this._invalid[e]},set_invalid:function(e,t,s){s&&(t={value:t,details:s,toString:function(){return this.value.toString()}}),this._invalid[e]=t},checkBeforeUpdate:function(){return!0},sendData:function(e){return!this._waitMode||"tree"!=this.obj.mytype&&!this.obj._h2?(this.obj.editStop&&this.obj.editStop(),"undefined"==typeof e||this._tSend?this.sendAllData():this._in_progress[e]?!1:(this.messages=[],!this.checkBeforeUpdate(e)&&this.callEvent("onValidatationError",[e,this.messages])?!1:void this._beforeSendData(this._getRowData(e),e))):void 0},_beforeSendData:function(e,t){return this.callEvent("onBeforeUpdate",[t,this.getState(t),e])?void this._sendData(e,t):!1},serialize:function(e,t){if("string"==typeof e)return e;if("undefined"!=typeof t)return this.serialize_one(e,"");var s=[],i=[];for(var r in e)e.hasOwnProperty(r)&&(s.push(this.serialize_one(e[r],r+this.post_delim)),i.push(r));return s.push("ids="+this.escape(i.join(","))),dhtmlx.security_key&&s.push("dhx_security="+dhtmlx.security_key),s.join("&")},serialize_one:function(e,t){if("string"==typeof e)return e;var s=[];for(var i in e)e.hasOwnProperty(i)&&s.push(this.escape((t||"")+i)+"="+this.escape(e[i]));return s.join("&")},_sendData:function(e,t){if(e){if(!this.callEvent("onBeforeDataSending",t?[t,this.getState(t),e]:[null,null,e]))return!1;t&&(this._in_progress[t]=(new Date).valueOf());var s=new dtmlXMLLoaderObject(this.afterUpdate,this,!0),i=this.serverProcessor+(this._user?getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&"):"");"POST"!=this._tMode?s.loadXML(i+(-1!=i.indexOf("?")?"&":"?")+this.serialize(e,t)):s.loadXML(i,!0,this.serialize(e,t)),this._waitMode++}},sendAllData:function(){if(this.updatedRows.length){this.messages=[];for(var e=!0,t=0;t<this.updatedRows.length;t++)e&=this.checkBeforeUpdate(this.updatedRows[t]);if(!e&&!this.callEvent("onValidatationError",["",this.messages]))return!1;if(this._tSend)this._sendData(this._getAllData());else for(var t=0;t<this.updatedRows.length;t++)if(!this._in_progress[this.updatedRows[t]]){if(this.is_invalid(this.updatedRows[t]))continue;if(this._beforeSendData(this._getRowData(this.updatedRows[t]),this.updatedRows[t]),this._waitMode&&("tree"==this.obj.mytype||this.obj._h2))return}}},_getAllData:function(){for(var e={},t=!1,s=0;s<this.updatedRows.length;s++){var i=this.updatedRows[s];this._in_progress[i]||this.is_invalid(i)||this.callEvent("onBeforeUpdate",[i,this.getState(i)])&&(e[i]=this._getRowData(i,i+this.post_delim),t=!0,this._in_progress[i]=(new Date).valueOf())}return t?e:null},setVerificator:function(e,t){this.mandatoryFields[e]=t||function(e){return""!=e}},clearVerificator:function(e){this.mandatoryFields[e]=!1},findRow:function(e){var t=0;for(t=0;t<this.updatedRows.length&&e!=this.updatedRows[t];t++);return t},defineAction:function(e,t){this._uActions||(this._uActions=[]),this._uActions[e]=t},afterUpdateCallback:function(e,t,s,i){var r=e,n="error"!=s&&"invalid"!=s;if(n||this.set_invalid(e,s),this._uActions&&this._uActions[s]&&!this._uActions[s](i))return delete this._in_progress[r];"wait"!=this._in_progress[r]&&this.setUpdated(e,!1);switch(s){case"update":case"updated":case"inserted":case"insert":t!=e&&(this.obj[this._methods[2]](e,t),e=t);break;case"delete":case"deleted":return this.obj.setUserData(e,this.action_param,"true_deleted"),this.obj[this._methods[3]](e),delete this._in_progress[r],this.callEvent("onAfterUpdate",[e,s,t,i])}"wait"!=this._in_progress[r]?(n&&this.obj.setUserData(e,this.action_param,""),delete this._in_progress[r]):(delete this._in_progress[r],this.setUpdated(t,!0,this.obj.getUserData(e,this.action_param))),this.callEvent("onAfterUpdate",[e,s,t,i])},afterUpdate:function(e,t,s,i,r){if(r.getXMLTopNode("data"),r.xmlDoc.responseXML){for(var n=r.doXPath("//data/action"),a=0;a<n.length;a++){var d=n[a],o=d.getAttribute("type"),l=d.getAttribute("sid"),h=d.getAttribute("tid");e.afterUpdateCallback(l,h,o,d)}e.finalizeUpdate()}},finalizeUpdate:function(){this._waitMode&&this._waitMode--,("tree"==this.obj.mytype||this.obj._h2)&&this.updatedRows.length&&this.sendData(),this.callEvent("onAfterUpdateFinish",[]),this.updatedRows.length||this.callEvent("onFullSync",[])},init:function(e){this.obj=e,this.obj._dp_init&&this.obj._dp_init(this)},setOnAfterUpdate:function(e){this.attachEvent("onAfterUpdate",e)},enableDebug:function(){},setOnBeforeUpdateHandler:function(e){this.attachEvent("onBeforeDataSending",e)},setAutoUpdate:function(e,t){e=e||2e3,this._user=t||(new Date).valueOf(),this._need_update=!1,this._loader=null,this._update_busy=!1,this.attachEvent("onAfterUpdate",function(e,t,s,i){this.afterAutoUpdate(e,t,s,i)}),this.attachEvent("onFullSync",function(){this.fullSync()});var s=this;window.setInterval(function(){s.loadUpdate()},e)},afterAutoUpdate:function(e,t){return"collision"==t?(this._need_update=!0,!1):!0},fullSync:function(){return 1==this._need_update&&(this._need_update=!1,this.loadUpdate()),!0},getUpdates:function(e,t){return this._update_busy?!1:(this._update_busy=!0,this._loader=this._loader||new dtmlXMLLoaderObject(!0),this._loader.async=!0,this._loader.waitCall=t,void this._loader.loadXML(e))},_v:function(e){return e.firstChild?e.firstChild.nodeValue:""},_a:function(e){for(var t=[],s=0;s<e.length;s++)t[s]=this._v(e[s]);return t},loadUpdate:function(){var e=this,t=this.obj.getUserData(0,"version"),s=this.serverProcessor+getUrlSymbol(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+t].join("&");s=s.replace("editing=true&",""),this.getUpdates(s,function(){var t=e._loader.doXPath("//userdata");e.obj.setUserData(0,"version",e._v(t[0]));var s=e._loader.doXPath("//update");if(s.length){e._silent_mode=!0;for(var i=0;i<s.length;i++){var r=s[i].getAttribute("status"),n=s[i].getAttribute("id"),a=s[i].getAttribute("parent");switch(r){case"inserted":e.callEvent("insertCallback",[s[i],n,a]);break;case"updated":e.callEvent("updateCallback",[s[i],n,a]);break;case"deleted":e.callEvent("deleteCallback",[s[i],n,a])}}e._silent_mode=!1}e._update_busy=!1,e=null})}},window.dhtmlXGridObject&&(dhtmlXGridObject.prototype._init_point_connector=dhtmlXGridObject.prototype._init_point,dhtmlXGridObject.prototype._init_point=function(){var e=function(e){return e=e.replace(/(\?|\&)connector[^\f]*/g,""),e+(-1!=e.indexOf("?")?"&":"?")+"connector=true"+(this.hdr.rows.length>0?"&dhx_no_header=1":"")},t=function(t){return e.call(this,t)+(this._connector_sorting||"")+(this._connector_filter||"")},s=function(e,s,i){return this._connector_sorting="&dhx_sort["+s+"]="+i,t.call(this,e)},i=function(e,s,i){for(var r=0;r<s.length;r++)s[r]="dhx_filter["+s[r]+"]="+encodeURIComponent(i[r]);return this._connector_filter="&"+s.join("&"),t.call(this,e)};this.attachEvent("onCollectValues",function(e){return this._con_f_used[e]?"object"==typeof this._con_f_used[e]?this._con_f_used[e]:!1:!0}),this.attachEvent("onDynXLS",function(){return this.xmlFileUrl=t.call(this,this.xmlFileUrl),!0}),this.attachEvent("onBeforeSorting",function(e,t,i){if("connector"==t){var r=this;return this.clearAndLoad(s.call(this,this.xmlFileUrl,e,i),function(){r.setSortImgState(!0,e,i)}),!1}return!0}),this.attachEvent("onFilterStart",function(e,t){return this._con_f_used.length?(this.clearAndLoad(i.call(this,this.xmlFileUrl,e,t)),!1):!0}),this.attachEvent("onXLE",function(e,t,s,i){}),this._init_point_connector&&this._init_point_connector()},dhtmlXGridObject.prototype._con_f_used=[],dhtmlXGridObject.prototype._in_header_connector_text_filter=function(e,t){return this._con_f_used[t]||(this._con_f_used[t]=1),this._in_header_text_filter(e,t)
},dhtmlXGridObject.prototype._in_header_connector_select_filter=function(e,t){return this._con_f_used[t]||(this._con_f_used[t]=2),this._in_header_select_filter(e,t)},dhtmlXGridObject.prototype.load_connector=dhtmlXGridObject.prototype.load,dhtmlXGridObject.prototype.load=function(){if(!this._colls_loaded&&this.cellType){for(var e=[],t=0;t<this.cellType.length;t++)(0==this.cellType[t].indexOf("co")||2==this._con_f_used[t])&&e.push(t);e.length&&(arguments[0]+=(-1!=arguments[0].indexOf("?")?"&":"?")+"connector=true&dhx_colls="+e.join(","))}return this.load_connector.apply(this,arguments)},dhtmlXGridObject.prototype._parseHead_connector=dhtmlXGridObject.prototype._parseHead,dhtmlXGridObject.prototype._parseHead=function(){if(this._parseHead_connector.apply(this,arguments),!this._colls_loaded){for(var e=this.xmlLoader.doXPath("./coll_options",arguments[0]),t=0;t<e.length;t++){var s=e[t].getAttribute("for"),i=[],r=null;"combo"==this.cellType[s]&&(r=this.getColumnCombo(s)),0==this.cellType[s].indexOf("co")&&(r=this.getCombo(s));for(var n=this.xmlLoader.doXPath("./item",e[t]),a=0;a<n.length;a++){var d=n[a].getAttribute("value");if(r){var o=n[a].getAttribute("label")||d;r.addOption?r.addOption([[d,o]]):r.put(d,o),i[i.length]=o}else i[i.length]=d}this._con_f_used[1*s]&&(this._con_f_used[1*s]=i)}this._colls_loaded=!0}}),window.dataProcessor&&(dataProcessor.prototype.init_original=dataProcessor.prototype.init,dataProcessor.prototype.init=function(e){this.init_original(e),e._dataprocessor=this,this.setTransactionMode("POST",!0),this.serverProcessor+=(-1!=this.serverProcessor.indexOf("?")?"&":"?")+"editing=true"}),dhtmlxError.catchError("LoadXML",function(e,t,s){0!=s[0].status&&alert(s[0].responseText)}),window.dhtmlXScheduler=window.scheduler={version:"4.0.1"},dhtmlxEventable(scheduler),scheduler.init=function(e,t,s){t=t||scheduler._currentDate(),s=s||"week",this._skin_init&&scheduler._skin_init(),scheduler.date.init(),this._obj="string"==typeof e?document.getElementById(e):e,this._els=[],this._scroll=!0,this._quirks=_isIE&&"BackCompat"==document.compatMode,this._quirks7=_isIE&&-1==navigator.appVersion.indexOf("MSIE 8"),this.get_elements(),this.init_templates(),this.set_actions(),function(){function e(){return{w:window.innerWidth||document.documentElement.clientWidth,h:window.innerHeight||document.documentElement.clientHeight}}function t(e,t){return e.w==t.w&&e.h==t.h}var s=e();dhtmlxEvent(window,"resize",function(){var i=e();t(s,i)||(window.clearTimeout(scheduler._resize_timer),scheduler._resize_timer=window.setTimeout(function(){scheduler.callEvent("onSchedulerResize",[])&&(scheduler.update_view(),scheduler.callEvent("onAfterSchedulerResize",[]))},100)),s=i})}(),this._init_touch_events(),this.set_sizes(),scheduler.callEvent("onSchedulerReady",[]),this.setCurrentView(t,s)},scheduler.xy={min_event_height:40,scale_width:50,scroll_width:18,scale_height:20,month_scale_height:20,menu_width:25,margin_top:0,margin_left:0,editor_width:140},scheduler.keys={edit_save:13,edit_cancel:27},scheduler.set_sizes=function(){var e=this._x=this._obj.clientWidth-this.xy.margin_left,t=this._y=this._obj.clientHeight-this.xy.margin_top,s=this._table_view?0:this.xy.scale_width+this.xy.scroll_width,i=this._table_view?-1:this.xy.scale_width;this.set_xy(this._els.dhx_cal_navline[0],e,this.xy.nav_height,0,0),this.set_xy(this._els.dhx_cal_header[0],e-s,this.xy.scale_height,i,this.xy.nav_height+(this._quirks?-1:1));var r=this._els.dhx_cal_navline[0].offsetHeight;r>0&&(this.xy.nav_height=r);var n=this.xy.scale_height+this.xy.nav_height+(this._quirks?-2:0);this.set_xy(this._els.dhx_cal_data[0],e,t-(n+2),0,n+2)},scheduler.set_xy=function(e,t,s,i,r){e.style.width=Math.max(0,t)+"px",e.style.height=Math.max(0,s)+"px",arguments.length>3&&(e.style.left=i+"px",e.style.top=r+"px")},scheduler.get_elements=function(){for(var e=this._obj.getElementsByTagName("DIV"),t=0;t<e.length;t++){var s=e[t].className;s&&(s=s.split(" ")[0]),this._els[s]||(this._els[s]=[]),this._els[s].push(e[t]);var i=scheduler.locale.labels[e[t].getAttribute("name")||s];i&&(e[t].innerHTML=i)}},scheduler.set_actions=function(){for(var e in this._els)if(this._click[e])for(var t=0;t<this._els[e].length;t++)this._els[e][t].onclick=scheduler._click[e];this._obj.onselectstart=function(){return!1},this._obj.onmousemove=function(e){scheduler._temp_touch_block||scheduler._on_mouse_move(e||event)},this._obj.onmousedown=function(e){scheduler._ignore_next_click||scheduler._on_mouse_down(e||event)},this._obj.onmouseup=function(e){scheduler._ignore_next_click||scheduler._on_mouse_up(e||event)},this._obj.ondblclick=function(e){scheduler._on_dbl_click(e||event)},this._obj.oncontextmenu=function(e){var t=e||event,s=t.target||t.srcElement,i=scheduler.callEvent("onContextMenu",[scheduler._locate_event(s),t]);return i}},scheduler.select=function(e){this._select_id!=e&&(this.editStop(!1),this.unselect(),this._select_id=e,this.updateEvent(e))},scheduler.unselect=function(e){if(!e||e==this._select_id){var t=this._select_id;this._select_id=null,t&&this.updateEvent(t)}},scheduler.getState=function(){return{mode:this._mode,date:this._date,min_date:this._min_date,max_date:this._max_date,editor_id:this._edit_id,lightbox_id:this._lightbox_id,new_event:this._new_event,select_id:this._select_id,expanded:this.expanded,drag_id:this._drag_id,drag_mode:this._drag_mode}},scheduler._click={dhx_cal_data:function(e){if(scheduler._ignore_next_click)return e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,scheduler._ignore_next_click=!1;var t=e?e.target:event.srcElement,s=scheduler._locate_event(t);if(e=e||event,s){if(!scheduler.callEvent("onClick",[s,e])||scheduler.config.readonly)return}else scheduler.callEvent("onEmptyClick",[scheduler.getActionData(e).date,e]);if(s&&scheduler.config.select){scheduler.select(s);var i=t.className;-1!=i.indexOf("_icon")&&scheduler._click.buttons[i.split(" ")[1].replace("icon_","")](s)}else scheduler._close_not_saved()},dhx_cal_prev_button:function(){scheduler._click.dhx_cal_next_button(0,-1)},dhx_cal_next_button:function(e,t){scheduler.setCurrentView(scheduler.date.add(scheduler.date[scheduler._mode+"_start"](scheduler._date),t||1,scheduler._mode))},dhx_cal_today_button:function(){scheduler.callEvent("onBeforeTodayDisplayed",[])&&scheduler.setCurrentView(scheduler._currentDate())},dhx_cal_tab:function(){var e=this.getAttribute("name"),t=e.substring(0,e.search("_tab"));scheduler.setCurrentView(scheduler._date,t)},buttons:{"delete":function(e){var t=scheduler.locale.labels.confirm_deleting;scheduler._dhtmlx_confirm(t,scheduler.locale.labels.title_confirm_deleting,function(){scheduler.deleteEvent(e)})},edit:function(e){scheduler.edit(e)},save:function(){scheduler.editStop(!0)},details:function(e){scheduler.showLightbox(e)},cancel:function(){scheduler.editStop(!1)}}},scheduler._dhtmlx_confirm=function(e,t,s){if(!e)return s();var i={text:e};t&&(i.title=t),s&&(i.callback=function(e){e&&s()}),dhtmlx.confirm(i)},scheduler.addEventNow=function(e,t,s){var i={};e&&null!==e.constructor.toString().match(/object/i)&&(i=e,e=null);var r=6e4*(this.config.event_duration||this.config.time_step);e||(e=i.start_date||Math.round(scheduler._currentDate().valueOf()/r)*r);var n=new Date(e);if(!t){var a=this.config.first_hour;a>n.getHours()&&(n.setHours(a),e=n.valueOf()),t=e.valueOf()+r}var d=new Date(t);n.valueOf()==d.valueOf()&&d.setTime(d.valueOf()+r),i.start_date=i.start_date||n,i.end_date=i.end_date||d,i.text=i.text||this.locale.labels.new_event,i.id=this._drag_id=this.uid(),this._drag_mode="new-size",this._loading=!0,this.addEvent(i),this.callEvent("onEventCreated",[this._drag_id,s]),this._loading=!1,this._drag_event={},this._on_mouse_up(s)},scheduler._on_dbl_click=function(e,t){if(t=t||e.target||e.srcElement,!this.config.readonly&&t.className){var s=t.className.split(" ")[0];switch(s){case"dhx_scale_holder":case"dhx_scale_holder_now":case"dhx_month_body":case"dhx_wa_day_data":case"dhx_marked_timespan":if(!scheduler.config.dblclick_create)break;this.addEventNow(this.getActionData(e).date,null,e);break;case"dhx_cal_event":case"dhx_wa_ev_body":case"dhx_agenda_line":case"dhx_grid_event":case"dhx_cal_event_line":case"dhx_cal_event_clear":var i=this._locate_event(t);if(!this.callEvent("onDblClick",[i,e]))return;this.config.details_on_dblclick||this._table_view||!this.getEvent(i)._timed||!this.config.select?this.showLightbox(i):this.edit(i);break;case"dhx_time_block":case"dhx_cal_container":return;default:var r=this["dblclick_"+s];if(r)r.call(this,e);else if(t.parentNode&&t!=this)return scheduler._on_dbl_click(e,t.parentNode)}}},scheduler._mouse_coords=function(e){var t,s=document.body,i=document.documentElement;t=_isIE||!e.pageX&&!e.pageY?{x:e.clientX+(s.scrollLeft||i.scrollLeft||0)-s.clientLeft,y:e.clientY+(s.scrollTop||i.scrollTop||0)-s.clientTop}:{x:e.pageX,y:e.pageY},t.x-=getAbsoluteLeft(this._obj)+(this._table_view?0:this.xy.scale_width),t.y-=getAbsoluteTop(this._obj)+this.xy.nav_height+(this._dy_shift||0)+this.xy.scale_height-this._els.dhx_cal_data[0].scrollTop,t.ev=e;var r=this["mouse_"+this._mode];if(r)return r.call(this,t);if(this._cols){var n=t.x/this._cols[0];if(this._ignores)for(var a=0;n>=a;a++)this._ignores[a]&&n++}if(this._table_view){if(!this._cols||!this._colsS)return t;var d=0;for(d=1;d<this._colsS.heights.length&&!(this._colsS.heights[d]>t.y);d++);t.y=Math.ceil(24*(Math.max(0,n)+7*Math.max(0,d-1))*60/this.config.time_step),(scheduler._drag_mode||"month"==this._mode)&&(t.y=24*(Math.max(0,Math.ceil(n)-1)+7*Math.max(0,d-1))*60/this.config.time_step),"move"==this._drag_mode&&scheduler._ignores_detected&&scheduler.config.preserve_length&&(t._ignores=!0,this._drag_event._event_length||(this._drag_event._event_length=this._get_real_event_length(this._drag_event.start_date,this._drag_event.end_date,{x_step:1,x_unit:"day"}))),t.x=0}else{if(!this._cols)return t;t.x=Math.min(this._cols.length-1,Math.max(0,Math.ceil(n)-1)),t.y=Math.max(0,Math.ceil(60*t.y/(this.config.time_step*this.config.hour_size_px))-1)+this.config.first_hour*(60/this.config.time_step)}return t},scheduler._close_not_saved=function(){if((new Date).valueOf()-(scheduler._new_event||0)>500&&scheduler._edit_id){var e=scheduler.locale.labels.confirm_closing;scheduler._dhtmlx_confirm(e,scheduler.locale.labels.title_confirm_closing,function(){scheduler.editStop(scheduler.config.positive_closing)})}},scheduler._correct_shift=function(e,t){return e-=6e4*(new Date(scheduler._min_date).getTimezoneOffset()-new Date(e).getTimezoneOffset())*(t?-1:1)},scheduler._on_mouse_move=function(e){if(this._drag_mode){var t=this._mouse_coords(e);if(!this._drag_pos||t.force_redraw||this._drag_pos.x!=t.x||this._drag_pos.y!=t.y){var s,i;if(this._edit_id!=this._drag_id&&this._close_not_saved(),this._drag_pos=t,"create"==this._drag_mode){if(this._close_not_saved(),this._loading=!0,s=this._get_date_from_pos(t).valueOf(),!this._drag_start){var r=this.callEvent("onBeforeEventCreated",[e,this._drag_id]);if(!r)return;return void(this._drag_start=s)}i=s,i==this._drag_start;var n=new Date(this._drag_start),a=new Date(i);"day"!=this._mode&&"week"!=this._mode||n.getHours()!=a.getHours()||n.getMinutes()!=a.getMinutes()||(a=new Date(this._drag_start+1e3)),this._drag_id=this.uid(),this.addEvent(n,a,this.locale.labels.new_event,this._drag_id,t.fields),this.callEvent("onEventCreated",[this._drag_id,e]),this._loading=!1,this._drag_mode="new-size"}var d=this.getEvent(this._drag_id);if("move"==this._drag_mode)if(s=this._min_date.valueOf()+6e4*(t.y*this.config.time_step+24*t.x*60-(scheduler._move_pos_shift||0)),!t.custom&&this._table_view&&(s+=1e3*this.date.time_part(d.start_date)),s=this._correct_shift(s),t._ignores&&this.config.preserve_length&&this._table_view){if(this.matrix)var o=this.matrix[this._mode];o=o||{x_step:1,x_unit:"day"},i=1*s+this._get_fictional_event_length(s,this._drag_event._event_length,o)}else i=d.end_date.valueOf()-(d.start_date.valueOf()-s);else{if(s=d.start_date.valueOf(),i=d.end_date.valueOf(),this._table_view){var l=this._min_date.valueOf()+t.y*this.config.time_step*6e4+(t.custom?0:864e5);"month"==this._mode&&(l=this._correct_shift(l,!1)),t.resize_from_start?s=l:i=l}else i=this.date.date_part(new Date(d.end_date)).valueOf()+t.y*this.config.time_step*6e4,this._els.dhx_cal_data[0].style.cursor="s-resize",("week"==this._mode||"day"==this._mode)&&(i=this._correct_shift(i));if("new-size"==this._drag_mode)if(i<=this._drag_start){var h=t.shift||(this._table_view&&!t.custom?864e5:0);s=i-(t.shift?0:h),i=this._drag_start+(h||6e4*this.config.time_step)}else s=this._drag_start;else s>=i&&(i=s+6e4*this.config.time_step)}var _=new Date(i-1),c=new Date(s);if(this._table_view||_.getDate()==c.getDate()&&_.getHours()<this.config.last_hour||scheduler._allow_dnd)if(d.start_date=c,d.end_date=new Date(i),this.config.update_render){var u=scheduler._els.dhx_cal_data[0].scrollTop;this.update_view(),scheduler._els.dhx_cal_data[0].scrollTop=u}else this.updateEvent(this._drag_id);this._table_view&&this.for_rendered(this._drag_id,function(e){e.className+=" dhx_in_move"})}}else if(scheduler.checkEvent("onMouseMove")){var f=this._locate_event(e.target||e.srcElement);this.callEvent("onMouseMove",[f,e])}},scheduler._on_mouse_down=function(e,t){if(2!=e.button&&!this.config.readonly&&!this._drag_mode){t=t||e.target||e.srcElement;var s=t.className&&t.className.split(" ")[0];switch(s){case"dhx_cal_event_line":case"dhx_cal_event_clear":this._table_view&&(this._drag_mode="move");break;case"dhx_event_move":case"dhx_wa_ev_body":this._drag_mode="move";break;case"dhx_event_resize":this._drag_mode="resize";break;case"dhx_scale_holder":case"dhx_scale_holder_now":case"dhx_month_body":case"dhx_matrix_cell":case"dhx_marked_timespan":this._drag_mode="create",this.unselect(this._select_id);break;case"":if(t.parentNode)return scheduler._on_mouse_down(e,t.parentNode);default:if(scheduler.checkEvent("onMouseDown")&&scheduler.callEvent("onMouseDown",[s])&&t.parentNode&&t!=this)return scheduler._on_mouse_down(e,t.parentNode);this._drag_mode=null,this._drag_id=null}if(this._drag_mode){var i=this._locate_event(t);this.config["drag_"+this._drag_mode]&&this.callEvent("onBeforeDrag",[i,this._drag_mode,e])?(this._drag_id=i,this._drag_event=scheduler._lame_clone(this.getEvent(this._drag_id)||{})):this._drag_mode=this._drag_id=0}this._drag_start=null}},scheduler._on_mouse_up=function(e){if(!e||2!=e.button||!scheduler.config.touch){if(this._drag_mode&&this._drag_id){this._els.dhx_cal_data[0].style.cursor="default";var t=this.getEvent(this._drag_id);if(this._drag_event._dhx_changed||!this._drag_event.start_date||t.start_date.valueOf()!=this._drag_event.start_date.valueOf()||t.end_date.valueOf()!=this._drag_event.end_date.valueOf()){var s="new-size"==this._drag_mode;if(this.callEvent("onBeforeEventChanged",[t,e,s,this._drag_event])){var i=this._drag_id;if(this._drag_id=this._drag_mode=null,s&&this.config.edit_on_create){if(this.unselect(),this._new_event=new Date,this._table_view||this.config.details_on_create||!this.config.select)return this.showLightbox(i);this._drag_pos=!0,this._select_id=this._edit_id=i}else this._new_event||this.callEvent(s?"onEventAdded":"onEventChanged",[i,this.getEvent(i)])}else s?this.deleteEvent(t.id,!0):(this._drag_event._dhx_changed=!1,scheduler._lame_copy(t,this._drag_event),this.updateEvent(t.id))}this._drag_pos&&this.render_view_data()}this._drag_id=null,this._drag_mode=null,this._drag_pos=null}},scheduler.update_view=function(){return this._reset_scale(),this._load_mode&&this._load()?this._render_wait=!0:void this.render_view_data()},scheduler.isViewExists=function(e){return!!(scheduler[e+"_view"]||scheduler.date[e+"_start"]&&scheduler.templates[e+"_date"]&&scheduler.templates[e+"_scale_date"])},scheduler.updateView=function(e,t){e=e||this._date,t=t||this._mode;var s="dhx_cal_data";this._mode?this._obj.className=this._obj.className.replace("dhx_scheduler_"+this._mode,"dhx_scheduler_"+t):this._obj.className+=" dhx_scheduler_"+t;var i=this._mode==t&&this.config.preserve_scroll?this._els[s][0].scrollTop:!1;this[this._mode+"_view"]&&t&&this._mode!=t&&this[this._mode+"_view"](!1),this._close_not_saved();var r="dhx_multi_day";this._els[r]&&(this._els[r][0].parentNode.removeChild(this._els[r][0]),this._els[r]=null),this._mode=t,this._date=e,this._table_view="month"==this._mode;var n=this._els.dhx_cal_tab;if(n)for(var a=0;a<n.length;a++){var d=n[a].className;d=d.replace(/ active/g,""),n[a].getAttribute("name")==this._mode+"_tab"&&(d+=" active"),n[a].className=d}var o=this[this._mode+"_view"];o?o(!0):this.update_view(),"number"==typeof i&&(this._els[s][0].scrollTop=i)},scheduler.setCurrentView=function(e,t){this.callEvent("onBeforeViewChange",[this._mode,this._date,t||this._mode,e||this._date])&&(this.updateView(e,t),this.callEvent("onViewChange",[this._mode,this._date]))},scheduler._render_x_header=function(e,t,s,i){var r=document.createElement("DIV");r.className="dhx_scale_bar",this.templates[this._mode+"_scalex_class"]&&(r.className+=" "+this.templates[this._mode+"_scalex_class"](s));var n=this._cols[e]-1;"month"==this._mode&&0===e&&this.config.left_border&&(r.className+=" dhx_scale_bar_border",t+=1),this.set_xy(r,n,this.xy.scale_height-2,t,0),r.innerHTML=this.templates[this._mode+"_scale_date"](s,this._mode),i.appendChild(r)},scheduler._reset_scale=function(){if(this.templates[this._mode+"_date"]){var e=this._els.dhx_cal_header[0],t=this._els.dhx_cal_data[0],s=this.config;e.innerHTML="",t.scrollTop=0,t.innerHTML="";var i=(s.readonly||!s.drag_resize?" dhx_resize_denied":"")+(s.readonly||!s.drag_move?" dhx_move_denied":"");i&&(t.className="dhx_cal_data"+i),this._scales={},this._cols=[],this._colsS={height:0},this._dy_shift=0,this.set_sizes();var r,n,a,d,o=parseInt(e.style.width,10),l=0;n=this.date[this._mode+"_start"](new Date(this._date.valueOf())),r=a=this._table_view?scheduler.date.week_start(n):n,d=this.date.date_part(scheduler._currentDate());var h=scheduler.date.add(n,1,this._mode),_=7;if(!this._table_view){var c=this.date["get_"+this._mode+"_end"];c&&(h=c(n)),_=Math.round((h.valueOf()-n.valueOf())/864e5)}this._min_date=r,this._els.dhx_cal_date[0].innerHTML=this.templates[this._mode+"_date"](n,h,this._mode),this._process_ignores(a,_,"day",1);for(var u=_-this._ignores_detected,f=0;_>f;f++){if(this._ignores[f]?(this._cols[f]=0,u++):(this._cols[f]=Math.floor(o/(u-f)),this._render_x_header(f,l,r,e)),!this._table_view){var p=document.createElement("DIV"),m="dhx_scale_holder";r.valueOf()==d.valueOf()&&(m="dhx_scale_holder_now"),p.className=m+" "+this.templates.week_date_class(r,d),this.set_xy(p,this._cols[f]-1,s.hour_size_px*(s.last_hour-s.first_hour),l+this.xy.scale_width+1,0),t.appendChild(p),this.callEvent("onScaleAdd",[p,r])}r=this.date.add(r,1,"day"),o-=this._cols[f],l+=this._cols[f],this._colsS[f]=(this._cols[f-1]||0)+(this._colsS[f-1]||(this._table_view?0:this.xy.scale_width+2)),this._colsS.col_length=_+1}if(this._max_date=r,this._colsS[_]=this._cols[_-1]+this._colsS[_-1],this._table_view)this._reset_month_scale(t,n,a);else if(this._reset_hours_scale(t,n,a),s.multi_day){var g="dhx_multi_day";this._els[g]&&(this._els[g][0].parentNode.removeChild(this._els[g][0]),this._els[g]=null);var v=this._els.dhx_cal_navline[0],x=v.offsetHeight+this._els.dhx_cal_header[0].offsetHeight+1,y=document.createElement("DIV");y.className=g,y.style.visibility="hidden",this.set_xy(y,this._colsS[this._colsS.col_length-1]+this.xy.scroll_width,0,0,x),t.parentNode.insertBefore(y,t);var b=y.cloneNode(!0);b.className=g+"_icon",b.style.visibility="hidden",this.set_xy(b,this.xy.scale_width,0,0,x),y.appendChild(b),this._els[g]=[y,b],this._els[g][0].onclick=this._click.dhx_cal_data}}},scheduler._reset_hours_scale=function(e){var t=document.createElement("DIV");t.className="dhx_scale_holder";for(var s=new Date(1980,1,1,this.config.first_hour,0,0),i=1*this.config.first_hour;i<this.config.last_hour;i++){var r=document.createElement("DIV");r.className="dhx_scale_hour",r.style.height=this.config.hour_size_px-(this._quirks?0:1)+"px";var n=this.xy.scale_width;this.config.left_border&&(n-=1,r.className+=" dhx_scale_hour_border"),r.style.width=n+"px",r.innerHTML=scheduler.templates.hour_scale(s),t.appendChild(r),s=this.date.add(s,1,"hour")}e.appendChild(t),this.config.scroll_hour&&(e.scrollTop=this.config.hour_size_px*(this.config.scroll_hour-this.config.first_hour))},scheduler._currentDate=function(){return scheduler.config.now_date?new Date(scheduler.config.now_date):new Date},scheduler._process_ignores=function(e,t,s,i,r){this._ignores=[],this._ignores_detected=0;var n=scheduler["ignore_"+this._mode];if(n)for(var a=new Date(e),d=0;t>d;d++)n(a)&&(this._ignores_detected+=1,this._ignores[d]=!0,r&&t++),a=scheduler.date.add(a,i,s)},scheduler._reset_month_scale=function(e,t,s){var i=scheduler.date.add(t,1,"month"),r=scheduler._currentDate();this.date.date_part(r),this.date.date_part(s);var n=Math.ceil(Math.round((i.valueOf()-s.valueOf())/864e5)/7),a=[],d=Math.floor(e.clientHeight/n)-22;this._colsS.height=d+22;for(var o=this._colsS.heights=[],l=0;7>=l;l++){var h=(this._cols[l]||0)-1;0===l&&this.config.left_border&&(h-=1),a[l]=" style='height:"+d+"px; width:"+h+"px;' "}var _=0;this._min_date=s;for(var c="<table cellpadding='0' cellspacing='0'>",u=[],l=0;n>l;l++){c+="<tr>";for(var f=0;7>f;f++){c+="<td";var p="";t>s?p="dhx_before":s>=i?p="dhx_after":s.valueOf()==r.valueOf()&&(p="dhx_now"),c+=" class='"+p+" "+this.templates.month_date_class(s,r)+"' >";var m="dhx_month_body",g="dhx_month_head";0===f&&this.config.left_border&&(m+=" dhx_month_body_border",g+=" dhx_month_head_border"),this._ignores_detected&&this._ignores[f]?c+="<div></div><div></div>":(c+="<div class='"+g+"'>"+this.templates.month_day(s)+"</div>",c+="<div class='"+m+"' "+a[f]+"></div></td>"),u.push(s),s=this.date.add(s,1,"day")}c+="</tr>",o[l]=_,_+=this._colsS.height}c+="</table>",this._max_date=s,e.innerHTML=c,this._scales={};for(var v=e.getElementsByTagName("div"),l=0;l<u.length;l++){var x=v[2*l+1],y=u[l];this._scales[+y]=x}for(var l=0;l<u.length;l++){var y=u[l];this.callEvent("onScaleAdd",[this._scales[+y],y])}return s},scheduler.getLabel=function(e,t){for(var s=this.config.lightbox.sections,i=0;i<s.length;i++)if(s[i].map_to==e)for(var r=s[i].options,n=0;n<r.length;n++)if(r[n].key==t)return r[n].label;return""},scheduler.updateCollection=function(e,t){var s=scheduler.serverList(e);return s?(s.splice(0,s.length),s.push.apply(s,t||[]),scheduler.callEvent("onOptionsLoad",[]),scheduler.resetLightbox(),!0):!1},scheduler._lame_clone=function(e,t){var s,i,r;for(t=t||[],s=0;s<t.length;s+=2)if(e===t[s])return t[s+1];if(e&&"object"==typeof e){for(r={},i=[Array,Date,Number,String,Boolean],s=0;s<i.length;s++)e instanceof i[s]&&(r=s?new i[s](e):new i[s]);t.push(e,r);for(s in e)Object.prototype.hasOwnProperty.apply(e,[s])&&(r[s]=scheduler._lame_clone(e[s],t))}return r||e},scheduler._lame_copy=function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);return e},scheduler._get_date_from_pos=function(e){var t=this._min_date.valueOf()+6e4*(e.y*this.config.time_step+24*(this._table_view?0:e.x)*60);return new Date(this._correct_shift(t))},scheduler.getActionData=function(e){var t=this._mouse_coords(e);return{date:this._get_date_from_pos(t),section:t.section}},scheduler._focus=function(e,t){e&&e.focus&&(this.config.touch?window.setTimeout(function(){e.focus()},100):(t&&e.select&&e.select(),e.focus()))},scheduler._get_real_event_length=function(e,t,s){var i=t-e,r=s._start_correction+s._end_correction||0,n=this["ignore_"+this._mode],a=0;if(s.render){a=this._get_date_index(s,e);var d=this._get_date_index(s,t)}else var d=Math.round(i/60/60/1e3/24);for(;d>a;){var o=scheduler.date.add(t,-s.x_step,s.x_unit);i-=n&&n(t)?t-o:r,t=o,d--}return i},scheduler._get_fictional_event_length=function(e,t,s,i){var r=new Date(e),n=i?-1:1;if(s._start_correction||s._end_correction){if(i)var a=60*r.getHours()+r.getMinutes()-60*(s.first_hour||0);else var a=60*(s.last_hour||0)-(60*r.getHours()+r.getMinutes());var d=60*(s.last_hour-s.first_hour),o=Math.ceil((t/6e4-a)/d);t+=o*(1440-d)*60*1e3}var l=new Date(1*e+t*n),h=this["ignore_"+this._mode],_=0;if(s.render){_=this._get_date_index(s,r);var c=this._get_date_index(s,l)}else var c=Math.round(t/60/60/1e3/24);for(;c*n>=_*n;){var u=scheduler.date.add(r,s.x_step*n,s.x_unit);h&&h(r)&&(t+=(u-r)*n,c+=n),r=u,_+=n}return t},scheduler.date={init:function(){for(var e=scheduler.locale.date.month_short,t=scheduler.locale.date.month_short_hash={},s=0;s<e.length;s++)t[e[s]]=s;for(var e=scheduler.locale.date.month_full,t=scheduler.locale.date.month_full_hash={},s=0;s<e.length;s++)t[e[s]]=s},date_part:function(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),0!=e.getHours()&&e.setTime(e.getTime()+36e5*(24-e.getHours())),e},time_part:function(e){return(e.valueOf()/1e3-60*e.getTimezoneOffset())%86400},week_start:function(e){var t=e.getDay();return scheduler.config.start_on_monday&&(0===t?t=6:t--),this.date_part(this.add(e,-1*t,"day"))},month_start:function(e){return e.setDate(1),this.date_part(e)},year_start:function(e){return e.setMonth(0),this.month_start(e)},day_start:function(e){return this.date_part(e)},add:function(e,t,s){var i=new Date(e.valueOf());switch(s){case"week":t*=7;case"day":i.setDate(i.getDate()+t),!e.getHours()&&i.getHours()&&i.setTime(i.getTime()+36e5*(24-i.getHours()));break;case"month":i.setMonth(i.getMonth()+t);break;case"year":i.setYear(i.getFullYear()+t);break;case"hour":i.setHours(i.getHours()+t);break;case"minute":i.setMinutes(i.getMinutes()+t);break;default:return scheduler.date["add_"+s](e,t,s)}return i},to_fixed:function(e){return 10>e?"0"+e:e},copy:function(e){return new Date(e.valueOf())},date_to_str:function(e,t){return e=e.replace(/%[a-zA-Z]/g,function(e){switch(e){case"%d":return'"+scheduler.date.to_fixed(date.getDate())+"';case"%m":return'"+scheduler.date.to_fixed((date.getMonth()+1))+"';case"%j":return'"+date.getDate()+"';case"%n":return'"+(date.getMonth()+1)+"';case"%y":return'"+scheduler.date.to_fixed(date.getFullYear()%100)+"';case"%Y":return'"+date.getFullYear()+"';case"%D":return'"+scheduler.locale.date.day_short[date.getDay()]+"';case"%l":return'"+scheduler.locale.date.day_full[date.getDay()]+"';case"%M":return'"+scheduler.locale.date.month_short[date.getMonth()]+"';case"%F":return'"+scheduler.locale.date.month_full[date.getMonth()]+"';case"%h":return'"+scheduler.date.to_fixed((date.getHours()+11)%12+1)+"';case"%g":return'"+((date.getHours()+11)%12+1)+"';case"%G":return'"+date.getHours()+"';case"%H":return'"+scheduler.date.to_fixed(date.getHours())+"';case"%i":return'"+scheduler.date.to_fixed(date.getMinutes())+"';case"%a":return'"+(date.getHours()>11?"pm":"am")+"';case"%A":return'"+(date.getHours()>11?"PM":"AM")+"';case"%s":return'"+scheduler.date.to_fixed(date.getSeconds())+"';case"%W":return'"+scheduler.date.to_fixed(scheduler.date.getISOWeek(date))+"';default:return e}}),t&&(e=e.replace(/date\.get/g,"date.getUTC")),new Function("date",'return "'+e+'";')},str_to_date:function(e,t){for(var s="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);",i=e.match(/%[a-zA-Z]/g),r=0;r<i.length;r++)switch(i[r]){case"%j":case"%d":s+="set[2]=temp["+r+"]||1;";break;case"%n":case"%m":s+="set[1]=(temp["+r+"]||1)-1;";break;case"%y":s+="set[0]=temp["+r+"]*1+(temp["+r+"]>50?1900:2000);";break;case"%g":case"%G":case"%h":case"%H":s+="set[3]=temp["+r+"]||0;";break;case"%i":s+="set[4]=temp["+r+"]||0;";break;case"%Y":s+="set[0]=temp["+r+"]||0;";break;case"%a":case"%A":s+="set[3]=set[3]%12+((temp["+r+"]||'').toLowerCase()=='am'?0:12);";break;case"%s":s+="set[5]=temp["+r+"]||0;";break;case"%M":s+="set[1]=scheduler.locale.date.month_short_hash[temp["+r+"]]||0;";break;case"%F":s+="set[1]=scheduler.locale.date.month_full_hash[temp["+r+"]]||0;"}var n="set[0],set[1],set[2],set[3],set[4],set[5]";return t&&(n=" Date.UTC("+n+")"),new Function("date","var set=[0,0,1,0,0,0]; "+s+" return new Date("+n+");")},getISOWeek:function(e){if(!e)return!1;var t=e.getDay();0===t&&(t=7);var s=new Date(e.valueOf());s.setDate(e.getDate()+(4-t));var i=s.getFullYear(),r=Math.round((s.getTime()-new Date(i,0,1).getTime())/864e5),n=1+Math.floor(r/7);return n},getUTCISOWeek:function(e){return this.getISOWeek(this.convert_to_utc(e))},convert_to_utc:function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())}},scheduler.locale={date:{month_full:["January","February","March","April","May","June","July","August","September","October","November","December"],month_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],day_full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},labels:{dhx_cal_today_button:"Today",day_tab:"Day",week_tab:"Week",month_tab:"Month",new_event:"New event",icon_save:"Save",icon_cancel:"Cancel",icon_details:"Details",icon_edit:"Edit",icon_delete:"Delete",confirm_closing:"",confirm_deleting:"Event will be deleted permanently, are you sure?",section_description:"Description",section_time:"Time period",full_day:"Full day",confirm_recurring:"Do you want to edit the whole set of repeated events?",section_recurring:"Repeat event",button_recurring:"Disabled",button_recurring_open:"Enabled",button_edit_series:"Edit series",button_edit_occurrence:"Edit occurrence",agenda_tab:"Agenda",date:"Date",description:"Description",year_tab:"Year",week_agenda_tab:"Agenda",grid_tab:"Grid",drag_to_create:"Drag to create",drag_to_move:"Drag to move"}},scheduler.config={default_date:"%j %M %Y",month_date:"%F %Y",load_date:"%Y-%m-%d",week_date:"%l",day_date:"%D, %F %j",hour_date:"%H:%i",month_day:"%d",xml_date:"%m/%d/%Y %H:%i",api_date:"%d-%m-%Y %H:%i",preserve_length:!0,time_step:5,start_on_monday:1,first_hour:0,last_hour:24,readonly:!1,drag_resize:1,drag_move:1,drag_create:1,dblclick_create:1,edit_on_create:1,details_on_create:0,cascade_event_display:!1,cascade_event_count:4,cascade_event_margin:30,multi_day:!0,multi_day_height_limit:0,drag_lightbox:!0,preserve_scroll:!0,select:!0,server_utc:!1,touch:!0,touch_tip:!0,touch_drag:500,quick_info_detached:!0,positive_closing:!1,icons_edit:["icon_save","icon_cancel"],icons_select:["icon_details","icon_edit","icon_delete"],buttons_left:["dhx_save_btn","dhx_cancel_btn"],buttons_right:["dhx_delete_btn"],lightbox:{sections:[{name:"description",height:200,map_to:"text",type:"textarea",focus:!0},{name:"time",height:72,type:"time",map_to:"auto"}]},highlight_displayed_event:!0,left_border:!1},scheduler.templates={},scheduler.init_templates=function(){var e=scheduler.locale.labels;e.dhx_save_btn=e.icon_save,e.dhx_cancel_btn=e.icon_cancel,e.dhx_delete_btn=e.icon_delete;var t=scheduler.date.date_to_str,s=scheduler.config,i=function(e,t){for(var s in t)e[s]||(e[s]=t[s])};i(scheduler.templates,{day_date:t(s.default_date),month_date:t(s.month_date),week_date:function(e,t){return scheduler.templates.day_date(e)+" &ndash; "+scheduler.templates.day_date(scheduler.date.add(t,-1,"day"))},day_scale_date:t(s.default_date),month_scale_date:t(s.week_date),week_scale_date:t(s.day_date),hour_scale:t(s.hour_date),time_picker:t(s.hour_date),event_date:t(s.hour_date),month_day:t(s.month_day),xml_date:scheduler.date.str_to_date(s.xml_date,s.server_utc),load_format:t(s.load_date,s.server_utc),xml_format:t(s.xml_date,s.server_utc),api_date:scheduler.date.str_to_date(s.api_date),event_header:function(e,t){return scheduler.templates.event_date(e)+" - "+scheduler.templates.event_date(t)},event_text:function(e,t,s){return s.text},event_class:function(){return""},month_date_class:function(){return""},week_date_class:function(){return""},event_bar_date:function(e){return scheduler.templates.event_date(e)+" "},event_bar_text:function(e,t,s){return s.text},month_events_link:function(e,t){return"<a>View more("+t+" events)</a>"}}),this.callEvent("onTemplatesReady",[])},scheduler.uid=function(){return this._seed||(this._seed=(new Date).valueOf()),this._seed++},scheduler._events={},scheduler.clearAll=function(){this._events={},this._loaded={},this.clear_view(),this.callEvent("onClearAll",[])
},scheduler.addEvent=function(e,t,s,i,r){if(!arguments.length)return this.addEventNow();var n=e;1!=arguments.length&&(n=r||{},n.start_date=e,n.end_date=t,n.text=s,n.id=i),n.id=n.id||scheduler.uid(),n.text=n.text||"","string"==typeof n.start_date&&(n.start_date=this.templates.api_date(n.start_date)),"string"==typeof n.end_date&&(n.end_date=this.templates.api_date(n.end_date));var a=6e4*(this.config.event_duration||this.config.time_step);n.start_date.valueOf()==n.end_date.valueOf()&&n.end_date.setTime(n.end_date.valueOf()+a),n._timed=this.isOneDayEvent(n);var d=!this._events[n.id];return this._events[n.id]=n,this.event_updated(n),this._loading||this.callEvent(d?"onEventAdded":"onEventChanged",[n.id,n]),n.id},scheduler.deleteEvent=function(e,t){var s=this._events[e];(t||this.callEvent("onBeforeEventDelete",[e,s])&&this.callEvent("onConfirmedBeforeEventDelete",[e,s]))&&(s&&(delete this._events[e],this.unselect(e),this.event_updated(s)),this.callEvent("onEventDeleted",[e,s]))},scheduler.getEvent=function(e){return this._events[e]},scheduler.setEvent=function(e,t){t.id||(t.id=e),this._events[e]=t},scheduler.for_rendered=function(e,t){for(var s=this._rendered.length-1;s>=0;s--)this._rendered[s].getAttribute("event_id")==e&&t(this._rendered[s],s)},scheduler.changeEventId=function(e,t){if(e!=t){var s=this._events[e];s&&(s.id=t,this._events[t]=s,delete this._events[e]),this.for_rendered(e,function(e){e.setAttribute("event_id",t)}),this._select_id==e&&(this._select_id=t),this._edit_id==e&&(this._edit_id=t),this.callEvent("onEventIdChange",[e,t])}},function(){for(var e=["text","Text","start_date","StartDate","end_date","EndDate"],t=function(e){return function(t){return scheduler.getEvent(t)[e]}},s=function(e){return function(t,s){var i=scheduler.getEvent(t);i[e]=s,i._changed=!0,i._timed=this.isOneDayEvent(i),scheduler.event_updated(i,!0)}},i=0;i<e.length;i+=2)scheduler["getEvent"+e[i+1]]=t(e[i]),scheduler["setEvent"+e[i+1]]=s(e[i])}(),scheduler.event_updated=function(e){this.is_visible_events(e)?this.render_view_data():this.clear_event(e.id)},scheduler.is_visible_events=function(e){return e.start_date<this._max_date&&this._min_date<e.end_date},scheduler.isOneDayEvent=function(e){var t=e.end_date.getDate()-e.start_date.getDate();return t?(0>t&&(t=Math.ceil((e.end_date.valueOf()-e.start_date.valueOf())/864e5)),1==t&&!e.end_date.getHours()&&!e.end_date.getMinutes()&&(e.start_date.getHours()||e.start_date.getMinutes())):e.start_date.getMonth()==e.end_date.getMonth()&&e.start_date.getFullYear()==e.end_date.getFullYear()},scheduler.get_visible_events=function(e){var t=[];for(var s in this._events)this.is_visible_events(this._events[s])&&(!e||this._events[s]._timed)&&this.filter_event(s,this._events[s])&&t.push(this._events[s]);return t},scheduler.filter_event=function(e,t){var s=this["filter_"+this._mode];return s?s(e,t):!0},scheduler._is_main_area_event=function(e){return!!e._timed},scheduler.render_view_data=function(e,t){if(!e){if(this._not_render)return void(this._render_wait=!0);this._render_wait=!1,this.clear_view(),e=this.get_visible_events(!(this._table_view||this.config.multi_day))}for(var s=0,i=e.length;i>s;s++)this._recalculate_timed(e[s]);if(this.config.multi_day&&!this._table_view){for(var r=[],n=[],s=0;s<e.length;s++)this._is_main_area_event(e[s])?r.push(e[s]):n.push(e[s]);this._rendered_location=this._els.dhx_multi_day[0],this._table_view=!0,this.render_data(n,t),this._table_view=!1,this._rendered_location=this._els.dhx_cal_data[0],this._table_view=!1,this.render_data(r,t)}else this._rendered_location=this._els.dhx_cal_data[0],this.render_data(e,t)},scheduler._view_month_day=function(e){var t=scheduler.getActionData(e).date;scheduler.callEvent("onViewMoreClick",[t])&&scheduler.setCurrentView(t,"day")},scheduler._render_month_link=function(e){for(var t=this._rendered_location,s=this._lame_clone(e),i=e._sday;i<e._eday;i++){s._sday=i,s._eday=i+1;var r=scheduler.date,n=scheduler._min_date;n=r.add(n,s._sweek,"week"),n=r.add(n,s._sday,"day");var a=scheduler.getEvents(n,r.add(n,1,"day")).length,d=this._get_event_bar_pos(s),o=d.x2-d.x,l=document.createElement("div");l.onclick=function(e){scheduler._view_month_day(e||event)},l.className="dhx_month_link",l.style.top=d.y+"px",l.style.left=d.x+"px",l.style.width=o+"px",l.innerHTML=scheduler.templates.month_events_link(n,a),this._rendered.push(l),t.appendChild(l)}},scheduler._recalculate_timed=function(e){if(e){if("object"!=typeof e)var t=this._events[e];else var t=e;t&&(t._timed=scheduler.isOneDayEvent(t))}},scheduler.attachEvent("onEventChanged",scheduler._recalculate_timed),scheduler.attachEvent("onEventAdded",scheduler._recalculate_timed),scheduler.render_data=function(e,t){e=this._pre_render_events(e,t);for(var s=0;s<e.length;s++)if(this._table_view)if("month"!=scheduler._mode)this.render_event_bar(e[s]);else{var i=scheduler.config.max_month_events;i!==1*i||e[s]._sorder<i?this.render_event_bar(e[s]):void 0!==i&&e[s]._sorder==i&&scheduler._render_month_link(e[s])}else this.render_event(e[s])},scheduler._pre_render_events=function(e,t){var s=this.xy.bar_height,i=this._colsS.heights,r=this._colsS.heights=[0,0,0,0,0,0,0],n=this._els.dhx_cal_data[0];if(e=this._table_view?this._pre_render_events_table(e,t):this._pre_render_events_line(e,t),this._table_view)if(t)this._colsS.heights=i;else{var a=n.firstChild;if(a.rows){for(var d=0;d<a.rows.length;d++){if(r[d]++,r[d]*s>this._colsS.height-22){var o=a.rows[d].cells,l=this._colsS.height-22;1*this.config.max_month_events!==this.config.max_month_events||r[d]<=this.config.max_month_events?l=r[d]*s:(this.config.max_month_events+1)*s>this._colsS.height-22&&(l=(this.config.max_month_events+1)*s);for(var h=0;h<o.length;h++)o[h].childNodes[1].style.height=l+"px";r[d]=(r[d-1]||0)+o[0].offsetHeight}r[d]=(r[d-1]||0)+a.rows[d].cells[0].offsetHeight}if(r.unshift(0),a.parentNode.offsetHeight<a.parentNode.scrollHeight&&!a._h_fix&&scheduler.xy.scroll_width){for(var d=0;d<a.rows.length;d++){for(var _=6;this._ignores[_];)_--;var c=a.rows[d].cells[_].childNodes[0],u=c.offsetWidth-scheduler.xy.scroll_width+"px";c.style.width=u,c.nextSibling.style.width=u}a._h_fix=!0}}else if(e.length||"visible"!=this._els.dhx_multi_day[0].style.visibility||(r[0]=-1),e.length||-1==r[0]){var f=(a.parentNode.childNodes,(r[0]+1)*s+1),p=f,m=f+"px";this.config.multi_day_height_limit&&(p=Math.min(f,this.config.multi_day_height_limit),m=p+"px"),n.style.top=this._els.dhx_cal_navline[0].offsetHeight+this._els.dhx_cal_header[0].offsetHeight+p+"px",n.style.height=this._obj.offsetHeight-parseInt(n.style.top,10)-(this.xy.margin_top||0)+"px";var g=this._els.dhx_multi_day[0];g.style.height=m,g.style.visibility=-1==r[0]?"hidden":"visible";var v=this._els.dhx_multi_day[1];v.style.height=m,v.style.visibility=-1==r[0]?"hidden":"visible",v.className=r[0]?"dhx_multi_day_icon":"dhx_multi_day_icon_small",this._dy_shift=(r[0]+1)*s,r[0]=0,p!=f&&(n.style.top=parseInt(n.style.top)+2+"px",g.style.overflowY="auto",g.style.width=parseInt(g.style.width)-2+"px",v.style.position="fixed",v.style.top="",v.style.left="")}}return e},scheduler._get_event_sday=function(e){return Math.floor((e.start_date.valueOf()-this._min_date.valueOf())/864e5)},scheduler._get_event_mapped_end_date=function(e){var t=e.end_date;if(this.config.separate_short_events){var s=(e.end_date-e.start_date)/6e4;s<this._min_mapped_duration&&(t=this.date.add(t,this._min_mapped_duration-s,"minute"))}return t},scheduler._pre_render_events_line=function(e,t){e.sort(function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e.id>t.id?1:-1:e.start_date>t.start_date?1:-1});var s=[],i=[];this._min_mapped_duration=Math.ceil(60*this.xy.min_event_height/this.config.hour_size_px);for(var r=0;r<e.length;r++){var n=e[r],a=n.start_date,d=n.end_date,o=a.getHours(),l=d.getHours();if(n._sday=this._get_event_sday(n),this._ignores[n._sday])e.splice(r,1),r--;else{if(s[n._sday]||(s[n._sday]=[]),!t){n._inner=!1;for(var h=s[n._sday];h.length;){var _=h[h.length-1],c=this._get_event_mapped_end_date(_);if(!(c.valueOf()<=n.start_date.valueOf()))break;h.splice(h.length-1,1)}for(var u=!1,f=0;f<h.length;f++){var _=h[f],c=this._get_event_mapped_end_date(_);if(c.valueOf()<=n.start_date.valueOf()){u=!0,n._sorder=_._sorder,h.splice(f,1),n._inner=!0;break}}if(h.length&&(h[h.length-1]._inner=!0),!u)if(h.length)if(h.length<=h[h.length-1]._sorder){if(h[h.length-1]._sorder)for(f=0;f<h.length;f++){for(var p=!1,m=0;m<h.length;m++)if(h[m]._sorder==f){p=!0;break}if(!p){n._sorder=f;break}}else n._sorder=0;n._inner=!0}else{var g=h[0]._sorder;for(f=1;f<h.length;f++)h[f]._sorder>g&&(g=h[f]._sorder);n._sorder=g+1,n._inner=!1}else n._sorder=0;h.push(n),h.length>(h.max_count||0)?(h.max_count=h.length,n._count=h.length):n._count=n._count?n._count:1}(o<this.config.first_hour||l>=this.config.last_hour)&&(i.push(n),e[r]=n=this._copy_event(n),o<this.config.first_hour&&(n.start_date.setHours(this.config.first_hour),n.start_date.setMinutes(0)),l>=this.config.last_hour&&(n.end_date.setMinutes(0),n.end_date.setHours(this.config.last_hour)),n.start_date>n.end_date||o==this.config.last_hour)&&(e.splice(r,1),r--)}}if(!t){for(var r=0;r<e.length;r++)e[r]._count=s[e[r]._sday].max_count;for(var r=0;r<i.length;r++)i[r]._count=s[i[r]._sday].max_count}return e},scheduler._time_order=function(e){e.sort(function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e._timed&&!t._timed?1:!e._timed&&t._timed?-1:e.id>t.id?1:-1:e.start_date>t.start_date?1:-1})},scheduler._pre_render_events_table=function(e,t){this._time_order(e);for(var s,i=[],r=[[],[],[],[],[],[],[]],n=this._colsS.heights,a=this._cols.length,d={},o=0;o<e.length;o++){var l=e[o],h=l.id;d[h]||(d[h]={first_chunk:!0,last_chunk:!0});var _=d[h],c=s||l.start_date,u=l.end_date;c<this._min_date&&(_.first_chunk=!1,c=this._min_date),u>this._max_date&&(_.last_chunk=!1,u=this._max_date);var f=this.locate_holder_day(c,!1,l);if(l._sday=f%a,!this._ignores[l._sday]||!l._timed){var p=this.locate_holder_day(u,!0,l)||a;l._eday=p%a||a,l._length=p-f,l._sweek=Math.floor((this._correct_shift(c.valueOf(),1)-this._min_date.valueOf())/(864e5*a));var m,g=r[l._sweek];for(m=0;m<g.length&&!(g[m]._eday<=l._sday);m++);if(l._sorder&&t||(l._sorder=m),l._sday+l._length<=a)s=null,i.push(l),g[m]=l,n[l._sweek]=g.length-1,l._first_chunk=_.first_chunk,l._last_chunk=_.last_chunk;else{var v=this._copy_event(l);v.id=l.id,v._length=a-l._sday,v._eday=a,v._sday=l._sday,v._sweek=l._sweek,v._sorder=l._sorder,v.end_date=this.date.add(c,v._length,"day"),v._first_chunk=_.first_chunk,_.first_chunk&&(_.first_chunk=!1),i.push(v),g[m]=v,s=v.end_date,n[l._sweek]=g.length-1,o--}}}return i},scheduler._copy_dummy=function(){var e=new Date(this.start_date),t=new Date(this.end_date);this.start_date=e,this.end_date=t},scheduler._copy_event=function(e){return this._copy_dummy.prototype=e,new this._copy_dummy},scheduler._rendered=[],scheduler.clear_view=function(){for(var e=0;e<this._rendered.length;e++){var t=this._rendered[e];t.parentNode&&t.parentNode.removeChild(t)}this._rendered=[]},scheduler.updateEvent=function(e){var t=this.getEvent(e);this.clear_event(e),t&&this.is_visible_events(t)&&this.filter_event(e,t)&&(this._table_view||this.config.multi_day||t._timed)&&(this.config.update_render?this.render_view_data():this.render_view_data([t],!0))},scheduler.clear_event=function(e){this.for_rendered(e,function(e,t){e.parentNode&&e.parentNode.removeChild(e),scheduler._rendered.splice(t,1)})},scheduler.render_event=function(e){var t=scheduler.xy.menu_width,s=this.config.use_select_menu_space?0:t;if(!(e._sday<0)){var i=scheduler.locate_holder(e._sday);if(i){var r=60*e.start_date.getHours()+e.start_date.getMinutes(),n=60*e.end_date.getHours()+e.end_date.getMinutes()||60*scheduler.config.last_hour,a=e._count||1,d=e._sorder||0,o=Math.round((60*r*1e3-60*this.config.first_hour*60*1e3)*this.config.hour_size_px/36e5)%(24*this.config.hour_size_px),l=Math.max(scheduler.xy.min_event_height,(n-r)*this.config.hour_size_px/60),h=Math.floor((i.clientWidth-s)/a),_=d*h+1;if(e._inner||(h*=a-d),this.config.cascade_event_display){var c=this.config.cascade_event_count,u=this.config.cascade_event_margin;_=d%c*u;var f=e._inner?(a-d-1)%c*u/2:0;h=Math.floor(i.clientWidth-s-_-f)}var p=this._render_v_bar(e.id,s+_,o,h,l,e._text_style,scheduler.templates.event_header(e.start_date,e.end_date,e),scheduler.templates.event_text(e.start_date,e.end_date,e));if(this._rendered.push(p),i.appendChild(p),_=_+parseInt(i.style.left,10)+s,this._edit_id==e.id){p.style.zIndex=1,h=Math.max(h-4,scheduler.xy.editor_width),p=document.createElement("DIV"),p.setAttribute("event_id",e.id),this.set_xy(p,h,l-20,_,o+14),p.className="dhx_cal_editor";var m=document.createElement("DIV");this.set_xy(m,h-6,l-26),m.style.cssText+=";margin:2px 2px 2px 2px;overflow:hidden;",p.appendChild(m),this._els.dhx_cal_data[0].appendChild(p),this._rendered.push(p),m.innerHTML="<textarea class='dhx_cal_editor'>"+e.text+"</textarea>",this._quirks7&&(m.firstChild.style.height=l-12+"px"),this._editor=m.firstChild,this._editor.onkeydown=function(e){if((e||event).shiftKey)return!0;var t=(e||event).keyCode;t==scheduler.keys.edit_save&&scheduler.editStop(!0),t==scheduler.keys.edit_cancel&&scheduler.editStop(!1)},this._editor.onselectstart=function(e){return(e||event).cancelBubble=!0},scheduler._focus(m.firstChild,!0),this._els.dhx_cal_data[0].scrollLeft=0}if(0!==this.xy.menu_width&&this._select_id==e.id){this.config.cascade_event_display&&this._drag_mode&&(p.style.zIndex=1);for(var g=this.config["icons_"+(this._edit_id==e.id?"edit":"select")],v="",x=e.color?"background-color: "+e.color+";":"",y=e.textColor?"color: "+e.textColor+";":"",b=0;b<g.length;b++)v+="<div class='dhx_menu_icon "+g[b]+"' style='"+x+y+"' title='"+this.locale.labels[g[b]]+"'></div>";var w=this._render_v_bar(e.id,_-t+1,o,t,20*g.length+26-2,"","<div style='"+x+y+"' class='dhx_menu_head'></div>",v,!0);w.style.left=_-t+1,this._els.dhx_cal_data[0].appendChild(w),this._rendered.push(w)}}}},scheduler._render_v_bar=function(e,t,s,i,r,n,a,d,o){var l=document.createElement("DIV"),h=this.getEvent(e),_=o?"dhx_cal_event dhx_cal_select_menu":"dhx_cal_event",c=scheduler.templates.event_class(h.start_date,h.end_date,h);c&&(_=_+" "+c);var u=h.color?"background:"+h.color+";":"",f=h.textColor?"color:"+h.textColor+";":"",p='<div event_id="'+e+'" class="'+_+'" style="position:absolute; top:'+s+"px; left:"+t+"px; width:"+(i-4)+"px; height:"+r+"px;"+(n||"")+'"></div>';l.innerHTML=p;var m=l.cloneNode(!0).firstChild;if(!o&&scheduler.renderEvent(m,h))return m;m=l.firstChild;var g='<div class="dhx_event_move dhx_header" style=" width:'+(i-6)+"px;"+u+'" >&nbsp;</div>';g+='<div class="dhx_event_move dhx_title" style="'+u+f+'">'+a+"</div>",g+='<div class="dhx_body" style=" width:'+(i-(this._quirks?4:14))+"px; height:"+(r-(this._quirks?20:30)+1)+"px;"+u+f+'">'+d+"</div>";var v="dhx_event_resize dhx_footer";return o&&(v="dhx_resize_denied "+v),g+='<div class="'+v+'" style=" width:'+(i-8)+"px;"+(o?" margin-top:-1px;":"")+u+f+'" ></div>',m.innerHTML=g,m},scheduler.renderEvent=function(){return!1},scheduler.locate_holder=function(e){return"day"==this._mode?this._els.dhx_cal_data[0].firstChild:this._els.dhx_cal_data[0].childNodes[e]},scheduler.locate_holder_day=function(e,t){var s=Math.floor((this._correct_shift(e,1)-this._min_date)/864e5);return t&&this.date.time_part(e)&&s++,s},scheduler._get_dnd_order=function(e,t,s){if(!this._drag_event)return e;this._drag_event._orig_sorder?e=this._drag_event._orig_sorder:this._drag_event._orig_sorder=e;for(var i=t*e;i+t>s;)e--,i-=t;return e},scheduler._get_event_bar_pos=function(e){var t=this._colsS[e._sday],s=this._colsS[e._eday];s==t&&(s=this._colsS[e._eday+1]);var i=this.xy.bar_height,r=e._sorder;if(e.id==this._drag_id){var n=this._colsS.heights[e._sweek+1]-this._colsS.heights[e._sweek]-22;r=scheduler._get_dnd_order(r,i,n)}var a=r*i,d=this._colsS.heights[e._sweek]+(this._colsS.height?this.xy.month_scale_height+2:2)+a;return{x:t,x2:s,y:d}},scheduler.render_event_bar=function(e){var t=this._rendered_location,s=this._get_event_bar_pos(e),i=s.y,r=s.x,n=s.x2;if(n){var a=document.createElement("DIV"),d="dhx_cal_event_clear";e._timed||(d="dhx_cal_event_line",e.hasOwnProperty("_first_chunk")&&e._first_chunk&&(d+=" dhx_cal_event_line_start"),e.hasOwnProperty("_last_chunk")&&e._last_chunk&&(d+=" dhx_cal_event_line_end"));var o=scheduler.templates.event_class(e.start_date,e.end_date,e);o&&(d=d+" "+o);var l=e.color?"background:"+e.color+";":"",h=e.textColor?"color:"+e.textColor+";":"",_='<div event_id="'+e.id+'" class="'+d+'" style="position:absolute; top:'+i+"px; left:"+r+"px; width:"+(n-r-15)+"px;"+h+l+(e._text_style||"")+'">';e=scheduler.getEvent(e.id),e._timed&&(_+=scheduler.templates.event_bar_date(e.start_date,e.end_date,e)),_+=scheduler.templates.event_bar_text(e.start_date,e.end_date,e)+"</div>",_+="</div>",a.innerHTML=_,this._rendered.push(a.firstChild),t.appendChild(a.firstChild)}},scheduler._locate_event=function(e){for(var t=null;e&&!t&&e.getAttribute;)t=e.getAttribute("event_id"),e=e.parentNode;return t},scheduler.edit=function(e){this._edit_id!=e&&(this.editStop(!1,e),this._edit_id=e,this.updateEvent(e))},scheduler.editStop=function(e,t){if(!t||this._edit_id!=t){var s=this.getEvent(this._edit_id);s&&(e&&(s.text=this._editor.value),this._edit_id=null,this._editor=null,this.updateEvent(s.id),this._edit_stop_event(s,e))}},scheduler._edit_stop_event=function(e,t){this._new_event?(t?this.callEvent("onEventAdded",[e.id,e]):e&&this.deleteEvent(e.id,!0),this._new_event=null):t&&this.callEvent("onEventChanged",[e.id,e])},scheduler.getEvents=function(e,t){var s=[];for(var i in this._events){var r=this._events[i];r&&(!e&&!t||r.start_date<t&&r.end_date>e)&&s.push(r)}return s},scheduler.getRenderedEvent=function(e){if(e){for(var t=scheduler._rendered,s=0;s<t.length;s++){var i=t[s];if(i.getAttribute("event_id")==e)return i}return null}},scheduler.showEvent=function(e,t){var s="number"==typeof e||"string"==typeof e?scheduler.getEvent(e):e;if(t=t||scheduler._mode,s&&(!this.checkEvent("onBeforeEventDisplay")||this.callEvent("onBeforeEventDisplay",[s,t]))){var i=scheduler.config.scroll_hour;scheduler.config.scroll_hour=s.start_date.getHours();var r=scheduler.config.preserve_scroll;scheduler.config.preserve_scroll=!1;var n=s.color,a=s.textColor;scheduler.config.highlight_displayed_event&&(s.color=scheduler.config.displayed_event_color,s.textColor=scheduler.config.displayed_event_text_color),scheduler.setCurrentView(new Date(s.start_date),t),s.color=n,s.textColor=a,scheduler.config.scroll_hour=i,scheduler.config.preserve_scroll=r,scheduler.matrix&&scheduler.matrix[t]&&(scheduler._els.dhx_cal_data[0].scrollTop=getAbsoluteTop(scheduler.getRenderedEvent(s.id))-getAbsoluteTop(scheduler._els.dhx_cal_data[0])-20),scheduler.callEvent("onAfterEventDisplay",[s,t])}},scheduler._loaded={},scheduler._load=function(e,t){if(e=e||this._load_url){e+=(-1==e.indexOf("?")?"?":"&")+"timeshift="+(new Date).getTimezoneOffset(),this.config.prevent_cache&&(e+="&uid="+this.uid());var s;if(t=t||this._date,this._load_mode){var i=this.templates.load_format;for(t=this.date[this._load_mode+"_start"](new Date(t.valueOf()));t>this._min_date;)t=this.date.add(t,-1,this._load_mode);s=t;for(var r=!0;s<this._max_date;)s=this.date.add(s,1,this._load_mode),this._loaded[i(t)]&&r?t=this.date.add(t,1,this._load_mode):r=!1;var n=s;do s=n,n=this.date.add(s,-1,this._load_mode);while(n>t&&this._loaded[i(n)]);if(t>=s)return!1;for(dhtmlxAjax.get(e+"&from="+i(t)+"&to="+i(s),function(e){scheduler.on_load(e)});s>t;)this._loaded[i(t)]=!0,t=this.date.add(t,1,this._load_mode)}else dhtmlxAjax.get(e,function(e){scheduler.on_load(e)});return this.callEvent("onXLS",[]),!0}},scheduler.on_load=function(e){var t;t=this._process&&"xml"!=this._process?this[this._process].parse(e.xmlDoc.responseText):this._magic_parser(e),scheduler._process_loading(t),this.callEvent("onXLE",[])},scheduler._process_loading=function(e){this._loading=!0,this._not_render=!0;for(var t=0;t<e.length;t++)this.callEvent("onEventLoading",[e[t]])&&this.addEvent(e[t]);this._not_render=!1,this._render_wait&&this.render_view_data(),this._loading=!1,this._after_call&&this._after_call(),this._after_call=null},scheduler._init_event=function(e){e.text=e.text||e._tagvalue||"",e.start_date=scheduler._init_date(e.start_date),e.end_date=scheduler._init_date(e.end_date)},scheduler._init_date=function(e){return e?"string"==typeof e?scheduler.templates.xml_date(e):new Date(e):null},scheduler.json={},scheduler.json.parse=function(data){"string"==typeof data&&(scheduler._temp=eval("("+data+")"),data=scheduler._temp?scheduler._temp.data||scheduler._temp.d||scheduler._temp:[]),data.dhx_security&&(dhtmlx.security_key=data.dhx_security);var collections=scheduler._temp&&scheduler._temp.collections?scheduler._temp.collections:{},collections_loaded=!1;for(var key in collections)if(collections.hasOwnProperty(key)){collections_loaded=!0;var collection=collections[key],arr=scheduler.serverList[key];if(!arr)continue;arr.splice(0,arr.length);for(var j=0;j<collection.length;j++){var option=collection[j],obj={key:option.value,label:option.label};for(var option_key in option)if(option.hasOwnProperty(option_key)){if("value"==option_key||"label"==option_key)continue;obj[option_key]=option[option_key]}arr.push(obj)}}collections_loaded&&scheduler.callEvent("onOptionsLoad",[]);for(var evs=[],i=0;i<data.length;i++){var event=data[i];scheduler._init_event(event),evs.push(event)}return evs},scheduler.parse=function(e,t){this._process=t,this.on_load({xmlDoc:{responseText:e}})},scheduler.load=function(e,t){"string"==typeof t&&(this._process=t,t=arguments[2]),this._load_url=e,this._after_call=t,this._load(e,this._date)},scheduler.setLoadMode=function(e){"all"==e&&(e=""),this._load_mode=e},scheduler.serverList=function(e,t){return this.serverList[e]=t?t.slice(0):this.serverList[e]||[]},scheduler._userdata={},scheduler._magic_parser=function(e){var t;if(!e.getXMLTopNode){var s=e.xmlDoc.responseText;e=new dtmlXMLLoaderObject(function(){}),e.loadXMLString(s)}if(t=e.getXMLTopNode("data"),"data"!=t.tagName)return[];var i=t.getAttribute("dhx_security");i&&(dhtmlx.security_key=i);for(var r=e.doXPath("//coll_options"),n=0;n<r.length;n++){var a=r[n].getAttribute("for"),d=this.serverList[a];if(d){d.splice(0,d.length);for(var o=e.doXPath(".//item",r[n]),l=0;l<o.length;l++){for(var h=o[l],_=h.attributes,c={key:o[l].getAttribute("value"),label:o[l].getAttribute("label")},u=0;u<_.length;u++){var f=_[u];"value"!=f.nodeName&&"label"!=f.nodeName&&(c[f.nodeName]=f.nodeValue)}d.push(c)}}}r.length&&scheduler.callEvent("onOptionsLoad",[]);for(var p=e.doXPath("//userdata"),n=0;n<p.length;n++){var m=this._xmlNodeToJSON(p[n]);this._userdata[m.name]=m.text}var g=[];t=e.doXPath("//event");for(var n=0;n<t.length;n++){var v=g[n]=this._xmlNodeToJSON(t[n]);scheduler._init_event(v)}return g},scheduler._xmlNodeToJSON=function(e){for(var t={},s=0;s<e.attributes.length;s++)t[e.attributes[s].name]=e.attributes[s].value;for(var s=0;s<e.childNodes.length;s++){var i=e.childNodes[s];1==i.nodeType&&(t[i.tagName]=i.firstChild?i.firstChild.nodeValue:"")}return t.text||(t.text=e.firstChild?e.firstChild.nodeValue:""),t},scheduler.attachEvent("onXLS",function(){if(this.config.show_loading===!0){var e;e=this.config.show_loading=document.createElement("DIV"),e.className="dhx_loading",e.style.left=Math.round((this._x-128)/2)+"px",e.style.top=Math.round((this._y-15)/2)+"px",this._obj.appendChild(e)}}),scheduler.attachEvent("onXLE",function(){var e=this.config.show_loading;e&&"object"==typeof e&&(this._obj.removeChild(e),this.config.show_loading=!0)}),scheduler.ical={parse:function(e){var t=e.match(RegExp(this.c_start+"[^\f]*"+this.c_end,""));if(t.length){t[0]=t[0].replace(/[\r\n]+(?=[a-z \t])/g," "),t[0]=t[0].replace(/\;[^:\r\n]*:/g,":");for(var s,i=[],r=RegExp("(?:"+this.e_start+")([^\f]*?)(?:"+this.e_end+")","g");s=r.exec(t);){for(var n,a={},d=/[^\r\n]+[\r\n]+/g;n=d.exec(s[1]);)this.parse_param(n.toString(),a);a.uid&&!a.id&&(a.id=a.uid),i.push(a)}return i}},parse_param:function(e,t){var s=e.indexOf(":");if(-1!=s){var i=e.substr(0,s).toLowerCase(),r=e.substr(s+1).replace(/\\\,/g,",").replace(/[\r\n]+$/,"");"summary"==i?i="text":"dtstart"==i?(i="start_date",r=this.parse_date(r,0,0)):"dtend"==i&&(i="end_date",r=this.parse_date(r,0,0)),t[i]=r}},parse_date:function(e,t,s){var i=e.split("T");i[1]&&(t=i[1].substr(0,2),s=i[1].substr(2,2));var r=i[0].substr(0,4),n=parseInt(i[0].substr(4,2),10)-1,a=i[0].substr(6,2);return scheduler.config.server_utc&&!i[1]?new Date(Date.UTC(r,n,a,t,s)):new Date(r,n,a,t,s)},c_start:"BEGIN:VCALENDAR",e_start:"BEGIN:VEVENT",e_end:"END:VEVENT",c_end:"END:VCALENDAR"},scheduler._lightbox_controls={},scheduler.formSection=function(e){var t=this.config.lightbox.sections,s=0;for(s;s<t.length&&t[s].name!=e;s++);var i=t[s];scheduler._lightbox||scheduler.getLightbox();var r=document.getElementById(i.id),n=r.nextSibling,a={section:i,header:r,node:n,getValue:function(e){return scheduler.form_blocks[i.type].get_value(n,e||{},i)},setValue:function(e,t){return scheduler.form_blocks[i.type].set_value(n,e,t||{},i)}},d=scheduler._lightbox_controls["get_"+i.type+"_control"];return d?d(a):a},scheduler._lightbox_controls.get_template_control=function(e){return e.control=e.node,e},scheduler._lightbox_controls.get_select_control=function(e){return e.control=e.node.getElementsByTagName("select")[0],e},scheduler._lightbox_controls.get_textarea_control=function(e){return e.control=e.node.getElementsByTagName("textarea")[0],e},scheduler._lightbox_controls.get_time_control=function(e){return e.control=e.node.getElementsByTagName("select"),e},scheduler.form_blocks={template:{render:function(e){var t=(e.height||"30")+"px";return"<div class='dhx_cal_ltext dhx_cal_template' style='height:"+t+";'></div>"},set_value:function(e,t){e.innerHTML=t||""},get_value:function(e){return e.innerHTML||""},focus:function(){}},textarea:{render:function(e){var t=(e.height||"130")+"px";return"<div class='dhx_cal_ltext' style='height:"+t+";'><textarea></textarea></div>"},set_value:function(e,t){e.firstChild.value=t||""},get_value:function(e){return e.firstChild.value},focus:function(e){var t=e.firstChild;scheduler._focus(t,!0)}},select:{render:function(e){for(var t=(e.height||"23")+"px",s="<div class='dhx_cal_ltext' style='height:"+t+";'><select style='width:100%;'>",i=0;i<e.options.length;i++)s+="<option value='"+e.options[i].key+"'>"+e.options[i].label+"</option>";return s+="</select></div>"},set_value:function(e,t,s,i){var r=e.firstChild;!r._dhx_onchange&&i.onchange&&(r.onchange=i.onchange,r._dhx_onchange=!0),"undefined"==typeof t&&(t=(r.options[0]||{}).value),r.value=t||""},get_value:function(e){return e.firstChild.value},focus:function(e){var t=e.firstChild;scheduler._focus(t,!0)}},time:{render:function(e){e.time_format||(e.time_format=["%H:%i","%d","%m","%Y"]),e._time_format_order={};var t=e.time_format,s=scheduler.config,i=this.date.date_part(scheduler._currentDate()),r=1440,n=0;scheduler.config.limit_time_select&&(r=60*s.last_hour+1,n=60*s.first_hour,i.setHours(s.first_hour));for(var a="",d=0;d<t.length;d++){var o=t[d];switch(d>0&&(a+=" "),o){case"%Y":e._time_format_order[3]=d,a+="<select>";for(var l=i.getFullYear()-5,h=0;10>h;h++)a+="<option value='"+(l+h)+"'>"+(l+h)+"</option>";a+="</select> ";break;case"%m":e._time_format_order[2]=d,a+="<select>";for(var h=0;12>h;h++)a+="<option value='"+h+"'>"+this.locale.date.month_full[h]+"</option>";a+="</select>";break;case"%d":e._time_format_order[1]=d,a+="<select>";for(var h=1;32>h;h++)a+="<option value='"+h+"'>"+h+"</option>";a+="</select>";break;case"%H:%i":e._time_format_order[0]=d,a+="<select>";var h=n,_=i.getDate();for(e._time_values=[];r>h;){var c=this.templates.time_picker(i);a+="<option value='"+h+"'>"+c+"</option>",e._time_values.push(h),i.setTime(i.valueOf()+60*this.config.time_step*1e3);var u=i.getDate()!=_?1:0;h=24*u*60+60*i.getHours()+i.getMinutes()}a+="</select>"}}return"<div style='height:30px;padding-top:0px;font-size:inherit;' class='dhx_section_time'>"+a+"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"+a+"</div>"},set_value:function(e,t,s,i){function r(){var e,t=scheduler.getState().date;switch(o.length){case 4:e=new Date(d[o[3]].value,d[o[2]].value,d[o[1]].value,0,d[o[0]].value);break;case 3:e=new Date(t.getFullYear(),d[o[2]].value,d[o[1]].value,0,d[o[0]].value);break;case 2:e=new Date(t.getFullYear(),t.getMonth(),d[o[1]].value,0,d[o[0]].value);default:e=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,d[o[0]].value)}var s=new Date(e.getTime()+60*scheduler.config.event_duration*1e3);n(d,i.time_format.length,s)}function n(e,t,s){for(var r=i._time_values,n=60*s.getHours()+s.getMinutes(),a=n,d=!1,l=0;l<r.length;l++){var h=r[l];if(h===n){d=!0;break}n>h&&(a=h)}e[t+o[0]].value=d?n:a,d||a||(e[t+o[0]].selectedIndex=-1),void 0!==o[1]&&(e[t+o[1]].value=s.getDate()),void 0!==o[2]&&(e[t+o[2]].value=s.getMonth()),void 0!==o[3]&&(e[t+o[3]].value=s.getFullYear())}var a=scheduler.config,d=e.getElementsByTagName("select"),o=i._time_format_order;if(a.full_day){if(!e._full_day){var l="<label class='dhx_fullday'><input type='checkbox' name='full_day' value='true'> "+scheduler.locale.labels.full_day+"&nbsp;</label></input>";scheduler.config.wide_form||(l=e.previousSibling.innerHTML+l),e.previousSibling.innerHTML=l,e._full_day=!0}var h=e.previousSibling.getElementsByTagName("input")[0];h.checked=0===scheduler.date.time_part(s.start_date)&&0===scheduler.date.time_part(s.end_date),d[o[0]].disabled=h.checked,d[o[0]+d.length/2].disabled=h.checked,h.onclick=function(){if(h.checked){var t={};scheduler.form_blocks.time.get_value(e,t,i);var r=scheduler.date.date_part(t.start_date),a=scheduler.date.date_part(t.end_date);(+a==+r||+a>=+r&&(0!=s.end_date.getHours()||0!=s.end_date.getMinutes()))&&(a=scheduler.date.add(a,1,"day"))}d[o[0]].disabled=h.checked,d[o[0]+d.length/2].disabled=h.checked,n(d,0,r||s.start_date),n(d,i.time_format.length+1,a||s.end_date)}}if(a.auto_end_date&&a.event_duration)for(var _=0,c=d.length;c>_;_++)d[_].onchange=r;n(d,0,s.start_date),n(d,i.time_format.length,s.end_date)},get_value:function(e,t,i){s=e.getElementsByTagName("select");var r=i._time_format_order,n=scheduler.getState().date;switch(r.length){case 4:t.start_date=new Date(s[r[3]].value,s[r[2]].value,s[r[1]].value,0,s[r[0]].value),t.end_date=new Date(s[r[3]+4].value,s[r[2]+4].value,s[r[1]+4].value,0,s[r[0]+4].value);break;case 3:t.start_date=new Date(n.getFullYear(),s[r[2]].value,s[r[1]].value,0,s[r[0]].value),t.end_date=new Date(n.getFullYear(),s[r[2]+3].value,s[r[1]+3].value,0,s[r[0]+3].value);break;case 2:t.start_date=new Date(n.getFullYear(),n.getMonth(),s[r[1]].value,0,s[r[0]].value),t.end_date=new Date(n.getFullYear(),n.getMonth(),s[r[1]+2].value,0,s[r[0]+2].value);break;default:t.start_date=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,s[r[0]].value),t.end_date=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,s[r[0]+1].value)}return t.end_date<=t.start_date&&(t.end_date=scheduler.date.add(t.start_date,scheduler.config.time_step,"minute")),{start_date:new Date(t.start_date),end_date:new Date(t.end_date)}},focus:function(e){scheduler._focus(e.getElementsByTagName("select")[0])}}},scheduler.showCover=function(e){if(e){e.style.display="block";var t=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,s=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,i=window.innerHeight||document.documentElement.clientHeight;e.style.top=t?Math.round(t+Math.max((i-e.offsetHeight)/2,0))+"px":Math.round(Math.max((i-e.offsetHeight)/2,0)+9)+"px",e.style.left=document.documentElement.scrollWidth>document.body.offsetWidth?Math.round(s+(document.body.offsetWidth-e.offsetWidth)/2)+"px":Math.round((document.body.offsetWidth-e.offsetWidth)/2)+"px"}this.show_cover()},scheduler.showLightbox=function(e){if(e){if(!this.callEvent("onBeforeLightbox",[e]))return void(this._new_event&&(this._new_event=null));
var t=this.getLightbox();this.showCover(t),this._fill_lightbox(e,t),this.callEvent("onLightbox",[e])}},scheduler._fill_lightbox=function(e,t){var s=this.getEvent(e),i=t.getElementsByTagName("span");scheduler.templates.lightbox_header?(i[1].innerHTML="",i[2].innerHTML=scheduler.templates.lightbox_header(s.start_date,s.end_date,s)):(i[1].innerHTML=this.templates.event_header(s.start_date,s.end_date,s),i[2].innerHTML=(this.templates.event_bar_text(s.start_date,s.end_date,s)||"").substr(0,70));for(var r=this.config.lightbox.sections,n=0;n<r.length;n++){var a=r[n],d=document.getElementById(a.id).nextSibling,o=this.form_blocks[a.type],l=void 0!==s[a.map_to]?s[a.map_to]:a.default_value;o.set_value.call(this,d,l,s,a),r[n].focus&&o.focus.call(this,d)}scheduler._lightbox_id=e},scheduler._lightbox_out=function(e){for(var t=this.config.lightbox.sections,s=0;s<t.length;s++){var i=document.getElementById(t[s].id);i=i?i.nextSibling:i;var r=this.form_blocks[t[s].type],n=r.get_value.call(this,i,e,t[s]);"auto"!=t[s].map_to&&(e[t[s].map_to]=n)}return e},scheduler._empty_lightbox=function(e){{var t=scheduler._lightbox_id,s=this.getEvent(t);this.getLightbox()}this._lame_copy(s,e),this.setEvent(s.id,s),this._edit_stop_event(s,!0),this.render_view_data()},scheduler.hide_lightbox=function(){this.hideCover(this.getLightbox()),this._lightbox_id=null,this.callEvent("onAfterLightbox",[])},scheduler.hideCover=function(e){e&&(e.style.display="none"),this.hide_cover()},scheduler.hide_cover=function(){this._cover&&this._cover.parentNode.removeChild(this._cover),this._cover=null},scheduler.show_cover=function(){this._cover=document.createElement("DIV"),this._cover.className="dhx_cal_cover";var e=void 0!==document.height?document.height:document.body.offsetHeight,t=document.documentElement?document.documentElement.scrollHeight:0;this._cover.style.height=Math.max(e,t)+"px",document.body.appendChild(this._cover)},scheduler.save_lightbox=function(){var e=this._lightbox_out({},this._lame_copy(this.getEvent(this._lightbox_id)));(!this.checkEvent("onEventSave")||this.callEvent("onEventSave",[this._lightbox_id,e,this._new_event]))&&(this._empty_lightbox(e),this.hide_lightbox())},scheduler.startLightbox=function(e,t){this._lightbox_id=e,this._custom_lightbox=!0,this._temp_lightbox=this._lightbox,this._lightbox=t,this.showCover(t)},scheduler.endLightbox=function(e,t){this._edit_stop_event(scheduler.getEvent(this._lightbox_id),e),e&&scheduler.render_view_data(),this.hideCover(t),this._custom_lightbox&&(this._lightbox=this._temp_lightbox,this._custom_lightbox=!1),this._temp_lightbox=this._lightbox_id=null},scheduler.resetLightbox=function(){scheduler._lightbox&&!scheduler._custom_lightbox&&scheduler._lightbox.parentNode.removeChild(scheduler._lightbox),scheduler._lightbox=null},scheduler.cancel_lightbox=function(){this.callEvent("onEventCancel",[this._lightbox_id,this._new_event]),this.endLightbox(!1),this.hide_lightbox()},scheduler._init_lightbox_events=function(){this.getLightbox().onclick=function(e){var t=e?e.target:event.srcElement;if(t.className||(t=t.previousSibling),t&&t.className)switch(t.className){case"dhx_save_btn":scheduler.save_lightbox();break;case"dhx_delete_btn":var s=scheduler.locale.labels.confirm_deleting;scheduler._dhtmlx_confirm(s,scheduler.locale.labels.title_confirm_deleting,function(){scheduler.deleteEvent(scheduler._lightbox_id),scheduler._new_event=null,scheduler.hide_lightbox()});break;case"dhx_cancel_btn":scheduler.cancel_lightbox();break;default:if(t.getAttribute("dhx_button"))scheduler.callEvent("onLightboxButton",[t.className,t,e]);else{var i,r,n;-1!=t.className.indexOf("dhx_custom_button")&&(-1!=t.className.indexOf("dhx_custom_button_")?(i=t.parentNode.getAttribute("index"),n=t.parentNode.parentNode):(i=t.getAttribute("index"),n=t.parentNode,t=t.firstChild)),i&&(r=scheduler.form_blocks[scheduler.config.lightbox.sections[i].type],r.button_click(i,t,n,n.nextSibling))}}},this.getLightbox().onkeydown=function(e){switch((e||event).keyCode){case scheduler.keys.edit_save:if((e||event).shiftKey)return;scheduler.save_lightbox();break;case scheduler.keys.edit_cancel:scheduler.cancel_lightbox()}}},scheduler.setLightboxSize=function(){var e=this._lightbox;if(e){var t=e.childNodes[1];t.style.height="0px",t.style.height=t.scrollHeight+"px",e.style.height=t.scrollHeight+scheduler.xy.lightbox_additional_height+"px",t.style.height=t.scrollHeight+"px"}},scheduler._init_dnd_events=function(){dhtmlxEvent(document.body,"mousemove",scheduler._move_while_dnd),dhtmlxEvent(document.body,"mouseup",scheduler._finish_dnd),scheduler._init_dnd_events=function(){}},scheduler._move_while_dnd=function(e){if(scheduler._dnd_start_lb){document.dhx_unselectable||(document.body.className+=" dhx_unselectable",document.dhx_unselectable=!0);var t=scheduler.getLightbox(),s=e&&e.target?[e.pageX,e.pageY]:[event.clientX,event.clientY];t.style.top=scheduler._lb_start[1]+s[1]-scheduler._dnd_start_lb[1]+"px",t.style.left=scheduler._lb_start[0]+s[0]-scheduler._dnd_start_lb[0]+"px"}},scheduler._ready_to_dnd=function(e){var t=scheduler.getLightbox();scheduler._lb_start=[parseInt(t.style.left,10),parseInt(t.style.top,10)],scheduler._dnd_start_lb=e&&e.target?[e.pageX,e.pageY]:[event.clientX,event.clientY]},scheduler._finish_dnd=function(){scheduler._lb_start&&(scheduler._lb_start=scheduler._dnd_start_lb=!1,document.body.className=document.body.className.replace(" dhx_unselectable",""),document.dhx_unselectable=!1)},scheduler.getLightbox=function(){if(!this._lightbox){var e=document.createElement("DIV");e.className="dhx_cal_light",scheduler.config.wide_form&&(e.className+=" dhx_cal_light_wide"),scheduler.form_blocks.recurring&&(e.className+=" dhx_cal_light_rec"),/msie|MSIE 6/.test(navigator.userAgent)&&(e.className+=" dhx_ie6"),e.style.visibility="hidden";for(var t=this._lightbox_template,s=this.config.buttons_left,i=0;i<s.length;i++)t+="<div class='dhx_btn_set dhx_left_btn_set "+s[i]+"_set'><div dhx_button='1' class='"+s[i]+"'></div><div>"+scheduler.locale.labels[s[i]]+"</div></div>";s=this.config.buttons_right;for(var i=0;i<s.length;i++)t+="<div class='dhx_btn_set dhx_right_btn_set "+s[i]+"_set' style='float:right;'><div dhx_button='1' class='"+s[i]+"'></div><div>"+scheduler.locale.labels[s[i]]+"</div></div>";t+="</div>",e.innerHTML=t,scheduler.config.drag_lightbox&&(e.firstChild.onmousedown=scheduler._ready_to_dnd,e.firstChild.onselectstart=function(){return!1},e.firstChild.style.cursor="pointer",scheduler._init_dnd_events()),document.body.insertBefore(e,document.body.firstChild),this._lightbox=e;var r=this.config.lightbox.sections;t="";for(var i=0;i<r.length;i++){var n=this.form_blocks[r[i].type];if(n){r[i].id="area_"+this.uid();var a="";r[i].button&&(a="<div class='dhx_custom_button' index='"+i+"'><div class='dhx_custom_button_"+r[i].button+"'></div><div>"+this.locale.labels["button_"+r[i].button]+"</div></div>"),this.config.wide_form&&(t+="<div class='dhx_wrap_section'>"),t+="<div id='"+r[i].id+"' class='dhx_cal_lsection'>"+a+this.locale.labels["section_"+r[i].name]+"</div>"+n.render.call(this,r[i]),t+="</div>"}}for(var d=e.getElementsByTagName("div"),i=0;i<d.length;i++){var o=d[i];if("dhx_cal_larea"==o.className){o.innerHTML=t;break}}this.setLightboxSize(),this._init_lightbox_events(this),e.style.display="none",e.style.visibility="visible"}return this._lightbox},scheduler._lightbox_template="<div class='dhx_cal_ltitle'><span class='dhx_mark'>&nbsp;</span><span class='dhx_time'></span><span class='dhx_title'></span></div><div class='dhx_cal_larea'></div>",scheduler._init_touch_events=function(){"force"!=this.config.touch&&(this.config.touch=this.config.touch&&(-1!=navigator.userAgent.indexOf("Mobile")||-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("Android")||-1!=navigator.userAgent.indexOf("Touch"))),this.config.touch&&(this.xy.scroll_width=0,window.navigator.msPointerEnabled?this._touch_events(["MSPointerMove","MSPointerDown","MSPointerUp"],function(e){return e.pointerType==e.MSPOINTER_TYPE_MOUSE?null:e},function(e){return!e||e.pointerType==e.MSPOINTER_TYPE_MOUSE}):this._touch_events(["touchmove","touchstart","touchend"],function(e){return e.touches&&e.touches.length>1?null:e.touches[0]?{target:e.target,pageX:e.touches[0].pageX,pageY:e.touches[0].pageY}:e},function(){return!1}))},scheduler._touch_events=function(e,t,s){function i(e,t,s){if(e&&t){var i=Math.abs(e.pageY-t.pageY),r=Math.abs(e.pageX-t.pageX);r>s&&(!i||r/i>3)&&(e.pageX>t.pageX?scheduler._click.dhx_cal_next_button():scheduler._click.dhx_cal_prev_button())}}function r(e){scheduler._hide_global_tip(),o&&(scheduler._on_mouse_up(t(e||event)),scheduler._temp_touch_block=!1),scheduler._drag_id=null,scheduler._drag_mode=null,scheduler._drag_pos=null,clearTimeout(d),o=h=!1,l=!0}var n,a,d,o,l,h,_=-1!=navigator.userAgent.indexOf("Android")&&-1!=navigator.userAgent.indexOf("WebKit"),c=0;dhtmlxEvent(document.body,e[0],function(e){if(!s(e)){if(o)return scheduler._on_mouse_move(t(e)),scheduler._update_global_tip(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1;if(a&&_&&i(a,t(e),0),a=t(e),h)return a?void((n.target!=a.target||Math.abs(n.pageX-a.pageX)>5||Math.abs(n.pageY-a.pageY)>5)&&(l=!0,clearTimeout(d))):void(l=!0)}}),dhtmlxEvent(this._els.dhx_cal_data[0],"scroll",r),dhtmlxEvent(this._els.dhx_cal_data[0],"touchcancel",r),dhtmlxEvent(this._els.dhx_cal_data[0],"contextmenu",function(e){return h?(e&&e.preventDefault&&e.preventDefault(),(e||event).cancelBubble=!0,!1):void 0}),dhtmlxEvent(this._els.dhx_cal_data[0],e[1],function(e){if(!s(e)){o=l=a=!1,h=!0,scheduler._temp_touch_block=!0;var i=a=t(e);if(!i)return void(l=!0);var r=new Date;if(!l&&!o&&250>r-c)return scheduler._click.dhx_cal_data(i),window.setTimeout(function(){scheduler._on_dbl_click(i)},50),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,scheduler._block_next_stop=!0,!1;c=r,l||o||!scheduler.config.touch_drag||(d=setTimeout(function(){o=!0;var e=n.target;if(e&&e.className&&-1!=e.className.indexOf("dhx_body")&&(e=e.previousSibling),scheduler._on_mouse_down(n,e),scheduler._drag_mode&&"create"!=scheduler._drag_mode){var t=-1;if(scheduler.for_rendered(scheduler._drag_id,function(e,s){t=e.getBoundingClientRect().top,e.style.display="none",scheduler._rendered.splice(s,1)}),t>=0){var s=scheduler.config.time_step;scheduler._move_pos_shift=s*Math.round(60*(i.pageY-t)/(scheduler.config.hour_size_px*s))}}scheduler.config.touch_tip&&scheduler._show_global_tip(),scheduler._on_mouse_move(n)},scheduler.config.touch_drag),n=i)}}),dhtmlxEvent(this._els.dhx_cal_data[0],e[2],function(e){return s(e)?void 0:(o||i(n,a,200),o&&(scheduler._ignore_next_click=!0),r(e),scheduler._block_next_stop?(scheduler._block_next_stop=!1,e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1):void 0)}),dhtmlxEvent(document.body,e[2],r)},scheduler._show_global_tip=function(){scheduler._hide_global_tip();var e=scheduler._global_tip=document.createElement("DIV");e.className="dhx_global_tip",scheduler._update_global_tip(1),document.body.appendChild(e)},scheduler._update_global_tip=function(e){var t=scheduler._global_tip;if(t){var s="";if(scheduler._drag_id&&!e){var i=scheduler.getEvent(scheduler._drag_id);i&&(s="<div>"+(i._timed?scheduler.templates.event_header(i.start_date,i.end_date,i):scheduler.templates.day_date(i.start_date,i.end_date,i))+"</div>")}t.innerHTML="create"==scheduler._drag_mode||"new-size"==scheduler._drag_mode?(scheduler.locale.drag_to_create||"Drag to create")+s:(scheduler.locale.drag_to_move||"Drag to move")+s}},scheduler._hide_global_tip=function(){var e=scheduler._global_tip;e&&e.parentNode&&(e.parentNode.removeChild(e),scheduler._global_tip=0)},scheduler._dp_init=function(e){e._methods=["_set_event_text_style","","changeEventId","deleteEvent"],this.attachEvent("onEventAdded",function(t){!this._loading&&this._validId(t)&&e.setUpdated(t,!0,"inserted")}),this.attachEvent("onConfirmedBeforeEventDelete",function(t){if(this._validId(t)){var s=e.getState(t);return"inserted"==s||this._new_event?(e.setUpdated(t,!1),!0):"deleted"==s?!1:"true_deleted"==s?!0:(e.setUpdated(t,!0,"deleted"),!1)}}),this.attachEvent("onEventChanged",function(t){!this._loading&&this._validId(t)&&e.setUpdated(t,!0,"updated")}),e._getRowData=function(e){var t=this.obj.getEvent(e),s={};for(var i in t)0!=i.indexOf("_")&&(s[i]=t[i]&&t[i].getUTCFullYear?this.obj.templates.xml_format(t[i]):t[i]);return s},e._clearUpdateFlag=function(){},e.attachEvent("insertCallback",scheduler._update_callback),e.attachEvent("updateCallback",scheduler._update_callback),e.attachEvent("deleteCallback",function(e,t){this.obj.setUserData(t,this.action_param,"true_deleted"),this.obj.deleteEvent(t)})},scheduler._validId=function(){return!0},scheduler.setUserData=function(e,t,s){e?this.getEvent(e)[t]=s:this._userdata[t]=s},scheduler.getUserData=function(e,t){return e?this.getEvent(e)[t]:this._userdata[t]},scheduler._set_event_text_style=function(e,t){this.for_rendered(e,function(e){e.style.cssText+=";"+t});var s=this.getEvent(e);s._text_style=t,this.event_updated(s)},scheduler._update_callback=function(e){var t=scheduler._xmlNodeToJSON(e.firstChild);t.text=t.text||t._tagvalue,t.start_date=scheduler.templates.xml_date(t.start_date),t.end_date=scheduler.templates.xml_date(t.end_date),scheduler.addEvent(t)},scheduler._skin_settings={fix_tab_position:[1,0],use_select_menu_space:[1,0],wide_form:[1,0],hour_size_px:[44,42],displayed_event_color:["#ff4a4a","ffc5ab"],displayed_event_text_color:["#ffef80","7e2727"]},scheduler._skin_xy={lightbox_additional_height:[90,50],nav_height:[59,22],bar_height:[24,20]},scheduler._configure=function(e,t,s){for(var i in t)"undefined"==typeof e[i]&&(e[i]=t[i][s])},scheduler._skin_init=function(){if(!scheduler.skin)for(var e=document.getElementsByTagName("link"),t=0;t<e.length;t++){var s=e[t].href.match("dhtmlxscheduler_([a-z]+).css");if(s){scheduler.skin=s[1];break}}var i=0;if(scheduler.skin&&"terrace"!=scheduler.skin&&(i=1),this._configure(scheduler.config,scheduler._skin_settings,i),this._configure(scheduler.xy,scheduler._skin_xy,i),!i){var r=scheduler.config.minicalendar;r&&(r.padding=14),scheduler.templates.event_bar_date=function(e){return"• <b>"+scheduler.templates.event_date(e)+"</b> "},scheduler.attachEvent("onTemplatesReady",function(){var e=scheduler.date.date_to_str("%d"),t=scheduler.templates.month_day;if(scheduler.templates.month_day=function(s){if("month"==this._mode){var i=e(s);return 1==s.getDate()&&(i=scheduler.locale.date.month_full[s.getMonth()]+" "+i),+s==+scheduler.date.date_part(new Date)&&(i=scheduler.locale.labels.dhx_cal_today_button+" "+i),i}return t.call(this,s)},scheduler.config.fix_tab_position)for(var s=scheduler._els.dhx_cal_navline[0].getElementsByTagName("div"),i=211,r=0;r<s.length;r++){var n=s[r],a=n.getAttribute("name");if(a)switch(n.style.right="auto",a){case"day_tab":n.style.left="14px",n.className+=" dhx_cal_tab_first";break;case"week_tab":n.style.left="75px";break;case"month_tab":n.style.left="136px",n.className+=" dhx_cal_tab_last";break;default:n.style.left=i+"px",n.className+=" dhx_cal_tab_standalone",i=i+14+n.offsetWidth}}}),scheduler._skin_init=function(){}}},window.jQuery&&!function(e){var t=[];e.fn.dhx_scheduler=function(s){if("string"!=typeof s){var i=[];return this.each(function(){if(this&&this.getAttribute&&!this.getAttribute("dhxscheduler")){for(var e in s)"data"!=e&&(scheduler.config[e]=s[e]);this.getElementsByTagName("div").length||(this.innerHTML='<div class="dhx_cal_navline"><div class="dhx_cal_prev_button">&nbsp;</div><div class="dhx_cal_next_button">&nbsp;</div><div class="dhx_cal_today_button"></div><div class="dhx_cal_date"></div><div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div><div class="dhx_cal_tab" name="week_tab" style="right:140px;"></div><div class="dhx_cal_tab" name="month_tab" style="right:76px;"></div></div><div class="dhx_cal_header"></div><div class="dhx_cal_data"></div>',this.className+=" dhx_cal_container"),scheduler.init(this,scheduler.config.date,scheduler.config.mode),s.data&&scheduler.parse(s.data),i.push(scheduler)}}),1===i.length?i[0]:i}return t[s]?t[s].apply(this,[]):void e.error("Method "+s+" does not exist on jQuery.dhx_scheduler")}}(jQuery),function(){function e(e){var s=scheduler._props?scheduler._props[scheduler._mode]:null,i=scheduler.matrix?scheduler.matrix[scheduler._mode]:null,r=s||i;if(s)var n=r.map_to;if(i)var n=r.y_property;r&&e&&(t=scheduler.getEvent(e)[n])}var t,s;scheduler.config.collision_limit=1,scheduler.attachEvent("onBeforeDrag",function(t){return e(t),!0}),scheduler.attachEvent("onBeforeLightbox",function(t){var i=scheduler.getEvent(t);return s=[i.start_date,i.end_date],e(t),!0}),scheduler.attachEvent("onEventChanged",function(e){if(!e)return!0;var t=scheduler.getEvent(e);if(!scheduler.checkCollision(t)){if(!s)return!1;t.start_date=s[0],t.end_date=s[1],t._timed=this.isOneDayEvent(t)}return!0}),scheduler.attachEvent("onBeforeEventChanged",function(e){return scheduler.checkCollision(e)}),scheduler.attachEvent("onEventAdded",function(e,t){var s=scheduler.checkCollision(t);s||scheduler.deleteEvent(e)}),scheduler.attachEvent("onEventSave",function(e,t){if(t=scheduler._lame_clone(t),t.id=e,!t.start_date||!t.end_date){var s=scheduler.getEvent(e);t.start_date=new Date(s.start_date),t.end_date=new Date(s.end_date)}return t.rec_type&&scheduler._roll_back_dates(t),scheduler.checkCollision(t)}),scheduler.checkCollision=function(e){var s=[],i=scheduler.config.collision_limit;if(e.rec_type)for(var r=scheduler.getRecDates(e),n=0;n<r.length;n++)for(var a=scheduler.getEvents(r[n].start_date,r[n].end_date),d=0;d<a.length;d++)(a[d].event_pid||a[d].id)!=e.id&&s.push(a[d]);else{s=scheduler.getEvents(e.start_date,e.end_date);for(var o=0;o<s.length;o++)if(s[o].id==e.id){s.splice(o,1);break}}var l=scheduler._props?scheduler._props[scheduler._mode]:null,h=scheduler.matrix?scheduler.matrix[scheduler._mode]:null,_=l||h;if(l)var c=_.map_to;if(h)var c=_.y_property;var u=!0;if(_){for(var f=0,o=0;o<s.length;o++)s[o][c]==e[c]&&s[o].id!=e.id&&f++;f>=i&&(u=!1)}else s.length>=i&&(u=!1);if(!u){var p=!scheduler.callEvent("onEventCollision",[e,s]);return p||(e[c]=t||e[c]),p}return u}}(),scheduler.form_blocks.combo={render:function(e){e.cached_options||(e.cached_options={});var t="";return t+="<div class='"+e.type+"' style='height:"+(e.height||20)+"px;' ></div>"},set_value:function(e,t,s,i){!function(){function t(){e._combo&&e._combo.DOMParent&&e._combo.destructor()}t();var s=scheduler.attachEvent("onAfterLightbox",function(){t(),scheduler.detachEvent(s)})}(),window.dhx_globalImgPath=i.image_path||"/",e._combo=new dhtmlXCombo(e,i.name,e.offsetWidth-8),i.onchange&&e._combo.attachEvent("onChange",i.onchange),i.options_height&&e._combo.setOptionHeight(i.options_height);var r=e._combo;if(r.enableFilteringMode(i.filtering,i.script_path||null,!!i.cache),i.script_path){var n=s[i.map_to];n?i.cached_options[n]?(r.addOption(n,i.cached_options[n]),r.disable(1),r.selectOption(0),r.disable(0)):dhtmlxAjax.get(i.script_path+"?id="+n+"&uid="+scheduler.uid(),function(e){var t=e.doXPath("//option")[0],s=t.childNodes[0].nodeValue;i.cached_options[n]=s,r.addOption(n,s),r.disable(1),r.selectOption(0),r.disable(0)}):r.setComboValue("")}else{for(var a=[],d=0;d<i.options.length;d++){var o=i.options[d],l=[o.key,o.label,o.css];a.push(l)}if(r.addOption(a),s[i.map_to]){var h=r.getIndexByValue(s[i.map_to]);r.selectOption(h)}}},get_value:function(e,t,s){var i=e._combo.getSelectedValue();return s.script_path&&(s.cached_options[i]=e._combo.getSelectedText()),i},focus:function(){}},scheduler.form_blocks.radio={render:function(e){var t="";t+="<div class='dhx_cal_ltext dhx_cal_radio' style='height:"+e.height+"px;' >";for(var s=0;s<e.options.length;s++){var i=scheduler.uid();t+="<input id='"+i+"' type='radio' name='"+e.name+"' value='"+e.options[s].key+"'><label for='"+i+"'> "+e.options[s].label+"</label>",e.vertical&&(t+="<br/>")}return t+="</div>"},set_value:function(e,t,s,i){for(var r=e.getElementsByTagName("input"),n=0;n<r.length;n++){r[n].checked=!1;var a=s[i.map_to]||t;r[n].value==a&&(r[n].checked=!0)}},get_value:function(e){for(var t=e.getElementsByTagName("input"),s=0;s<t.length;s++)if(t[s].checked)return t[s].value},focus:function(){}},scheduler.form_blocks.checkbox={render:function(e){return scheduler.config.wide_form?'<div class="dhx_cal_wide_checkbox" '+(e.height?"style='height:"+e.height+"px;'":"")+"></div>":""},set_value:function(e,t,s,i){e=document.getElementById(i.id);var r=scheduler.uid(),n="undefined"!=typeof i.checked_value?s[i.map_to]==i.checked_value:!!t;e.className+=" dhx_cal_checkbox";var a="<input id='"+r+"' type='checkbox' value='true' name='"+i.name+"'"+(n?"checked='true'":"")+"'>",d="<label for='"+r+"'>"+(scheduler.locale.labels["section_"+i.name]||i.name)+"</label>";if(scheduler.config.wide_form?(e.innerHTML=d,e.nextSibling.innerHTML=a):e.innerHTML=a+d,i.handler){var o=e.getElementsByTagName("input")[0];o.onclick=i.handler}},get_value:function(e,t,s){e=document.getElementById(s.id);var i=e.getElementsByTagName("input")[0];return i||(i=e.nextSibling.getElementsByTagName("input")[0]),i.checked?s.checked_value||!0:s.unchecked_value||!1},focus:function(){}},scheduler.config.limit_start=null,scheduler.config.limit_end=null,scheduler.config.limit_view=!1,scheduler.config.check_limits=!0,scheduler.config.mark_now=!0,scheduler.config.display_marked_timespans=!0,(scheduler._temp_limit_scope=function(){function e(e,t,s,i,r){function n(e,t,s,i){var r=[];if(e&&e[t])for(var n=e[t],o=a(s,i,n),l=0;l<o.length;l++)r=d._add_timespan_zones(r,o[l].zones);return r}function a(e,t,s){var i=s[t]&&s[t][r]?s[t][r]:s[e]&&s[e][r]?s[e][r]:[];return i}var d=scheduler,o=[],l={_props:"map_to",matrix:"y_property"};for(var h in l){var _=l[h];if(d[h])for(var c in d[h]){var u=d[h][c],f=u[_];e[f]&&(o=d._add_timespan_zones(o,n(t[c],e[f],s,i)))}}return o=d._add_timespan_zones(o,n(t,"global",s,i))}var t=null,s="dhx_time_block",i="default",r=function(e,t,s){return t instanceof Date&&s instanceof Date?(e.start_date=t,e.end_date=s):(e.days=t,e.zones=s),e},n=function(e,t,i){var n="object"==typeof e?e:{days:e};return n.type=s,n.css="",t&&(i&&(n.sections=i),n=r(n,e,t)),n};scheduler.blockTime=function(e,t,s){var i=n(e,t,s);return scheduler.addMarkedTimespan(i)},scheduler.unblockTime=function(e,t,s){t=t||"fullday";var i=n(e,t,s);return scheduler.deleteMarkedTimespan(i)},scheduler.attachEvent("onBeforeViewChange",function(e,t,s,i){return i=i||t,s=s||e,scheduler.config.limit_view&&(i.valueOf()>scheduler.config.limit_end.valueOf()||this.date.add(i,1,s)<=scheduler.config.limit_start.valueOf())?(setTimeout(function(){scheduler.setCurrentView(scheduler._date,s)},1),!1):!0}),scheduler.checkInMarkedTimespan=function(t,s,r){s=s||i;for(var n=!0,a=new Date(t.start_date.valueOf()),d=scheduler.date.add(a,1,"day"),o=scheduler._marked_timespans;a<t.end_date;a=scheduler.date.date_part(d),d=scheduler.date.add(a,1,"day")){var l=+scheduler.date.date_part(new Date(a)),h=a.getDay(),_=e(t,o,h,l,s);if(_)for(var c=0;c<_.length;c+=2){var u=scheduler._get_zone_minutes(a),f=t.end_date>d||t.end_date.getDate()!=a.getDate()?1440:scheduler._get_zone_minutes(t.end_date),p=_[c],m=_[c+1];if(f>p&&m>u&&(n="function"==r?r(t,u,f,p,m):!1,!n))break}}return!n};var a=scheduler.checkLimitViolation=function(e){if(!e)return!0;if(!scheduler.config.check_limits)return!0;var t=scheduler,i=t.config,r=[];r=e.rec_type?scheduler.getRecDates(e):[e];for(var n=!0,a=0;a<r.length;a++){var d=!0,o=r[a];o._timed=scheduler.isOneDayEvent(o),d=i.limit_start&&i.limit_end?o.start_date.valueOf()>=i.limit_start.valueOf()&&o.end_date.valueOf()<=i.limit_end.valueOf():!0,d&&(d=!scheduler.checkInMarkedTimespan(o,s,function(e,s,i,r,n){var a=!0;return n>=s&&s>=r&&((1440==n||n>i)&&(a=!1),e._timed&&t._drag_id&&"new-size"==t._drag_mode?(e.start_date.setHours(0),e.start_date.setMinutes(n)):a=!1),(i>=r&&n>i||r>s&&i>n)&&(e._timed&&t._drag_id&&"new-size"==t._drag_mode?(e.end_date.setHours(0),e.end_date.setMinutes(r)):a=!1),a})),d||(t._drag_id=null,t._drag_mode=null,d=t.checkEvent("onLimitViolation")?t.callEvent("onLimitViolation",[o.id,o]):d),n=n&&d}return n};scheduler.attachEvent("onMouseDown",function(e){return!(e=s)}),scheduler.attachEvent("onBeforeDrag",function(e){return e?a(scheduler.getEvent(e)):!0}),scheduler.attachEvent("onClick",function(e){return a(scheduler.getEvent(e))}),scheduler.attachEvent("onBeforeLightbox",function(e){var s=scheduler.getEvent(e);return t=[s.start_date,s.end_date],a(s)}),scheduler.attachEvent("onEventSave",function(e,t){if(!t.start_date||!t.end_date){var s=scheduler.getEvent(e);t.start_date=new Date(s.start_date),t.end_date=new Date(s.end_date)}if(t.rec_type){var i=scheduler._lame_clone(t);return scheduler._roll_back_dates(i),a(i)}return a(t)}),scheduler.attachEvent("onEventAdded",function(e){if(!e)return!0;var t=scheduler.getEvent(e);return!a(t)&&scheduler.config.limit_start&&scheduler.config.limit_end&&(t.start_date<scheduler.config.limit_start&&(t.start_date=new Date(scheduler.config.limit_start)),t.start_date.valueOf()>=scheduler.config.limit_end.valueOf()&&(t.start_date=this.date.add(scheduler.config.limit_end,-1,"day")),t.end_date<scheduler.config.limit_start&&(t.end_date=new Date(scheduler.config.limit_start)),t.end_date.valueOf()>=scheduler.config.limit_end.valueOf()&&(t.end_date=this.date.add(scheduler.config.limit_end,-1,"day")),t.start_date.valueOf()>=t.end_date.valueOf()&&(t.end_date=this.date.add(t.start_date,this.config.event_duration||this.config.time_step,"minute")),t._timed=this.isOneDayEvent(t)),!0}),scheduler.attachEvent("onEventChanged",function(e){if(!e)return!0;var s=scheduler.getEvent(e);if(!a(s)){if(!t)return!1;s.start_date=t[0],s.end_date=t[1],s._timed=this.isOneDayEvent(s)}return!0}),scheduler.attachEvent("onBeforeEventChanged",function(e){return a(e)}),scheduler.attachEvent("onBeforeEventCreated",function(e){var t=scheduler.getActionData(e).date,s={_timed:!0,start_date:t,end_date:scheduler.date.add(t,scheduler.config.time_step,"minute")};return a(s)}),scheduler.attachEvent("onViewChange",function(){scheduler._mark_now()}),scheduler.attachEvent("onSchedulerResize",function(){return window.setTimeout(function(){scheduler._mark_now()},1),!0}),scheduler.attachEvent("onTemplatesReady",function(){scheduler._mark_now_timer=window.setInterval(function(){scheduler._mark_now()},6e4)}),scheduler._mark_now=function(e){var t="dhx_now_time";this._els[t]||(this._els[t]=[]);var s=scheduler._currentDate(),i=this.config;if(scheduler._remove_mark_now(),!e&&i.mark_now&&s<this._max_date&&s>this._min_date&&s.getHours()>=i.first_hour&&s.getHours()<i.last_hour){var r=this.locate_holder_day(s);this._els[t]=scheduler._append_mark_now(r,s)}},scheduler._append_mark_now=function(e,t){var s="dhx_now_time",i=scheduler._get_zone_minutes(t),r={zones:[i,i+1],css:s,type:s};if(!this._table_view){if(this._props&&this._props[this._mode]){for(var n=this._els.dhx_cal_data[0].childNodes,a=[],d=0;d<n.length-1;d++){var o=e+d;r.days=o;var l=scheduler._render_marked_timespan(r,null,o)[0];a.push(l)}return a}return r.days=e,scheduler._render_marked_timespan(r,null,e)}return"month"==this._mode?(r.days=+scheduler.date.date_part(t),scheduler._render_marked_timespan(r,null,null)):void 0},scheduler._remove_mark_now=function(){for(var e="dhx_now_time",t=this._els[e],s=0;s<t.length;s++){var i=t[s],r=i.parentNode;r&&r.removeChild(i)}this._els[e]=[]},scheduler._marked_timespans={global:{}},scheduler._get_zone_minutes=function(e){return 60*e.getHours()+e.getMinutes()},scheduler._prepare_timespan_options=function(e){var t=[],s=[];if("fullweek"==e.days&&(e.days=[0,1,2,3,4,5,6]),e.days instanceof Array){for(var r=e.days.slice(),n=0;n<r.length;n++){var a=scheduler._lame_clone(e);a.days=r[n],t.push.apply(t,scheduler._prepare_timespan_options(a))}return t}if(!e||!(e.start_date&&e.end_date&&e.end_date>e.start_date||void 0!==e.days&&e.zones))return t;var d=0,o=1440;"fullday"==e.zones&&(e.zones=[d,o]),e.zones&&e.invert_zones&&(e.zones=scheduler.invertZones(e.zones)),e.id=scheduler.uid(),e.css=e.css||"",e.type=e.type||i;var l=e.sections;if(l){for(var h in l)if(l.hasOwnProperty(h)){var _=l[h];_ instanceof Array||(_=[_]);for(var n=0;n<_.length;n++){var c=scheduler._lame_copy({},e);c.sections={},c.sections[h]=_[n],s.push(c)}}}else s.push(e);for(var u=0;u<s.length;u++){var f=s[u],p=f.start_date,m=f.end_date;if(p&&m)for(var g=scheduler.date.date_part(new Date(p)),v=scheduler.date.add(g,1,"day");m>g;){var c=scheduler._lame_copy({},f);delete c.start_date,delete c.end_date,c.days=g.valueOf();var x=p>g?scheduler._get_zone_minutes(p):d,y=m>v||m.getDate()!=g.getDate()?o:scheduler._get_zone_minutes(m);c.zones=[x,y],t.push(c),g=v,v=scheduler.date.add(v,1,"day")}else f.days instanceof Date&&(f.days=scheduler.date.date_part(f.days).valueOf()),f.zones=e.zones.slice(),t.push(f)}return t},scheduler._get_dates_by_index=function(e,t,s){var i=[];t=scheduler.date.date_part(new Date(t||scheduler._min_date)),s=new Date(s||scheduler._max_date);for(var r=t.getDay(),n=e-r>=0?e-r:7-t.getDay()+e,a=scheduler.date.add(t,n,"day");s>a;a=scheduler.date.add(a,1,"week"))i.push(a);return i},scheduler._get_css_classes_by_config=function(e){var t=[];return e.type==s&&(t.push(s),e.css&&t.push(s+"_reset")),t.push("dhx_marked_timespan",e.css),t.join(" ")},scheduler._get_block_by_config=function(e){var t=document.createElement("DIV");return e.html&&("string"==typeof e.html?t.innerHTML=e.html:t.appendChild(e.html)),t},scheduler._render_marked_timespan=function(e,t,s){var i=[],r=scheduler.config,n=this._min_date,a=this._max_date,d=!1;if(!r.display_marked_timespans)return i;if(!s&&0!==s){if(e.days<7)s=e.days;else{var o=new Date(e.days);if(d=+o,!(+a>=+o&&+o>=+n))return i;s=o.getDay()}var l=n.getDay();l>s?s=7-(l-s):s-=l}var h=e.zones,_=scheduler._get_css_classes_by_config(e);if(scheduler._table_view&&"month"==scheduler._mode){var c=[],u=[];if(t)c.push(t),u.push(s);else{u=d?[d]:scheduler._get_dates_by_index(s);for(var f=0;f<u.length;f++)c.push(this._scales[u[f]])}for(var f=0;f<c.length;f++){t=c[f],s=u[f];for(var p=0;p<h.length;p+=2){var m=h[f],g=h[f+1];if(m>=g)return[];var v=scheduler._get_block_by_config(e);v.className=_;var x=t.offsetHeight-1,y=t.offsetWidth-1,b=Math.floor((this._correct_shift(s,1)-n.valueOf())/(864e5*this._cols.length)),w=this.locate_holder_day(s,!1)%this._cols.length,D=this._colsS[w],E=this._colsS.heights[b]+(this._colsS.height?this.xy.month_scale_height+2:2)-1;v.style.top=E+"px",v.style.lineHeight=v.style.height=x+"px",v.style.left=D+Math.round(m/1440*y)+"px",v.style.width=Math.round((g-m)/1440*y)+"px",t.appendChild(v),i.push(v)}}}else{var O=s;if(this._props&&this._props[this._mode]&&e.sections&&e.sections[this._mode]){var k=this._props[this._mode];O=k.order[e.sections[this._mode]],k.size&&O>k.position+k.size&&(O=0)}t=t?t:scheduler.locate_holder(O);for(var f=0;f<h.length;f+=2){var m=Math.max(h[f],60*r.first_hour),g=Math.min(h[f+1],60*r.last_hour);if(m>=g){if(f+2<h.length)continue;return[]}var v=scheduler._get_block_by_config(e);v.className=_;var M=24*this.config.hour_size_px+1,C=36e5;v.style.top=Math.round((60*m*1e3-this.config.first_hour*C)*this.config.hour_size_px/C)%M+"px",v.style.lineHeight=v.style.height=Math.max(Math.round(60*(g-m)*1e3*this.config.hour_size_px/C)%M,1)+"px",t.appendChild(v),i.push(v)}}return i},scheduler.markTimespan=function(e){var t=scheduler._prepare_timespan_options(e);if(t.length){for(var s=[],i=0;i<t.length;i++){var r=t[i],n=scheduler._render_marked_timespan(r,null,null);n.length&&s.push.apply(s,n)}return s}},scheduler.unmarkTimespan=function(e){if(e)for(var t=0;t<e.length;t++){var s=e[t];s.parentNode&&s.parentNode.removeChild(s)}},scheduler._marked_timespans_ids={},scheduler.addMarkedTimespan=function(e){var t=scheduler._prepare_timespan_options(e),s="global";if(t.length){var i=t[0].id,r=scheduler._marked_timespans,n=scheduler._marked_timespans_ids;n[i]||(n[i]=[]);for(var a=0;a<t.length;a++){var d=t[a],o=d.days,l=(d.zones,d.css,d.sections),h=d.type;if(d.id=i,l){for(var _ in l)if(l.hasOwnProperty(_)){r[_]||(r[_]={});
var c=l[_],u=r[_];u[c]||(u[c]={}),u[c][o]||(u[c][o]={}),u[c][o][h]||(u[c][o][h]=[],scheduler._marked_timespans_types||(scheduler._marked_timespans_types={}),scheduler._marked_timespans_types[h]||(scheduler._marked_timespans_types[h]=!0));var f=u[c][o][h];d._array=f,f.push(d),n[i].push(d)}}else{r[s][o]||(r[s][o]={}),r[s][o][h]||(r[s][o][h]=[]),scheduler._marked_timespans_types||(scheduler._marked_timespans_types={}),scheduler._marked_timespans_types[h]||(scheduler._marked_timespans_types[h]=!0);var f=r[s][o][h];d._array=f,f.push(d),n[i].push(d)}}return i}},scheduler._add_timespan_zones=function(e,t){var s=e.slice();if(t=t.slice(),!s.length)return t;for(var i=0;i<s.length;i+=2)for(var r=s[i],n=s[i+1],a=i+2==s.length,d=0;d<t.length;d+=2){var o=t[d],l=t[d+1];if(l>n&&n>=o||r>o&&l>=r)s[i]=Math.min(r,o),s[i+1]=Math.max(n,l),i-=2;else{if(!a)continue;var h=r>o?0:2;s.splice(i+h,0,o,l)}t.splice(d--,2);break}return s},scheduler._subtract_timespan_zones=function(e,t){for(var s=e.slice(),i=0;i<s.length;i+=2)for(var r=s[i],n=s[i+1],a=0;a<t.length;a+=2){var d=t[a],o=t[a+1];if(o>r&&n>d){var l=!1;r>=d&&o>=n&&s.splice(i,2),d>r&&(s.splice(i,2,r,d),l=!0),n>o&&s.splice(l?i+2:i,l?0:2,o,n),i-=2;break}}return s},scheduler.invertZones=function(e){return scheduler._subtract_timespan_zones([0,1440],e.slice())},scheduler._delete_marked_timespan_by_id=function(e){var t=scheduler._marked_timespans_ids[e];if(t)for(var s=0;s<t.length;s++)for(var i=t[s],r=i._array,n=0;n<r.length;n++)if(r[n]==i){r.splice(n,1);break}},scheduler._delete_marked_timespan_by_config=function(e){var t=scheduler._marked_timespans,s=e.sections,r=e.days,n=e.type||i,a=[];if(s){for(var d in s)if(s.hasOwnProperty(d)&&t[d]){var o=s[d];t[d][o]&&t[d][o][r]&&t[d][o][r][n]&&(a=t[d][o][r][n])}}else t.global[r]&&t.global[r][n]&&(a=t.global[r][n]);for(var l=0;l<a.length;l++){var h=a[l],_=scheduler._subtract_timespan_zones(h.zones,e.zones);if(_.length)h.zones=_;else{a.splice(l,1),l--;for(var c=scheduler._marked_timespans_ids[h.id],u=0;u<c.length;u++)if(c[u]==h){c.splice(u,1);break}}}},scheduler.deleteMarkedTimespan=function(e){if(arguments.length||(scheduler._marked_timespans={global:{}},scheduler._marked_timespans_ids={},scheduler._marked_timespans_types={}),"object"!=typeof e)scheduler._delete_marked_timespan_by_id(e);else{e.start_date&&e.end_date||(e.days||(e.days="fullweek"),e.zones||(e.zones="fullday"));var t=[];if(e.type)t.push(e.type);else for(var s in scheduler._marked_timespans_types)t.push(s);for(var i=scheduler._prepare_timespan_options(e),r=0;r<i.length;r++)for(var n=i[r],a=0;a<t.length;a++){var d=scheduler._lame_clone(n);d.type=t[a],scheduler._delete_marked_timespan_by_config(d)}}},scheduler._get_types_to_render=function(e,t){var s=e?e:{};for(var i in t||{})t.hasOwnProperty(i)&&(s[i]=t[i]);return s},scheduler._get_configs_to_render=function(e){var t=[];for(var s in e)e.hasOwnProperty(s)&&t.push.apply(t,e[s]);return t},scheduler.attachEvent("onScaleAdd",function(e,t){if(!scheduler._table_view||"month"==scheduler._mode){var s=t.getDay(),i=t.valueOf(),r=this._mode,n=scheduler._marked_timespans,a=[];if(this._props&&this._props[r]){var d=this._props[r],o=d.options,l=scheduler._get_unit_index(d,t),h=o[l];if(t=scheduler.date.date_part(new Date(this._date)),s=t.getDay(),i=t.valueOf(),n[r]&&n[r][h.key]){var _=n[r][h.key],c=scheduler._get_types_to_render(_[s],_[i]);a.push.apply(a,scheduler._get_configs_to_render(c))}}var u=n.global,f=u[i]||u[s];a.push.apply(a,scheduler._get_configs_to_render(f));for(var p=0;p<a.length;p++)scheduler._render_marked_timespan(a[p],e,t)}})})(),scheduler.templates.calendar_month=scheduler.date.date_to_str("%F %Y"),scheduler.templates.calendar_scale_date=scheduler.date.date_to_str("%D"),scheduler.templates.calendar_date=scheduler.date.date_to_str("%d"),scheduler.config.minicalendar={mark_events:!0},scheduler._synced_minicalendars=[],scheduler.renderCalendar=function(e,t,s){var i=null,r=e.date||scheduler._currentDate();if("string"==typeof r&&(r=this.templates.api_date(r)),t)i=this._render_calendar(t.parentNode,r,e,t),scheduler.unmarkCalendar(i);else{var n=e.container,a=e.position;if("string"==typeof n&&(n=document.getElementById(n)),"string"==typeof a&&(a=document.getElementById(a)),a&&"undefined"==typeof a.left)var d=getOffset(a),a={top:d.top+a.offsetHeight,left:d.left};n||(n=scheduler._get_def_cont(a)),i=this._render_calendar(n,r,e),i.onclick=function(e){var e=e||event,t=e.target||e.srcElement;if(-1!=t.className.indexOf("dhx_month_head")){var s=t.parentNode.className;if(-1==s.indexOf("dhx_after")&&-1==s.indexOf("dhx_before")){var i=scheduler.templates.xml_date(this.getAttribute("date"));i.setDate(parseInt(t.innerHTML,10)),scheduler.unmarkCalendar(this),scheduler.markCalendar(this,i,"dhx_calendar_click"),this._last_date=i,this.conf.handler&&this.conf.handler.call(scheduler,i,this)}}}}if(scheduler.config.minicalendar.mark_events)for(var o=scheduler.date.month_start(r),l=scheduler.date.add(o,1,"month"),h=this.getEvents(o,l),_=this["filter_"+this._mode],c=0;c<h.length;c++){var u=h[c];if(!_||_(u.id,u)){var f=u.start_date;for(f.valueOf()<o.valueOf()&&(f=o),f=scheduler.date.date_part(new Date(f.valueOf()));f<u.end_date&&(this.markCalendar(i,f,"dhx_year_event"),f=this.date.add(f,1,"day"),!(f.valueOf()>=l.valueOf())););}}return this._markCalendarCurrentDate(i),i.conf=e,e.sync&&!s&&this._synced_minicalendars.push(i),i},scheduler._get_def_cont=function(e){return this._def_count||(this._def_count=document.createElement("DIV"),this._def_count.className="dhx_minical_popup",this._def_count.onclick=function(e){(e||event).cancelBubble=!0},document.body.appendChild(this._def_count)),this._def_count.style.left=e.left+"px",this._def_count.style.top=e.top+"px",this._def_count._created=new Date,this._def_count},scheduler._locateCalendar=function(e,t){if("string"==typeof t&&(t=scheduler.templates.api_date(t)),+t>+e._max_date||+t<+e._min_date)return null;for(var s=e.childNodes[2].childNodes[0],i=0,r=new Date(e._min_date);+this.date.add(r,1,"week")<=+t;)r=this.date.add(r,1,"week"),i++;var n=scheduler.config.start_on_monday,a=(t.getDay()||(n?7:0))-(n?1:0);return s.rows[i].cells[a].firstChild},scheduler.markCalendar=function(e,t,s){var i=this._locateCalendar(e,t);i&&(i.className+=" "+s)},scheduler.unmarkCalendar=function(e,t,s){if(t=t||e._last_date,s=s||"dhx_calendar_click",t){var i=this._locateCalendar(e,t);i&&(i.className=(i.className||"").replace(RegExp(s,"g")))}},scheduler._week_template=function(e){for(var t=e||250,s=0,i=document.createElement("div"),r=this.date.week_start(scheduler._currentDate()),n=0;7>n;n++)this._cols[n]=Math.floor(t/(7-n)),this._render_x_header(n,s,r,i),r=this.date.add(r,1,"day"),t-=this._cols[n],s+=this._cols[n];return i.lastChild.className+=" dhx_scale_bar_last",i},scheduler.updateCalendar=function(e,t){e.conf.date=t,this.renderCalendar(e.conf,e,!0)},scheduler._mini_cal_arrows=["&nbsp","&nbsp"],scheduler._render_calendar=function(e,t,s,i){var r=scheduler.templates,n=this._cols;this._cols=[];var a=this._mode;this._mode="calendar";var d=this._colsS;this._colsS={height:0};var o=new Date(this._min_date),l=new Date(this._max_date),h=new Date(scheduler._date),_=r.month_day;r.month_day=r.calendar_date;var c,t=this.date.month_start(t),u=this._week_template(e.offsetWidth-1-this.config.minicalendar.padding);if(i?c=i:(c=document.createElement("DIV"),c.className="dhx_cal_container dhx_mini_calendar"),c.setAttribute("date",this.templates.xml_format(t)),c.innerHTML="<div class='dhx_year_month'></div><div class='dhx_year_week'>"+u.innerHTML+"</div><div class='dhx_year_body'></div>",c.childNodes[0].innerHTML=this.templates.calendar_month(t),s.navigation)for(var f=function(e,t){var s=scheduler.date.add(e._date,t,"month");scheduler.updateCalendar(e,s),scheduler._date.getMonth()==e._date.getMonth()&&scheduler._date.getFullYear()==e._date.getFullYear()&&scheduler._markCalendarCurrentDate(e)},p=["dhx_cal_prev_button","dhx_cal_next_button"],m=["left:1px;top:2px;position:absolute;","left:auto; right:1px;top:2px;position:absolute;"],g=[-1,1],v=function(e){return function(){if(s.sync)for(var t=scheduler._synced_minicalendars,i=0;i<t.length;i++)f(t[i],e);else f(c,e)}},x=0;2>x;x++){var y=document.createElement("DIV");y.className=p[x],y.style.cssText=m[x],y.innerHTML=this._mini_cal_arrows[x],c.firstChild.appendChild(y),y.onclick=v(g[x])}c._date=new Date(t),c.week_start=(t.getDay()-(this.config.start_on_monday?1:0)+7)%7;var b=c._min_date=this.date.week_start(t);c._max_date=this.date.add(c._min_date,6,"week"),this._reset_month_scale(c.childNodes[2],t,b);for(var w=c.childNodes[2].firstChild.rows,D=w.length;6>D;D++){var E=w[w.length-1];w[0].parentNode.appendChild(E.cloneNode(!0));for(var O=parseInt(E.childNodes[E.childNodes.length-1].childNodes[0].innerHTML),O=10>O?O:0,k=0;k<w[D].childNodes.length;k++)w[D].childNodes[k].className="dhx_after",w[D].childNodes[k].childNodes[0].innerHTML=scheduler.date.to_fixed(++O)}return i||e.appendChild(c),c.childNodes[1].style.height=c.childNodes[1].childNodes[0].offsetHeight-1+"px",this._cols=n,this._mode=a,this._colsS=d,this._min_date=o,this._max_date=l,scheduler._date=h,r.month_day=_,c},scheduler.destroyCalendar=function(e,t){!e&&this._def_count&&this._def_count.firstChild&&(t||(new Date).valueOf()-this._def_count._created.valueOf()>500)&&(e=this._def_count.firstChild),e&&(e.onclick=null,e.innerHTML="",e.parentNode&&e.parentNode.removeChild(e),this._def_count)&&(this._def_count.style.top="-1000px")},scheduler.isCalendarVisible=function(){return this._def_count&&parseInt(this._def_count.style.top,10)>0?this._def_count:!1},scheduler.attachEvent("onTemplatesReady",function(){dhtmlxEvent(document.body,"click",function(){scheduler.destroyCalendar()})}),scheduler.templates.calendar_time=scheduler.date.date_to_str("%d-%m-%Y"),scheduler.form_blocks.calendar_time={render:function(){var e="<input class='dhx_readonly' type='text' readonly='true'>",t=scheduler.config,s=this.date.date_part(scheduler._currentDate()),i=1440,r=0;t.limit_time_select&&(r=60*t.first_hour,i=60*t.last_hour+1),s.setHours(r/60),e+=" <select>";for(var n=r;i>n;n+=1*this.config.time_step){var a=this.templates.time_picker(s);e+="<option value='"+n+"'>"+a+"</option>",s=this.date.add(s,this.config.time_step,"minute")}e+="</select>";scheduler.config.full_day;return"<div style='height:30px;padding-top:0; font-size:inherit;' class='dhx_section_time'>"+e+"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"+e+"</div>"},set_value:function(e,t,s){function i(e,t,s){a(e,t,s),e.value=scheduler.templates.calendar_time(t),e._date=scheduler.date.date_part(new Date(t))}var r=e.getElementsByTagName("input"),n=e.getElementsByTagName("select"),a=function(e,t,s){e.onclick=function(){scheduler.destroyCalendar(null,!0),scheduler.renderCalendar({position:e,date:new Date(this._date),navigation:!0,handler:function(t){e.value=scheduler.templates.calendar_time(t),e._date=new Date(t),scheduler.destroyCalendar(),scheduler.config.event_duration&&scheduler.config.auto_end_date&&0==s&&h()}})}};if(scheduler.config.full_day){if(!e._full_day){var d="<label class='dhx_fullday'><input type='checkbox' name='full_day' value='true'> "+scheduler.locale.labels.full_day+"&nbsp;</label></input>";scheduler.config.wide_form||(d=e.previousSibling.innerHTML+d),e.previousSibling.innerHTML=d,e._full_day=!0}var o=e.previousSibling.getElementsByTagName("input")[0],l=0==scheduler.date.time_part(s.start_date)&&0==scheduler.date.time_part(s.end_date);o.checked=l,n[0].disabled=o.checked,n[1].disabled=o.checked,o.onclick=function(){if(1==o.checked){var t={};scheduler.form_blocks.calendar_time.get_value(e,t);var a=scheduler.date.date_part(t.start_date),d=scheduler.date.date_part(t.end_date);(+d==+a||+d>=+a&&(0!=s.end_date.getHours()||0!=s.end_date.getMinutes()))&&(d=scheduler.date.add(d,1,"day"))}var l=a||s.start_date,h=d||s.end_date;i(r[0],l),i(r[1],h),n[0].value=60*l.getHours()+l.getMinutes(),n[1].value=60*h.getHours()+h.getMinutes(),n[0].disabled=o.checked,n[1].disabled=o.checked}}if(scheduler.config.event_duration&&scheduler.config.auto_end_date){var h=function(){start_date=scheduler.date.add(r[0]._date,n[0].value,"minute"),end_date=new Date(start_date.getTime()+6e4*scheduler.config.event_duration),r[1].value=scheduler.templates.calendar_time(end_date),r[1]._date=scheduler.date.date_part(new Date(end_date)),n[1].value=60*end_date.getHours()+end_date.getMinutes()};n[0].onchange=h}i(r[0],s.start_date,0),i(r[1],s.end_date,1),a=function(){},n[0].value=60*s.start_date.getHours()+s.start_date.getMinutes(),n[1].value=60*s.end_date.getHours()+s.end_date.getMinutes()},get_value:function(e,t){var s=e.getElementsByTagName("input"),i=e.getElementsByTagName("select");t.start_date=scheduler.date.add(s[0]._date,i[0].value,"minute"),t.end_date=scheduler.date.add(s[1]._date,i[1].value,"minute"),t.end_date<=t.start_date&&(t.end_date=scheduler.date.add(t.start_date,scheduler.config.time_step,"minute"))},focus:function(){}},scheduler.linkCalendar=function(e,t){var s=function(){var s=scheduler._date,i=new Date(s.valueOf());return t&&(i=t(i)),i.setDate(1),scheduler.updateCalendar(e,i),!0};scheduler.attachEvent("onViewChange",s),scheduler.attachEvent("onXLE",s),scheduler.attachEvent("onEventAdded",s),scheduler.attachEvent("onEventChanged",s),scheduler.attachEvent("onAfterEventDelete",s),s()},scheduler._markCalendarCurrentDate=function(e){var t=scheduler._date,s=scheduler._mode,i=scheduler.date.month_start(new Date(e._date)),r=scheduler.date.add(i,1,"month");if("day"==s||this._props&&this._props[s])i.valueOf()<=t.valueOf()&&r>t&&scheduler.markCalendar(e,t,"dhx_calendar_click");else if("week"==s)for(var n=scheduler.date.week_start(new Date(t.valueOf())),a=0;7>a;a++)i.valueOf()<=n.valueOf()&&r>n&&scheduler.markCalendar(e,n,"dhx_calendar_click"),n=scheduler.date.add(n,1,"day")},scheduler.attachEvent("onEventCancel",function(){scheduler.destroyCalendar(null,!0)}),(scheduler._temp_matrix_scope=function(){function e(){for(var e=scheduler.get_visible_events(),t=[],s=0;s<this.y_unit.length;s++)t[s]=[];for(t[i]||(t[i]=[]),s=0;s<e.length;s++){for(var i=this.order[e[s][this.y_property]],r=0;this._trace_x[r+1]&&e[s].start_date>=this._trace_x[r+1];)r++;for(;this._trace_x[r]&&e[s].end_date>this._trace_x[r];)t[i][r]||(t[i][r]=[]),t[i][r].push(e[s]),r++}return t}function t(e,t,s){var i=0,r=s._step,n=s.round_position,a=0,d=t?e.end_date:e.start_date;d.valueOf()>scheduler._max_date.valueOf()&&(d=scheduler._max_date);var o=d-scheduler._min_date_timeline;if(o>0){var l=scheduler._get_date_index(s,d);scheduler._ignores[l]&&(n=!0);for(var h=0;l>h;h++)i+=scheduler._cols[h];var _=scheduler.date.add(scheduler._min_date_timeline,scheduler.matrix[scheduler._mode].x_step*l,scheduler.matrix[scheduler._mode].x_unit);n?+d>+_&&t&&(a=scheduler._cols[l]):(o=d-_,s.first_hour||s.last_hour?(o-=s._start_correction,0>o&&(o=0),a=Math.round(o/r),a>scheduler._cols[l]&&(a=scheduler._cols[l])):a=Math.round(o/r))}return i+=t?0==o||n?a-14:a-12:a+1}function s(e,t){var s=scheduler._get_date_index(this,e),i=this._trace_x[s];return t&&+e!=+this._trace_x[s]&&(i=this._trace_x[s+1]?this._trace_x[s+1]:scheduler.date.add(this._trace_x[s],this.x_step,this.x_unit)),new Date(i)}function i(e){var t="";if(e&&"cell"!=this.render){e.sort(this.sort||function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e.id>t.id?1:-1:e.start_date>t.start_date?1:-1});for(var i=[],r=e.length,n=0;r>n;n++){var a=e[n];a._inner=!1;var d=this.round_position?s.apply(this,[a.start_date,!1]):a.start_date;for(this.round_position?s.apply(this,[a.end_date,!0]):a.end_date;i.length;){var o=i[i.length-1];if(!(o.end_date.valueOf()<=d.valueOf()))break;i.splice(i.length-1,1)}for(var l=!1,h=0;h<i.length;h++){var _=i[h];if(_.end_date.valueOf()<=d.valueOf()){l=!0,a._sorder=_._sorder,i.splice(h,1),a._inner=!0;break}}if(i.length&&(i[i.length-1]._inner=!0),!l)if(i.length)if(i.length<=i[i.length-1]._sorder){if(i[i.length-1]._sorder)for(var c=0;c<i.length;c++){for(var u=!1,f=0;f<i.length;f++)if(i[f]._sorder==c){u=!0;break}if(!u){a._sorder=c;break}}else a._sorder=0;a._inner=!0}else{for(var u=i[0]._sorder,p=1;p<i.length;p++)i[p]._sorder>u&&(u=i[p]._sorder);a._sorder=u+1,a._inner=!1}else a._sorder=0;i.push(a),i.length>(i.max_count||0)?(i.max_count=i.length,a._count=i.length):a._count=a._count?a._count:1}for(var m=0;m<e.length;m++)e[m]._count=i.max_count;for(var g=0;r>g;g++)t+=scheduler.render_timeline_event.call(this,e[g],!1)}return t}function r(t){var s="<table style='table-layout:fixed;' cellspacing='0' cellpadding='0'>",r=[];if(scheduler._load_mode&&scheduler._load(),"cell"==this.render)r=e.call(this);else for(var n=scheduler.get_visible_events(),a=this.order,d=0;d<n.length;d++){var o=n[d],l=o[this.y_property],h=this.order[l];if(this.show_unassigned&&!l){for(var _ in a)if(a.hasOwnProperty(_)){h=a[_],r[h]||(r[h]=[]);var c=scheduler._lame_copy({},o);c[this.y_property]=_,r[h].push(c)}}else r[h]||(r[h]=[]),r[h].push(o)}for(var u=0,f=0;f<scheduler._cols.length;f++)u+=scheduler._cols[f];var p=new Date,m=scheduler._cols.length-scheduler._ignores_detected;this._step=p=(scheduler.date.add(p,this.x_step*m,this.x_unit)-p-(this._start_correction+this._end_correction)*m)/u,this._summ=u;var g=scheduler._colsS.heights=[];for(this._events_height={},this._section_height={},f=0;f<this.y_unit.length;f++){var v=this._logic(this.render,this.y_unit[f],this);scheduler._merge(v,{height:this.dy}),this.section_autoheight&&(this.y_unit.length*v.height<t.offsetHeight&&(v.height=Math.max(v.height,Math.floor((t.offsetHeight-1)/this.y_unit.length))),this._section_height[this.y_unit[f].key]=v.height),scheduler._merge(v,{tr_className:"",style_height:"height:"+v.height+"px;",style_width:"width:"+(this.dx-1)+"px;",td_className:"dhx_matrix_scell"+(scheduler.templates[this.name+"_scaley_class"](this.y_unit[f].key,this.y_unit[f].label,this.y_unit[f])?" "+scheduler.templates[this.name+"_scaley_class"](this.y_unit[f].key,this.y_unit[f].label,this.y_unit[f]):""),td_content:scheduler.templates[this.name+"_scale_label"](this.y_unit[f].key,this.y_unit[f].label,this.y_unit[f]),summ_width:"width:"+u+"px;",table_className:""});var x=i.call(this,r[f]);if(this.fit_events){var y=this._events_height[this.y_unit[f].key]||0;v.height=y>v.height?y:v.height,v.style_height="height:"+v.height+"px;",this._section_height[this.y_unit[f].key]=v.height}if(s+="<tr class='"+v.tr_className+"' style='"+v.style_height+"'><td class='"+v.td_className+"' style='"+v.style_width+" height:"+(v.height-1)+"px;'>"+v.td_content+"</td>","cell"==this.render)for(d=0;d<scheduler._cols.length;d++)s+=scheduler._ignores[d]?"<td></td>":"<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](r[f][d],this._trace_x[d],this.y_unit[f])+"' style='width:"+(scheduler._cols[d]-1)+"px'><div style='width:"+(scheduler._cols[d]-1)+"px'>"+scheduler.templates[this.name+"_cell_value"](r[f][d])+"</div></td>";else{for(s+="<td><div style='"+v.summ_width+" "+v.style_height+" position:relative;' class='dhx_matrix_line'>",s+=x,s+="<table class='"+v.table_className+"' cellpadding='0' cellspacing='0' style='"+v.summ_width+" "+v.style_height+"' >",d=0;d<scheduler._cols.length;d++)s+=scheduler._ignores[d]?"<td></td>":"<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](r[f],this._trace_x[d],this.y_unit[f])+"' style='width:"+(scheduler._cols[d]-1)+"px'><div style='width:"+(scheduler._cols[d]-1)+"px'></div></td>";s+="</table>",s+="</div></td>"}s+="</tr>"}s+="</table>",this._matrix=r,t.innerHTML=s,scheduler._rendered=[];for(var b=scheduler._obj.getElementsByTagName("DIV"),f=0;f<b.length;f++)b[f].getAttribute("event_id")&&scheduler._rendered.push(b[f]);for(this._scales={},f=0;f<t.firstChild.rows.length;f++){g.push(t.firstChild.rows[f].offsetHeight);var w=this.y_unit[f].key,D=this._scales[w]=scheduler._isRender("cell")?t.firstChild.rows[f]:t.firstChild.rows[f].childNodes[1].getElementsByTagName("div")[0];scheduler.callEvent("onScaleAdd",[D,w])}}function n(e){var t=scheduler.xy.scale_height,s=this._header_resized||scheduler.xy.scale_height;scheduler._cols=[],scheduler._colsS={height:0},this._trace_x=[];var i=scheduler._x-this.dx-scheduler.xy.scroll_width,r=[this.dx],n=scheduler._els.dhx_cal_header[0];n.style.width=r[0]+i+"px",scheduler._min_date_timeline=scheduler._min_date;var d=scheduler.config.preserve_scale_length,o=scheduler._min_date;scheduler._process_ignores(o,this.x_size,this.x_unit,this.x_step,d);var l=this.x_size+(d?scheduler._ignores_detected:0);l!=this.x_size&&(scheduler._max_date=scheduler.date.add(scheduler._min_date,l*this.x_step,this.x_unit));for(var h=l-scheduler._ignores_detected,_=0;l>_;_++)this._trace_x[_]=new Date(o),o=scheduler.date.add(o,this.x_step,this.x_unit),scheduler._ignores[_]?(scheduler._cols[_]=0,h++):scheduler._cols[_]=Math.floor(i/(h-_)),i-=scheduler._cols[_],r[_+1]=r[_]+scheduler._cols[_];if(e.innerHTML="<div></div>",this.second_scale){for(var u=this.second_scale.x_unit,f=[this._trace_x[0]],p=[],m=[this.dx,this.dx],g=0,v=0;v<this._trace_x.length;v++){var x=this._trace_x[v],y=a(u,x,f[g]);y&&(++g,f[g]=x,m[g+1]=m[g]);var b=g+1;p[g]=scheduler._cols[v]+(p[g]||0),m[b]+=scheduler._cols[v]}e.innerHTML="<div></div><div></div>";var w=e.firstChild;w.style.height=s+"px";var D=e.lastChild;D.style.position="relative";for(var E=0;E<f.length;E++){var O=f[E],k=scheduler.templates[this.name+"_second_scalex_class"](O),M=document.createElement("DIV");M.className="dhx_scale_bar dhx_second_scale_bar"+(k?" "+k:""),scheduler.set_xy(M,p[E]-1,s-3,m[E],0),M.innerHTML=scheduler.templates[this.name+"_second_scale_date"](O),w.appendChild(M)}}scheduler.xy.scale_height=s;for(var e=e.lastChild,C=0;C<this._trace_x.length;C++)if(!scheduler._ignores[C]){o=this._trace_x[C],scheduler._render_x_header(C,r[C],o,e);var N=scheduler.templates[this.name+"_scalex_class"](o);N&&(e.lastChild.className+=" "+N)}scheduler.xy.scale_height=t;var T=this._trace_x;e.onclick=function(e){var t=c(e);t&&scheduler.callEvent("onXScaleClick",[t.x,T[t.x],e||event])},e.ondblclick=function(e){var t=c(e);t&&scheduler.callEvent("onXScaleDblClick",[t.x,T[t.x],e||event])}}function a(e,t,s){switch(e){case"hour":return t.getHours()!=s.getHours()||a("day",t,s);case"day":return!(t.getDate()==s.getDate()&&t.getMonth()==s.getMonth()&&t.getFullYear()==s.getFullYear());case"week":return!(scheduler.date.getISOWeek(t)==scheduler.date.getISOWeek(s)&&t.getFullYear()==s.getFullYear());case"month":return!(t.getMonth()==s.getMonth()&&t.getFullYear()==s.getFullYear());case"year":return t.getFullYear()!=s.getFullYear();default:return!1}}function d(e){if(e){scheduler.set_sizes(),h();var t=scheduler._min_date;n.call(this,scheduler._els.dhx_cal_header[0]),r.call(this,scheduler._els.dhx_cal_data[0]),scheduler._min_date=t,scheduler._els.dhx_cal_date[0].innerHTML=scheduler.templates[this.name+"_date"](scheduler._min_date,scheduler._max_date),scheduler._mark_now&&scheduler._mark_now()}o()}function o(){scheduler._tooltip&&(scheduler._tooltip.style.display="none",scheduler._tooltip.date="")}function l(e,t,s){if("cell"==e.render){var i=t.x+"_"+t.y,r=e._matrix[t.y][t.x];if(!r)return o();if(r.sort(function(e,t){return e.start_date>t.start_date?1:-1}),scheduler._tooltip){if(scheduler._tooltip.date==i)return;scheduler._tooltip.innerHTML=""}else{var n=scheduler._tooltip=document.createElement("DIV");n.className="dhx_year_tooltip",document.body.appendChild(n),n.onclick=scheduler._click.dhx_cal_data}for(var a="",d=0;d<r.length;d++){var l=r[d].color?"background-color:"+r[d].color+";":"",h=r[d].textColor?"color:"+r[d].textColor+";":"";a+="<div class='dhx_tooltip_line' event_id='"+r[d].id+"' style='"+l+h+"'>",a+="<div class='dhx_tooltip_date'>"+(r[d]._timed?scheduler.templates.event_date(r[d].start_date):"")+"</div>",a+="<div class='dhx_event_icon icon_details'>&nbsp;</div>",a+=scheduler.templates[e.name+"_tooltip"](r[d].start_date,r[d].end_date,r[d])+"</div>"}scheduler._tooltip.style.display="",scheduler._tooltip.style.top="0px",scheduler._tooltip.style.left=document.body.offsetWidth-s.left-scheduler._tooltip.offsetWidth<0?s.left-scheduler._tooltip.offsetWidth+"px":s.left+t.src.offsetWidth+"px",scheduler._tooltip.date=i,scheduler._tooltip.innerHTML=a,scheduler._tooltip.style.top=document.body.offsetHeight-s.top-scheduler._tooltip.offsetHeight<0?s.top-scheduler._tooltip.offsetHeight+t.src.offsetHeight+"px":s.top+"px"}}function h(){dhtmlxEvent(scheduler._els.dhx_cal_data[0],"mouseover",function(e){var t=scheduler.matrix[scheduler._mode];if(t&&"cell"==t.render){if(t){{var s=scheduler._locate_cell_timeline(e),e=e||event;e.target||e.srcElement}if(s)return l(t,s,getOffset(s.src))}o()}}),h=function(){}}function _(e){for(var t=e.parentNode.childNodes,s=0;s<t.length;s++)if(t[s]==e)return s;return-1}function c(e){for(var e=e||event,t=e.target?e.target:e.srcElement;t&&"DIV"!=t.tagName;)t=t.parentNode;if(t&&"DIV"==t.tagName){var s=t.className.split(" ")[0];if("dhx_scale_bar"==s)return{x:_(t),y:-1,src:t,scale:!0}}}scheduler.matrix={},scheduler._merge=function(e,t){for(var s in t)"undefined"==typeof e[s]&&(e[s]=t[s])},scheduler.createTimelineView=function(e){scheduler._skin_init(),scheduler._merge(e,{section_autoheight:!0,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,event_dy:scheduler.xy.bar_height-5,event_min_dy:scheduler.xy.bar_height-5,resize_events:!0,fit_events:!0,show_unassigned:!1,second_scale:!1,round_position:!1,_logic:function(e,t,s){var i={};return scheduler.checkEvent("onBeforeSectionRender")&&(i=scheduler.callEvent("onBeforeSectionRender",[e,t,s])),i}}),e._original_x_start=e.x_start,"day"!=e.x_unit&&(e.first_hour=e.last_hour=0),e._start_correction=e.first_hour?36e5*e.first_hour:0,e._end_correction=e.last_hour?36e5*(24-e.last_hour):0,scheduler.checkEvent("onTimelineCreated")&&scheduler.callEvent("onTimelineCreated",[e]);var t=scheduler.render_data;scheduler.render_data=function(s,i){if(this._mode!=e.name)return t.apply(this,arguments);if(i&&!e.show_unassigned&&"cell"!=e.render)for(var r=0;r<s.length;r++)this.clear_event(s[r]),this.render_timeline_event.call(this.matrix[this._mode],s[r],!0);else scheduler._renderMatrix.call(e,!0,!0)},scheduler.matrix[e.name]=e,scheduler.templates[e.name+"_cell_value"]=function(e){return e?e.length:""},scheduler.templates[e.name+"_cell_class"]=function(){return""},scheduler.templates[e.name+"_scalex_class"]=function(){return""},scheduler.templates[e.name+"_second_scalex_class"]=function(){return""},scheduler.templates[e.name+"_scaley_class"]=function(){return""},scheduler.templates[e.name+"_scale_label"]=function(e,t){return t},scheduler.templates[e.name+"_tooltip"]=function(e,t,s){return s.text},scheduler.templates[e.name+"_date"]=function(e,t){return e.getDay()==t.getDay()&&864e5>t-e||+e==+scheduler.date.date_part(new Date(t))||+scheduler.date.add(e,1,"day")==+t&&0==t.getHours()&&0==t.getMinutes()?scheduler.templates.day_date(e):e.getDay()!=t.getDay()&&864e5>t-e?scheduler.templates.day_date(e)+" &ndash; "+scheduler.templates.day_date(t):scheduler.templates.week_date(e,t)},scheduler.templates[e.name+"_scale_date"]=scheduler.date.date_to_str(e.x_date||scheduler.config.hour_date),scheduler.templates[e.name+"_second_scale_date"]=scheduler.date.date_to_str(e.second_scale&&e.second_scale.x_date?e.second_scale.x_date:scheduler.config.hour_date),scheduler.date["add_"+e.name]=function(t,s){var i=scheduler.date.add(t,(e.x_length||e.x_size)*s*e.x_step,e.x_unit);if("minute"==e.x_unit||"hour"==e.x_unit){var r=e.x_length||e.x_size;if(+scheduler.date.date_part(new Date(t))==+scheduler.date.date_part(new Date(i)))e.x_start+=s*r;else{var n="hour"==e.x_unit?60*e.x_step:e.x_step,a=1440/(r*n)-1,d=Math.round(a*r);s>0?e.x_start-=d:e.x_start=d+e.x_start}}return i},scheduler.attachEvent("onBeforeTodayDisplayed",function(){return e.x_start=e._original_x_start,!0}),scheduler.date[e.name+"_start"]=function(t){var s=scheduler.date[e.x_unit+"_start"]||scheduler.date.day_start,i=s.call(scheduler.date,t);return i=scheduler.date.add(i,e.x_step*e.x_start,e.x_unit)},scheduler.attachEvent("onSchedulerResize",function(){return this._mode==e.name?(scheduler._renderMatrix.call(e,!0,!0),!1):!0}),scheduler.attachEvent("onOptionsLoad",function(){e.order={},scheduler.callEvent("onOptionsLoadStart",[]);for(var t=0;t<e.y_unit.length;t++)e.order[e.y_unit[t].key]=t;scheduler.callEvent("onOptionsLoadFinal",[]),scheduler._date&&e.name==scheduler._mode&&scheduler.setCurrentView(scheduler._date,scheduler._mode)}),scheduler.callEvent("onOptionsLoad",[e]),scheduler[e.name+"_view"]=function(){scheduler._renderMatrix.apply(e,arguments)};{var i=new Date;scheduler.date.add(i,e.x_step,e.x_unit).valueOf()-i.valueOf()}scheduler["mouse_"+e.name]=function(t){var i=this._drag_event;this._drag_id&&(i=this.getEvent(this._drag_id),this._drag_event._dhx_changed=!0),t.x-=e.dx;for(var r=0,n=0,a=0;n<=this._cols.length-1;n++){var d=this._cols[n];if(r+=d,r>t.x){var o=(t.x-(r-d))/d,o=0>o?0:o;break}}if(0==n&&this._ignores[0])for(n=1,o=0;this._ignores[n];)n++;else if(n==this._cols.length&&this._ignores[n-1]){for(n=this._cols.length-1,o=0;this._ignores[n];)n--;n++}for(r=0;a<this._colsS.heights.length&&(r+=this._colsS.heights[a],!(r>t.y));a++);if(t.fields={},e.y_unit[a]||(a=e.y_unit.length-1),a>=0&&e.y_unit[a]&&(t.section=t.fields[e.y_property]=e.y_unit[a].key,i)){if(i[e.y_property]!=t.section){var l=scheduler._get_timeline_event_height(i,e);i._sorder=scheduler._get_dnd_order(i._sorder,l,e._section_height[t.section])}i[e.y_property]=t.section}t.x=0,t.force_redraw=!0,t.custom=!0;var h;if(n>=e._trace_x.length)h=scheduler.date.add(e._trace_x[e._trace_x.length-1],e.x_step,e.x_unit),e._end_correction&&(h=new Date(h-e._end_correction));else{var _=o*d*e._step+e._start_correction;h=new Date(+e._trace_x[n]+_)}if("move"==this._drag_mode&&this._drag_id&&this._drag_event){var i=this.getEvent(this._drag_id),c=this._drag_event;if(t._ignores=this._ignores_detected||e._start_correction||e._end_correction,!c._move_delta&&(c._move_delta=(i.start_date-h)/6e4,this.config.preserve_length&&t._ignores)&&(c._move_delta=this._get_real_event_length(i.start_date,h,e),c._event_length=this._get_real_event_length(i.start_date,i.end_date,e)),this.config.preserve_length&&t._ignores){var u=(c._event_length,this._get_fictional_event_length(h,c._move_delta,e,!0));h=new Date(h-u)}else h=scheduler.date.add(h,c._move_delta,"minute")}if("resize"==this._drag_mode&&i){var f=!!(Math.abs(i.start_date-h)<Math.abs(i.end_date-h));if(e._start_correction||e._end_correction){var p=!this._drag_event||void 0==this._drag_event._resize_from_start;p||Math.abs(i.end_date-i.start_date)<=6e4*this.config.time_step?this._drag_event._resize_from_start=t.resize_from_start=f:t.resize_from_start=this._drag_event._resize_from_start}else t.resize_from_start=f}if(e.round_position)switch(this._drag_mode){case"move":this.config.preserve_length||(h=s.call(e,h,!1),"day"!=e.x_unit)||(t.custom=!1);break;case"resize":this._drag_event&&(null==this._drag_event._resize_from_start&&(this._drag_event._resize_from_start=t.resize_from_start),t.resize_from_start=this._drag_event._resize_from_start,h=s.call(e,h,!this._drag_event._resize_from_start))}return t.y=Math.round((h-this._min_date)/(6e4*this.config.time_step)),t.shift=this.config.time_step,t}},scheduler._get_timeline_event_height=function(e,t){var s=e[t.y_property],i=t.event_dy;return"full"==t.event_dy&&(i=t.section_autoheight?t._section_height[s]-6:t.dy-3),t.resize_events&&(i=Math.max(Math.floor(i/e._count),t.event_min_dy)),i},scheduler._get_timeline_event_y=function(e,t){var s=e,i=2+s*t+(s?2*s:0);return scheduler.config.cascade_event_display&&(i=2+s*scheduler.config.cascade_event_margin+(s?2*s:0)),i},scheduler.render_timeline_event=function(e,s){var i=e[this.y_property];if(!i)return"";var r=e._sorder,n=t(e,!1,this),a=t(e,!0,this),d=scheduler._get_timeline_event_height(e,this),o=d-2;!e._inner&&"full"==this.event_dy&&(o=(o+2)*(e._count-r)-2);var l=scheduler._get_timeline_event_y(e._sorder,d),h=d+l+2;(!this._events_height[i]||this._events_height[i]<h)&&(this._events_height[i]=h);
var _=scheduler.templates.event_class(e.start_date,e.end_date,e),_="dhx_cal_event_line "+(_||""),c=e.color?"background:"+e.color+";":"",u=e.textColor?"color:"+e.textColor+";":"",f=scheduler.templates.event_bar_text(e.start_date,e.end_date,e),p='<div event_id="'+e.id+'" class="'+_+'" style="'+c+u+"position:absolute; top:"+l+"px; height: "+o+"px; left:"+n+"px; width:"+Math.max(0,a-n)+"px;"+(e._text_style||"")+'">';if(scheduler.config.drag_resize&&!scheduler.config.readonly){var m="dhx_event_resize";p+="<div class='"+m+" "+m+"_start' style='height: "+o+"px;'></div><div class='"+m+" "+m+"_end' style='height: "+o+"px;'></div>"}if(p+=f+"</div>",!s)return p;var g=document.createElement("DIV");g.innerHTML=p;var v=this.order[i],x=scheduler._els.dhx_cal_data[0].firstChild.rows[v].cells[1].firstChild;scheduler._rendered.push(g.firstChild),x.appendChild(g.firstChild)},scheduler._renderMatrix=function(e,t){if(t||(scheduler._els.dhx_cal_data[0].scrollTop=0),scheduler._min_date=scheduler.date[this.name+"_start"](scheduler._date),scheduler._max_date=scheduler.date.add(scheduler._min_date,this.x_size*this.x_step,this.x_unit),scheduler._table_view=!0,this.second_scale&&(e&&!this._header_resized&&(this._header_resized=scheduler.xy.scale_height,scheduler.xy.scale_height*=2,scheduler._els.dhx_cal_header[0].className+=" dhx_second_cal_header"),!e&&this._header_resized)){scheduler.xy.scale_height/=2,this._header_resized=!1;var s=scheduler._els.dhx_cal_header[0];s.className=s.className.replace(/ dhx_second_cal_header/gi,"")}d.call(this,e)},scheduler._locate_cell_timeline=function(e){for(var e=e||event,t=e.target?e.target:e.srcElement,s={},i=scheduler.matrix[scheduler._mode],r=scheduler.getActionData(e),n=0;n<i._trace_x.length-1&&!(+r.date<i._trace_x[n+1]);n++);s.x=n,s.y=i.order[r.section];var a=scheduler._isRender("cell")?1:0;s.src=i._scales[r.section]?i._scales[r.section].getElementsByTagName("td")[n+a]:null;for(var d=!1;0==s.x&&"dhx_cal_data"!=t.className&&t.parentNode;){if("dhx_matrix_scell"==t.className.split(" ")[0]){d=!0;break}t=t.parentNode}return d&&(s.x=-1,s.src=t,s.scale=!0),s};var u=scheduler._click.dhx_cal_data;scheduler._click.dhx_marked_timespan=scheduler._click.dhx_cal_data=function(e){var t=u.apply(this,arguments),s=scheduler.matrix[scheduler._mode];if(s){var i=scheduler._locate_cell_timeline(e);i&&(i.scale?scheduler.callEvent("onYScaleClick",[i.y,s.y_unit[i.y],e||event]):scheduler.callEvent("onCellClick",[i.x,i.y,s._trace_x[i.x],(s._matrix[i.y]||{})[i.x]||[],e||event]))}return t},scheduler.dblclick_dhx_marked_timespan=scheduler.dblclick_dhx_matrix_cell=function(e){var t=scheduler.matrix[scheduler._mode];if(t){var s=scheduler._locate_cell_timeline(e);s&&(s.scale?scheduler.callEvent("onYScaleDblClick",[s.y,t.y_unit[s.y],e||event]):scheduler.callEvent("onCellDblClick",[s.x,s.y,t._trace_x[s.x],(t._matrix[s.y]||{})[s.x]||[],e||event]))}},scheduler.dblclick_dhx_matrix_scell=function(e){return scheduler.dblclick_dhx_matrix_cell(e)},scheduler._isRender=function(e){return scheduler.matrix[scheduler._mode]&&scheduler.matrix[scheduler._mode].render==e},scheduler.attachEvent("onCellDblClick",function(e,t,s,i,r){if(!this.config.readonly&&("dblclick"!=r.type||this.config.dblclick_create)){var n=scheduler.matrix[scheduler._mode],a={};a.start_date=n._trace_x[e],a.end_date=n._trace_x[e+1]?n._trace_x[e+1]:scheduler.date.add(n._trace_x[e],n.x_step,n.x_unit),n._start_correction&&(a.start_date=new Date(1*a.start_date+n._start_correction)),n._end_correction&&(a.end_date=new Date(a.end_date-n._end_correction)),a[n.y_property]=n.y_unit[t].key,scheduler.addEventNow(a,null,r)}}),scheduler.attachEvent("onBeforeDrag",function(){return!scheduler._isRender("cell")}),scheduler.attachEvent("onEventChanged",function(e,t){t._timed=this.isOneDayEvent(t)});var f=scheduler._render_marked_timespan;scheduler._render_marked_timespan=function(e,s,i,r,n){if(!scheduler.config.display_marked_timespans)return[];if(!scheduler.matrix||!scheduler.matrix[scheduler._mode])return f.apply(scheduler,[e,s,i]);if(!scheduler._isRender("cell")){var a=scheduler._lame_copy({},scheduler.matrix[scheduler._mode]);a.round_position=!1;var d=[],o=[],l=[];if(i)l=[s],o=[i];else{var h,_=a.order;for(h in _)_.hasOwnProperty(h)&&(o.push(h),l.push(a._scales[h]))}var r=r?new Date(r):scheduler._min_date,n=n?new Date(n):scheduler._max_date,c=[];if(e.days>6){var u=new Date(e.days);scheduler.date.date_part(new Date(r))<=+u&&+n>=+u&&c.push(u)}else c.push.apply(c,scheduler._get_dates_by_index(e.days));for(var p=e.zones,m=scheduler._get_css_classes_by_config(e),g=0;g<o.length;g++)for(var s=l[g],i=o[g],v=0;v<c.length;v++)for(var x=c[v],y=0;y<p.length;y+=2){var b=p[y],w=p[y+1],D=new Date(+x+6e4*b),E=new Date(+x+6e4*w);if(E>r&&n>D){var O=scheduler._get_block_by_config(e);O.className=m;var k=t({start_date:D},!1,a)-1,M=t({start_date:E},!1,a)-1,C=Math.max(1,M-k-1),N=a._section_height[i]-1;O.style.cssText="height: "+N+"px; left: "+k+"px; width: "+C+"px; top: 0;",s.insertBefore(O,s.firstChild),d.push(O)}}return d}};var p=scheduler._append_mark_now;scheduler._append_mark_now=function(e,t){if(scheduler.matrix&&scheduler.matrix[scheduler._mode]){var s=scheduler._currentDate(),i=scheduler._get_zone_minutes(s),r={days:+scheduler.date.date_part(s),zones:[i,i+1],css:"dhx_matrix_now_time",type:"dhx_now_time"};return scheduler._render_marked_timespan(r)}return p.apply(scheduler,[e,t])},scheduler.attachEvent("onScaleAdd",function(e,t){var s=scheduler._marked_timespans;if(s&&scheduler.matrix&&scheduler.matrix[scheduler._mode])for(var i=scheduler._mode,r=scheduler._min_date,n=scheduler._max_date,a=s.global,d=scheduler.date.date_part(new Date(r));n>d;d=scheduler.date.add(d,1,"day")){var o=+d,l=d.getDay(),h=[],_=a[o]||a[l];if(h.push.apply(h,scheduler._get_configs_to_render(_)),s[i]&&s[i][t]){var c=[],u=scheduler._get_types_to_render(s[i][t][l],s[i][t][o]);c.push.apply(c,scheduler._get_configs_to_render(u)),c.length&&(h=c)}for(var f=0;f<h.length;f++){var p=h[f],m=p.days;7>m?(m=o,scheduler._render_marked_timespan(p,e,t,d,scheduler.date.add(d,1,"day")),m=l):scheduler._render_marked_timespan(p,e,t,d,scheduler.date.add(d,1,"day"))}}}),scheduler._get_date_index=function(e,t){for(var s=0,i=e._trace_x;s<i.length-1&&+t>=+i[s+1];)s++;return s}})(),window.dhtmlXTooltip=scheduler.dhtmlXTooltip=window.dhtmlxTooltip={},dhtmlXTooltip.config={className:"dhtmlXTooltip tooltip",timeout_to_display:50,timeout_to_hide:50,delta_x:15,delta_y:-20},dhtmlXTooltip.tooltip=document.createElement("div"),dhtmlXTooltip.tooltip.className=dhtmlXTooltip.config.className,dhtmlXTooltip.show=function(e,t){if(!scheduler.config.touch||scheduler.config.touch_tooltip){var s=dhtmlXTooltip,i=this.tooltip,r=i.style;s.tooltip.className=s.config.className;var n=this.position(e),a=e.target||e.srcElement;if(!this.isTooltip(a)){var d=n.x+(s.config.delta_x||0),o=n.y-(s.config.delta_y||0);r.visibility="hidden",r.removeAttribute?(r.removeAttribute("right"),r.removeAttribute("bottom")):(r.removeProperty("right"),r.removeProperty("bottom")),r.left="0",r.top="0",this.tooltip.innerHTML=t,document.body.appendChild(this.tooltip);var l=this.tooltip.offsetWidth,h=this.tooltip.offsetHeight;document.body.offsetWidth-d-l<0?(r.removeAttribute?r.removeAttribute("left"):r.removeProperty("left"),r.right=document.body.offsetWidth-d+2*(s.config.delta_x||0)+"px"):r.left=0>d?n.x+Math.abs(s.config.delta_x||0)+"px":d+"px",document.body.offsetHeight-o-h<0?(r.removeAttribute?r.removeAttribute("top"):r.removeProperty("top"),r.bottom=document.body.offsetHeight-o-2*(s.config.delta_y||0)+"px"):r.top=0>o?n.y+Math.abs(s.config.delta_y||0)+"px":o+"px",r.visibility="visible",scheduler.callEvent("onTooltipDisplayed",[this.tooltip,this.tooltip.event_id])}}},dhtmlXTooltip._clearTimeout=function(){this.tooltip._timeout_id&&window.clearTimeout(this.tooltip._timeout_id)},dhtmlXTooltip.hide=function(){if(this.tooltip.parentNode){var e=this.tooltip.event_id;this.tooltip.event_id=null,this.tooltip.parentNode.removeChild(this.tooltip),scheduler.callEvent("onAfterTooltip",[e])}this._clearTimeout()},dhtmlXTooltip.delay=function(e,t,s,i){this._clearTimeout(),this.tooltip._timeout_id=setTimeout(function(){var i=e.apply(t,s);return e=t=s=null,i},i||this.config.timeout_to_display)},dhtmlXTooltip.isTooltip=function(e){var t=!1;for(e.className.split(" ");e&&!t;)t=e.className==this.tooltip.className,e=e.parentNode;return t},dhtmlXTooltip.position=function(e){if(e=e||window.event,e.pageX||e.pageY)return{x:e.pageX,y:e.pageY};var t=window._isIE&&"BackCompat"!=document.compatMode?document.documentElement:document.body;return{x:e.clientX+t.scrollLeft-t.clientLeft,y:e.clientY+t.scrollTop-t.clientTop}},scheduler.attachEvent("onMouseMove",function(e,t){var s=window.event||t,i=s.target||s.srcElement,r=dhtmlXTooltip,n=r.isTooltip(i),a=r.isTooltipTarget&&r.isTooltipTarget(i);if(e||n||a){var d;if(e||r.tooltip.event_id){var o=scheduler.getEvent(e)||scheduler.getEvent(r.tooltip.event_id);if(!o)return;if(r.tooltip.event_id=o.id,d=scheduler.templates.tooltip_text(o.start_date,o.end_date,o),!d)return r.hide()}a&&(d="");var l=void 0;_isIE&&(l=document.createEventObject(s)),scheduler.callEvent("onBeforeTooltip",[e])&&d&&r.delay(r.show,r,[l||s,d])}else r.delay(r.hide,r,[],r.config.timeout_to_hide)}),scheduler.attachEvent("onBeforeDrag",function(){return dhtmlXTooltip.hide(),!0}),scheduler.attachEvent("onEventDeleted",function(){return dhtmlXTooltip.hide(),!0}),scheduler.templates.tooltip_date_format=scheduler.date.date_to_str("%Y-%m-%d %H:%i"),scheduler.templates.tooltip_text=function(e,t,s){return"<b>Event:</b> "+s.text+"<br/><b>Start date:</b> "+scheduler.templates.tooltip_date_format(e)+"<br/><b>End date:</b> "+scheduler.templates.tooltip_date_format(t)},scheduler._props={},scheduler.createUnitsView=function(e,t,s,i,r,n){"object"==typeof e&&(s=e.list,t=e.property,i=e.size||0,r=e.step||1,n=e.skip_incorrect,e=e.name),scheduler._props[e]={map_to:t,options:s,step:r,position:0},i>scheduler._props[e].options.length&&(scheduler._props[e]._original_size=i,i=0),scheduler._props[e].size=i,scheduler._props[e].skip_incorrect=n||!1,scheduler.date[e+"_start"]=scheduler.date.day_start,scheduler.templates[e+"_date"]=function(e){return scheduler.templates.day_date(e)},scheduler._get_unit_index=function(e,t){var s=e.position||0,i=Math.floor((scheduler._correct_shift(+t,1)-+scheduler._min_date)/864e5);return s+i},scheduler.templates[e+"_scale_text"]=function(e,t,s){return s.css?"<span class='"+s.css+"'>"+t+"</span>":t},scheduler.templates[e+"_scale_date"]=function(t){var s=scheduler._props[e],i=s.options;if(!i.length)return"";var r=scheduler._get_unit_index(s,t),n=i[r];return scheduler.templates[e+"_scale_text"](n.key,n.label,n)},scheduler.date["add_"+e]=function(e,t){return scheduler.date.add(e,t,"day")},scheduler.date["get_"+e+"_end"]=function(t){return scheduler.date.add(t,scheduler._props[e].size||scheduler._props[e].options.length,"day")},scheduler.attachEvent("onOptionsLoad",function(){for(var t=scheduler._props[e],s=t.order={},i=t.options,r=0;r<i.length;r++)s[i[r].key]=r;t._original_size&&0==t.size&&(t.size=t._original_size,delete t.original_size),t.size>i.length?(t._original_size=t.size,t.size=0):t.size=t._original_size||t.size,scheduler._date&&scheduler._mode==e&&scheduler.setCurrentView(scheduler._date,scheduler._mode)}),scheduler.callEvent("onOptionsLoad",[])},scheduler.scrollUnit=function(e){var t=scheduler._props[this._mode];t&&(t.position=Math.min(Math.max(0,t.position+e),t.options.length-t.size),this.update_view())},function(){var e=function(e){var t=scheduler._props[scheduler._mode];if(t&&t.order&&t.skip_incorrect){for(var s=[],i=0;i<e.length;i++)"undefined"!=typeof t.order[e[i][t.map_to]]&&s.push(e[i]);e.splice(0,e.length),e.push.apply(e,s)}return e},t=scheduler._pre_render_events_table;scheduler._pre_render_events_table=function(s,i){return s=e(s),t.apply(this,[s,i])};var s=scheduler._pre_render_events_line;scheduler._pre_render_events_line=function(t,i){return t=e(t),s.apply(this,[t,i])};var i=function(e,t){if(e&&"undefined"==typeof e.order[t[e.map_to]]){var s=scheduler,i=864e5,r=Math.floor((t.end_date-s._min_date)/i);return t[e.map_to]=e.options[Math.min(r+e.position,e.options.length-1)].key,!0}},r=scheduler._reset_scale,n=scheduler.is_visible_events;scheduler.is_visible_events=function(e){var t=n.apply(this,arguments);if(t){var s=scheduler._props[this._mode];if(s&&s.size){var i=s.order[e[s.map_to]];if(i<s.position||i>=s.size+s.position)return!1}}return t},scheduler._reset_scale=function(){var e=scheduler._props[this._mode],t=r.apply(this,arguments);if(e){this._max_date=this.date.add(this._min_date,1,"day");for(var s=this._els.dhx_cal_data[0].childNodes,i=0;i<s.length;i++)s[i].className=s[i].className.replace("_now","");if(e.size&&e.size<e.options.length){var n=this._els.dhx_cal_header[0],a=document.createElement("DIV");e.position&&(a.className="dhx_cal_prev_button",a.style.cssText="left:1px;top:2px;position:absolute;",a.innerHTML="&nbsp;",n.firstChild.appendChild(a),a.onclick=function(){scheduler.scrollUnit(-1*e.step)}),e.position+e.size<e.options.length&&(a=document.createElement("DIV"),a.className="dhx_cal_next_button",a.style.cssText="left:auto; right:0px;top:2px;position:absolute;",a.innerHTML="&nbsp;",n.lastChild.appendChild(a),a.onclick=function(){scheduler.scrollUnit(e.step)})}}return t};var a=scheduler._get_event_sday;scheduler._get_event_sday=function(e){var t=scheduler._props[this._mode];return t?(i(t,e),t.order[e[t.map_to]]-t.position):a.call(this,e)};var d=scheduler.locate_holder_day;scheduler.locate_holder_day=function(e,t,s){var r=scheduler._props[this._mode];return r&&s?(i(r,s),1*r.order[s[r.map_to]]+(t?1:0)-r.position):d.apply(this,arguments)};var o=scheduler._mouse_coords;scheduler._mouse_coords=function(){var e=scheduler._props[this._mode],t=o.apply(this,arguments);if(e){this._drag_event||(this._drag_event={});var s=this._drag_event;this._drag_id&&this._drag_mode&&(s=this.getEvent(this._drag_id),this._drag_event._dhx_changed=!0);var i=Math.min(t.x+e.position,e.options.length-1),r=e.map_to;t.section=s[r]=(e.options[i]||{}).key,t.x=0}return t.force_redraw=!0,t};var l=scheduler._time_order;scheduler._time_order=function(e){var t=scheduler._props[this._mode];t?e.sort(function(e,s){return t.order[e[t.map_to]]>t.order[s[t.map_to]]?1:-1}):l.apply(this,arguments)},scheduler.attachEvent("onEventAdded",function(e,t){if(this._loading)return!0;for(var s in scheduler._props){var i=scheduler._props[s];"undefined"==typeof t[i.map_to]&&(t[i.map_to]=i.options[0].key)}return!0}),scheduler.attachEvent("onEventCreated",function(e,t){var s=scheduler._props[this._mode];if(s&&t){var r=this.getEvent(e);this._mouse_coords(t),i(s,r),this.event_updated(r)}return!0})}(),scheduler.locale={date:{month_full:["Январь","Февраль","Март","Апрель","Maй","Июнь","Июль","Август","Сентябрь","Oктябрь","Ноябрь","Декабрь"],month_short:["Янв","Фев","Maр","Aпр","Maй","Июн","Июл","Aвг","Сен","Окт","Ноя","Дек"],day_full:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],day_short:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"]},labels:{dhx_cal_today_button:"Сегодня",day_tab:"День",week_tab:"Неделя",month_tab:"Месяц",new_event:"Новое событие",icon_save:"Сохранить",icon_cancel:"Отменить",icon_details:"Детали",icon_edit:"Изменить",icon_delete:"Удалить",confirm_closing:"",confirm_deleting:"Событие будет удалено безвозвратно, продолжить?",section_description:"Описание",section_time:"Период времени",full_day:"Весь день",confirm_recurring:"Вы хотите изменить всю серию повторяющихся событий?",section_recurring:"Повторение",button_recurring:"Отключено",button_recurring_open:"Включено",button_edit_series:"Редактировать серию",button_edit_occurrence:"Редактировать экземпляр",agenda_tab:"Список",date:"Дата",description:"Описание",year_tab:"Год",week_agenda_tab:"Список",grid_tab:"Таблица"}};var dhtmlXCombo_optionTypes=[];dhtmlXCombo.prototype.setSize=function(e){this.DOMlist.style.width=e+"px",this.DOMlistF&&(this.DOMlistF.style.width=e+"px"),this.DOMelem.style.width=e+"px",this.DOMelem_input.style.width=Math.max(0,e-19)+"px"},dhtmlXCombo.prototype.enableFilteringMode=function(e,t,s,i){this._filter=convertStringToBoolean(e),t&&(this._xml=t,this._autoxml=convertStringToBoolean(i)),convertStringToBoolean(s)&&(this._xmlCache=[])},dhtmlXCombo.prototype.setFilteringParam=function(e,t){this._prs||(this._prs=[]),this._prs.push([e,t])},dhtmlXCombo.prototype.disable=function(e){var t=convertStringToBoolean(e);this._disabled!=t&&(this._disabled=this.DOMelem_input.disabled=t)},dhtmlXCombo.prototype.readonly=function(e,t){if(this.DOMelem_input.readOnly=e?!0:!1,t===!1||e===!1)this.DOMelem.onkeyup=function(){};else{var s=this;this.DOMelem.onkeyup=function(e){if(e=e||window.event,9!=e.keyCode&&(e.cancelBubble=!0),e.keyCode>=48&&e.keyCode<=57||e.keyCode>=65&&e.keyCode<=90){for(var t=0;t<s.optionsArr.length;t++){var i=s.optionsArr[t].text;if(0==i.toString().toUpperCase().indexOf(String.fromCharCode(e.keyCode))){s.selectOption(t);break}}e.cancelBubble=!0}}}},dhtmlXCombo.prototype.getOption=function(e){for(var t=0;t<this.optionsArr.length;t++)if(this.optionsArr[t].value==e)return this.optionsArr[t];return null},dhtmlXCombo.prototype.getOptionByLabel=function(e){for(var t=0;t<this.optionsArr.length;t++)if(this.optionsArr[t].text==e||this.optionsArr[t]._ctext==e)return this.optionsArr[t];return null},dhtmlXCombo.prototype.getOptionByIndex=function(e){return this.optionsArr[e]},dhtmlXCombo.prototype.clearAll=function(e){e&&this.setComboText(""),this.optionsArr=[],this.redrawOptions(),e&&this._confirmSelection()},dhtmlXCombo.prototype.deleteOption=function(e){var t=this.getIndexByValue(e);0>t||(this.optionsArr[t]==this._selOption&&(this._selOption=null),this.optionsArr.splice(t,1),this.redrawOptions())},dhtmlXCombo.prototype.render=function(e){this._skiprender=!convertStringToBoolean(e),this.redrawOptions()},dhtmlXCombo.prototype.updateOption=function(e,t,s,i){var r=this.getOption(e);"object"!=typeof t&&(t={text:s,value:t,css:i}),r.setValue(t),this.redrawOptions()},dhtmlXCombo.prototype.addOption=function(e){args=arguments[0].length&&"object"==typeof arguments[0]?e:[arguments],this.render(!1);for(var t=0;t<args.length;t++){var s=args[t];s.length&&(s.value=s[0]||"",s.text=s[1]||"",s.css=s[2]||""),this._addOption(s)}this.render(!0)},dhtmlXCombo.prototype._addOption=function(e){dOpt=new this._optionObject,this.optionsArr.push(dOpt),dOpt.setValue.apply(dOpt,[e]),this.redrawOptions()},dhtmlXCombo.prototype.getIndexByValue=function(e){for(var t=0;t<this.optionsArr.length;t++)if(this.optionsArr[t].value==e)return t;return-1},dhtmlXCombo.prototype.getSelectedValue=function(){return this._selOption?this._selOption.value:null},dhtmlXCombo.prototype.getComboText=function(){return this.DOMelem_input.value},dhtmlXCombo.prototype.setComboText=function(e){this.DOMelem_input.value=e},dhtmlXCombo.prototype.setComboValue=function(e){this.setComboText(e);for(var t=0;t<this.optionsArr.length;t++)if(this.optionsArr[t].data()[0]==e)return this.selectOption(t,null,!0);this.DOMelem_hidden_input.value=e},dhtmlXCombo.prototype.getActualValue=function(){return this.DOMelem_hidden_input.value},dhtmlXCombo.prototype.getSelectedText=function(){return this._selOption?this._selOption.text:""},dhtmlXCombo.prototype.getSelectedIndex=function(){for(var e=0;e<this.optionsArr.length;e++)if(this.optionsArr[e]==this._selOption)return e;return-1},dhtmlXCombo.prototype.setName=function(e){this.DOMelem_hidden_input.name=e,this.DOMelem_hidden_input2=e.replace(/(\]?)$/,"_new_value$1"),this.name=e},dhtmlXCombo.prototype.show=function(e){this.DOMelem.style.display=convertStringToBoolean(e)?"":"none"},dhtmlXCombo.prototype.destructor=function(){this.DOMParent.removeChild(this.DOMelem),this.DOMlist.parentNode.removeChild(this.DOMlist);var e=dhx_glbSelectAr;this.DOMParent=this.DOMlist=this.DOMelem=0;for(var t=this.DOMlist.combo=this.DOMelem.combo=0;t<e.length;t++)if(e[t]==this){e[t]=null,e.splice(t,1);break}},dhtmlXCombo.prototype._createSelf=function(e,t,s,i){if(-1!=s.toString().indexOf("%")){var r=this,n=parseInt(s)/100;window.setInterval(function(){if(e.parentNode){var t=e.parentNode.offsetWidth*n-2;0>t||t==r._lastTs||r.setSize(r._lastTs=t)}},500),s=parseInt(e.offsetWidth)}s=parseInt(s||100),this.ListPosition="Bottom",this.DOMParent=e,this._inID=null,this.name=t,this._selOption=null,this.optionsArr=[];var a=new this._optionObject;a.DrawHeader(this,t,s,i),this.DOMlist=document.createElement("DIV"),this.DOMlist.className="dhx_combo_list "+(dhtmlx.skin?dhtmlx.skin+"_list":""),this.DOMlist.style.width=s-(_isIE?0:0)+"px",(_isOpera||_isKHTML)&&(this.DOMlist.style.overflow="auto"),this.DOMlist.style.display="none",document.body.insertBefore(this.DOMlist,document.body.firstChild),_isIE&&(this.DOMlistF=document.createElement("IFRAME"),this.DOMlistF.style.border="0px",this.DOMlistF.className="dhx_combo_list",this.DOMlistF.style.width=s-(_isIE?0:0)+"px",this.DOMlistF.style.display="none",this.DOMlistF.src="javascript:false;",document.body.insertBefore(this.DOMlistF,document.body.firstChild)),this.DOMlist.combo=this.DOMelem.combo=this,this.DOMelem_input.onkeydown=this._onKey,this.DOMelem_input.onkeypress=this._onKeyF,this.DOMelem_input.onblur=this._onBlur,this.DOMelem.onclick=this._toggleSelect,this.DOMlist.onclick=this._selectOption,this.DOMlist.onmousedown=function(){this._skipBlur=!0},this.DOMlist.onkeydown=function(e){(e||event).cancelBubble=!0,this.combo.DOMelem_input.onkeydown(e)},this.DOMlist.onmouseover=this._listOver},dhtmlXCombo.prototype._listOver=function(e){e=e||event,e.cancelBubble=!0;var t=_isIE?event.srcElement:e.target,s=this.combo;if(t.parentNode==s.DOMlist){s._selOption&&s._selOption.deselect(),s._tempSel&&s._tempSel.deselect();for(var i=0;i<s.DOMlist.childNodes.length&&s.DOMlist.childNodes[i]!=t;i++);var r=s.optionsArr[i];s._tempSel=r,s._tempSel.select(),s._autoxml&&i+1==s._lastLength&&s._fetchOptions(i+1,s._lasttext||"")}},dhtmlXCombo.prototype._positList=function(){var e=this.getPosition(this.DOMelem);"Bottom"==this.ListPosition?(this.DOMlist.style.top=e[1]+this.DOMelem.offsetHeight-1+"px",this.DOMlist.style.left=e[0]+"px"):"Top"==this.ListPosition?(this.DOMlist.style.top=e[1]-this.DOMlist.offsetHeight+"px",this.DOMlist.style.left=e[0]+"px"):(this.DOMlist.style.top=e[1]+"px",this.DOMlist.style.left=e[0]+this.DOMelem.offsetWidth+"px")},dhtmlXCombo.prototype.getPosition=function(e,t){if(_isChrome){t||(t=document.body);for(var s=e,i=0,r=0;s&&s!=t;)i+=s.offsetLeft-s.scrollLeft,r+=s.offsetTop-s.scrollTop,s=s.offsetParent;return t==document.body&&(_isIE&&8>_isIE?(document.documentElement.scrollTop&&(r+=document.documentElement.scrollTop),document.documentElement.scrollLeft&&(i+=document.documentElement.scrollLeft)):_isFF||(i+=document.body.offsetLeft,r+=document.body.offsetTop)),[i,r]}var n=getOffset(e);return[n.left,n.top]},dhtmlXCombo.prototype._correctSelection=function(){if(""!=this.getComboText())for(var e=0;e<this.optionsArr.length;e++)if(!this.optionsArr[e].isHidden())return this.selectOption(e,!0,!1);this.unSelectOption()},dhtmlXCombo.prototype.selectNext=function(e){for(var t=this.getSelectedIndex()+e;this.optionsArr[t];){if(!this.optionsArr[t].isHidden())return this.selectOption(t,!1,!1);t+=e}},dhtmlXCombo.prototype._onKeyF=function(e){var t=this.parentNode.combo,s=e||event;return s.cancelBubble=!0,"13"==s.keyCode||"9"==s.keyCode?(t._confirmSelection(),t.closeAll()):"27"==s.keyCode?(t._resetSelection(),t.closeAll()):t._activeMode=!0,"13"==s.keyCode||"27"==s.keyCode?(t.callEvent("onKeyPressed",[s.keyCode]),!1):!0},dhtmlXCombo.prototype._onKey=function(e){var t=this.parentNode.combo;(e||event).cancelBubble=!0;var s=(e||event).keyCode;if(s>15&&19>s)return!0;if(27==s)return!0;if("block"==t.DOMlist.style.display||"13"==s||"9"==s||t._filter&&!t._filterAny||t.DOMelem.onclick(e||event),"13"!=s&&"9"!=s){if(window.setTimeout(function(){t._onKeyB(s)},1),"40"==s||"38"==s)return!1}else 9==s&&(t._confirmSelection(),t.closeAll(),(e||event).cancelBubble=!1)},dhtmlXCombo.prototype._onKeyB=function(e){if("40"==e){this.selectNext(1)}else if("38"==e)this.selectNext(-1);else{if(this.callEvent("onKeyPressed",[e]),this._filter)return this.filterSelf(8==e||46==e);for(var t=0;t<this.optionsArr.length;t++)if(this.optionsArr[t].data()[1]==this.DOMelem_input.value)return this.selectOption(t,!1,!1),!1;this.unSelectOption()}return!0},dhtmlXCombo.prototype._onBlur=function(){var e=this.parentNode._self;window.setTimeout(function(){return e.DOMlist._skipBlur?!(e.DOMlist._skipBlur=!1):(e._confirmSelection(),void e.callEvent("onBlur",[]))},100)},dhtmlXCombo.prototype.redrawOptions=function(){if(!this._skiprender){for(var e=this.DOMlist.childNodes.length-1;e>=0;e--)this.DOMlist.removeChild(this.DOMlist.childNodes[e]);for(e=0;e<this.optionsArr.length;e++)this.DOMlist.appendChild(this.optionsArr[e].render())}},dhtmlXCombo.prototype.loadXML=function(e,t){if(this._load=!0,this.callEvent("onXLS",[]),this._prs)for(var s=0;s<this._prs.length;s++)e+=[getUrlSymbol(e),escape(this._prs[s][0]),"=",escape(this._prs[s][1])].join("");if(this._xmlCache&&this._xmlCache[e])this._fillFromXML(this,null,null,null,this._xmlCache[e]),t&&t();else{var i=new dtmlXMLLoaderObject(this._fillFromXML,this,!0,!0);t&&(i.waitCall=t),i._cPath=e,i.loadXML(e)}},dhtmlXCombo.prototype.loadXMLString=function(e){var t=new dtmlXMLLoaderObject(this._fillFromXML,this,!0,!0);t.loadXMLString(e)},dhtmlXCombo.prototype._fillFromXML=function(e,t,s,i,r){e._xmlCache&&(e._xmlCache[r._cPath]=r);var n=r.getXMLTopNode("complete");if("complete"!=n.tagName)e._load=!1;else{var a=r.doXPath("//complete"),d=r.doXPath("//option"),o=!1;e.render(!1),a[0]&&a[0].getAttribute("add")?(e._lastLength+=d.length||1/0,o=!0):(e.clearAll(),e._lastLength=d.length,e._xml&&(d&&d.length?e._activeMode&&(e._positList(),e.DOMlist.style.display="block",_isIE&&e._IEFix(!0)):e.closeAll()));for(var l=0;l<d.length;l++){var h={};h.text=d[l].firstChild?d[l].firstChild.nodeValue:"";for(var _=0;_<d[l].attributes.length;_++){var c=d[l].attributes[_];c&&(h[c.nodeName]=c.nodeValue)}e._addOption(h)}e.render(1!=o||!!d.length),e._load&&e._load!==!0?e.loadXML(e._load):(e._load=!1,!e._lkmode&&e._filter&&e._correctSelection());var u=r.doXPath("//option[@selected]");u.length&&e.selectOption(e.getIndexByValue(u[0].getAttribute("value")),!1,!0),e.callEvent("onXLE",[])}},dhtmlXCombo.prototype.unSelectOption=function(){this._selOption&&this._selOption.deselect(),this._tempSel&&this._tempSel.deselect(),this._tempSel=this._selOption=null},dhtmlXCombo.prototype.confirmValue=function(){this._confirmSelection()},dhtmlXCombo.prototype._confirmSelection=function(e,t){if(0==arguments.length){var s=this.getOptionByLabel(this.DOMelem_input.value),e=s?s.value:this.DOMelem_input.value,t=null==s;if(e==this.getActualValue())return}this.DOMelem_input.focus(),this.DOMelem_hidden_input.value=e,this.DOMelem_hidden_input2.value=t?"true":"false",this.callEvent("onChange",[]),this._activeMode=!1},dhtmlXCombo.prototype._resetSelection=function(){var e=this.getOption(this.DOMelem_hidden_input.value);this.setComboValue(e?e.data()[0]:this.DOMelem_hidden_input.value),this.setComboText(e?e.data()[1]:this.DOMelem_hidden_input.value)},dhtmlXCombo.prototype.selectOption=function(e,t,s){arguments.length<3&&(s=!0),this.unSelectOption();var i=this.optionsArr[e];if(i){this._selOption=i,this._selOption.select();var r=this._selOption.content.offsetTop+this._selOption.content.offsetHeight-this.DOMlist.scrollTop-this.DOMlist.offsetHeight;r>0&&(this.DOMlist.scrollTop+=r),r=this.DOMlist.scrollTop-this._selOption.content.offsetTop,r>0&&(this.DOMlist.scrollTop-=r);var n=this._selOption.data();if(s&&(this.setComboText(n[1]),this._confirmSelection(n[0],!1),this._autoxml&&e+1==this._lastLength&&this._fetchOptions(e+1,this._lasttext||"")),t){var a=this.getComboText();a!=n[1]&&(this.setComboText(n[1]),dhtmlXRange(this.DOMelem_input,a.length+1,n[1].length))}else this.setComboText(n[1]);this._selOption.RedrawHeader(this),this.callEvent("onSelectionChange",[])}},dhtmlXCombo.prototype._selectOption=function(e){(e||event).cancelBubble=!0;for(var t=_isIE?event.srcElement:e.target,s=this.combo;!t._self;)if(t=t.parentNode,!t)return;for(var i=0;i<s.DOMlist.childNodes.length&&s.DOMlist.childNodes[i]!=t;i++);s.selectOption(i,!1,!0),s.closeAll(),s.callEvent("onBlur",[]),s._activeMode=!1},dhtmlXCombo.prototype.openSelect=function(){if(!this._disabled){if(this.closeAll(),this._positList(),this.DOMlist.style.display="block",this.callEvent("onOpen",[]),this._tempSel&&this._tempSel.deselect(),this._selOption&&this._selOption.select(),this._selOption){var e=this._selOption.content.offsetTop+this._selOption.content.offsetHeight-this.DOMlist.scrollTop-this.DOMlist.offsetHeight;e>0&&(this.DOMlist.scrollTop+=e),e=this.DOMlist.scrollTop-this._selOption.content.offsetTop,e>0&&(this.DOMlist.scrollTop-=e)}_isIE&&this._IEFix(!0),this.DOMelem_input.focus(),this._filter&&this.filterSelf()}},dhtmlXCombo.prototype._toggleSelect=function(e){var t=this.combo;"block"==t.DOMlist.style.display?t.closeAll():t.openSelect(),(e||event).cancelBubble=!0},dhtmlXCombo.prototype._fetchOptions=function(e,t){if(""==t)return this.closeAll(),this.clearAll();var s=this._xml+(-1!=this._xml.indexOf("?")?"&":"?")+"pos="+e+"&mask="+encodeURIComponent(t);this._lasttext=t,this._load?this._load=s:this.callEvent("onDynXLS",[t,e])&&this.loadXML(s)},dhtmlXCombo.prototype.filterSelf=function(e){var t=this.getComboText();this._xml&&(this._lkmode=e,this._fetchOptions(0,t));var s=RegExp("^"+t.replace(/([\[\]\{\}\(\)\+\*\\\?\.])/g,"\\$1"),"i");this.filterAny=!1;for(var i=0;i<this.optionsArr.length;i++){var r=s.test(this.optionsArr[i].content?this.optionsArr[i].data()[1]:this.optionsArr[i].text);this.filterAny|=r,this.optionsArr[i].hide(!r)}this.filterAny?("block"!=this.DOMlist.style.display&&this.openSelect(),_isIE&&this._IEFix(!0)):(this.closeAll(),this._activeMode=!0),e?this.unSelectOption():this._correctSelection()},dhtmlXCombo.prototype._IEFix=function(e){this.DOMlistF.style.display=e?"block":"none",this.DOMlistF.style.top=this.DOMlist.style.top,this.DOMlistF.style.left=this.DOMlist.style.left},dhtmlXCombo.prototype.closeAll=function(){if(window.dhx_glbSelectAr)for(var e=0;e<dhx_glbSelectAr.length;e++)"block"==dhx_glbSelectAr[e].DOMlist.style.display&&(dhx_glbSelectAr[e].DOMlist.style.display="none",_isIE&&dhx_glbSelectAr[e]._IEFix(!1)),dhx_glbSelectAr[e]._activeMode=!1},dhtmlXCombo_defaultOption=function(){this.init()},dhtmlXCombo_defaultOption.prototype.init=function(){this.value=null,this.text="",this.selected=!1,this.css=""},dhtmlXCombo_defaultOption.prototype.select=function(){this.content&&(this.content.className="dhx_selected_option"+(dhtmlx.skin?" combo_"+dhtmlx.skin+"_sel":""))},dhtmlXCombo_defaultOption.prototype.hide=function(e){this.render().style.display=e?"none":""},dhtmlXCombo_defaultOption.prototype.isHidden=function(){return"none"==this.render().style.display},dhtmlXCombo_defaultOption.prototype.deselect=function(){this.content&&this.render(),this.content.className=""},dhtmlXCombo_defaultOption.prototype.setValue=function(e){this.value=e.value||"",this.text=e.text||"",this.css=e.css||"",this.content=null},dhtmlXCombo_defaultOption.prototype.render=function(){return this.content||(this.content=document.createElement("DIV"),this.content._self=this,this.content.style.cssText="width:100%; overflow:hidden;"+this.css,(_isOpera||_isKHTML)&&(this.content.style.padding="2px 0px 2px 0px"),this.content.innerHTML=this.text,this._ctext=_isIE?this.content.innerText:this.content.textContent),this.content},dhtmlXCombo_defaultOption.prototype.data=function(){return this.content?[this.value,this._ctext?this._ctext:this.text]:void 0},dhtmlXCombo_defaultOption.prototype.DrawHeader=function(e,t,s,i){var r=document.createElement("DIV");r.style.width=s+"px",r.className="dhx_combo_box "+(dhtmlx.skin||""),r._self=e,e.DOMelem=r,this._DrawHeaderInput(e,t,s,i),this._DrawHeaderButton(e,t,s),e.DOMParent.appendChild(e.DOMelem)},dhtmlXCombo_defaultOption.prototype._DrawHeaderInput=function(e,t,s,i){var r=document.createElement("input");
r.setAttribute("autocomplete","off"),r.type="text",r.className="dhx_combo_input",i&&(r.tabIndex=i),r.style.width=s-19-("BackCompat"==document.compatMode?0:3)+"px",e.DOMelem.appendChild(r),e.DOMelem_input=r,r=document.createElement("input"),r.type="hidden",r.name=t,e.DOMelem.appendChild(r),e.DOMelem_hidden_input=r,r=document.createElement("input"),r.type="hidden",r.name=(t||"").replace(/(\]?)$/,"_new_value$1"),r.value="true",e.DOMelem.appendChild(r),e.DOMelem_hidden_input2=r},dhtmlXCombo_defaultOption.prototype._DrawHeaderButton=function(e){var t=document.createElement("img");t.className="dhx_combo_img",dhtmlx.image_path&&(dhx_globalImgPath=dhtmlx.image_path),t.src=(window.dhx_globalImgPath?dhx_globalImgPath:"")+"combo_select"+(dhtmlx.skin?"_"+dhtmlx.skin:"")+".gif",e.DOMelem.appendChild(t),e.DOMelem_button=t},dhtmlXCombo_defaultOption.prototype.RedrawHeader=function(){},dhtmlXCombo_optionTypes["default"]=dhtmlXCombo_defaultOption,dhtmlXCombo.prototype.dhx_Event=function(){this.dhx_SeverCatcherPath="",this.attachEvent=function(e,t,s){if(s=s||this,e="ev_"+e,!this[e]||!this[e].addEvent){var i=new this.eventCatcher(s);i.addEvent(this[e]),this[e]=i}return e+":"+this[e].addEvent(t)},this.callEvent=function(e,t){return this["ev_"+e]?this["ev_"+e].apply(this,t):!0},this.checkEvent=function(e){return this["ev_"+e]?!0:!1},this.eventCatcher=function(a){var b=[],c=a,e=function(e,t){var e=e.split(":"),s="",i="",r=e[1];"rpc"==e[1]&&(s='<?xml version="1.0"?><methodCall><methodName>'+e[2]+"</methodName><params>",i="</params></methodCall>",r=t);var n=function(){};return n},d=function(){if(b)var e=!0;for(var t=0;t<b.length;t++)if(null!=b[t])var s=b[t].apply(c,arguments),e=e&&s;return e};return d.addEvent=function(a){return"function"!=typeof a&&(a=a&&a.indexOf&&0==a.indexOf("server:")?new e(a,c.rpcServer):eval(a)),a?b.push(a)-1:!1},d.removeEvent=function(e){b[e]=null},d},this.detachEvent=function(e){if(0!=e){var t=e.split(":");this[t[0]].removeEvent(t[1])}}},function(){dhtmlx.extend_api("dhtmlXCombo",{_init:function(e){return e.image_path&&(dhx_globalImgPath=e.image_path),[e.parent,e.name,e.width||"100%",e.type,e.index]},filter:"filter_command",auto_height:"enableOptionAutoHeight",auto_position:"enableOptionAutoPositioning",auto_width:"enableOptionAutoWidth",xml:"loadXML",readonly:"readonly",items:"addOption"},{filter_command:function(e){"string"==typeof e?this.enableFilteringMode(!0,e):this.enableFilteringMode(e)}})}(),window.dhtmlXGridObject&&(dhtmlXGridObject.prototype._init_point_connector=dhtmlXGridObject.prototype._init_point,dhtmlXGridObject.prototype._init_point=function(){this._con_f_used=[].concat(this._con_f_used),dhtmlXGridObject.prototype._con_f_used=[];var e=function(e){return e=e.replace(/(\?|\&)connector[^\f]*/g,""),e+(-1!=e.indexOf("?")?"&":"?")+"connector=true"+(this.hdr.rows.length>0?"&dhx_no_header=1":"")},t=function(t){return e.call(this,t)+(this._connector_sorting||"")+(this._connector_filter||"")},s=function(e,s,i){return this._connector_sorting="&dhx_sort["+s+"]="+i,t.call(this,e)},i=function(e,s,i){for(var r=0;r<s.length;r++)s[r]="dhx_filter["+s[r]+"]="+encodeURIComponent(i[r]);return this._connector_filter="&"+s.join("&"),t.call(this,e)};this.attachEvent("onCollectValues",function(e){return this._con_f_used[e]?"object"==typeof this._con_f_used[e]?this._con_f_used[e]:!1:!0}),this.attachEvent("onDynXLS",function(){return this.xmlFileUrl=t.call(this,this.xmlFileUrl),!0}),this.attachEvent("onBeforeSorting",function(e,t,i){if("connector"==t){var r=this;return this.clearAndLoad(s.call(this,this.xmlFileUrl,e,i),function(){r.setSortImgState(!0,e,i)}),!1}return!0}),this.attachEvent("onFilterStart",function(e,t){return this._con_f_used.length?(this.clearAndLoad(i.call(this,this.xmlFileUrl,e,t)),!1):!0}),this.attachEvent("onXLE",function(e,t,s,i){}),this._init_point_connector&&this._init_point_connector()},dhtmlXGridObject.prototype._con_f_used=[],dhtmlXGridObject.prototype._in_header_connector_text_filter=function(e,t){return this._con_f_used[t]||(this._con_f_used[t]=1),this._in_header_text_filter(e,t)},dhtmlXGridObject.prototype._in_header_connector_select_filter=function(e,t){return this._con_f_used[t]||(this._con_f_used[t]=2),this._in_header_select_filter(e,t)},dhtmlXGridObject.prototype.load_connector=dhtmlXGridObject.prototype.load,dhtmlXGridObject.prototype.load=function(){if(!this._colls_loaded&&this.cellType){for(var e=[],t=0;t<this.cellType.length;t++)(0==this.cellType[t].indexOf("co")||2==this._con_f_used[t])&&e.push(t);e.length&&(arguments[0]+=(-1!=arguments[0].indexOf("?")?"&":"?")+"connector=true&dhx_colls="+e.join(","))}return this.load_connector.apply(this,arguments)},dhtmlXGridObject.prototype._parseHead_connector=dhtmlXGridObject.prototype._parseHead,dhtmlXGridObject.prototype._parseHead=function(){if(this._parseHead_connector.apply(this,arguments),!this._colls_loaded){for(var e=this.xmlLoader.doXPath("./coll_options",arguments[0]),t=0;t<e.length;t++){var s=e[t].getAttribute("for"),i=[],r=null;"combo"==this.cellType[s]?r=this.getColumnCombo(s):0==this.cellType[s].indexOf("co")&&(r=this.getCombo(s));for(var n=this.xmlLoader.doXPath("./item",e[t]),a=[],d=0;d<n.length;d++){var o=n[d].getAttribute("value");if(r){var l=n[d].getAttribute("label")||o;r.addOption?a.push([o,l]):r.put(o,l),i[i.length]=l}else i[i.length]=o}a.length&&r.addOption(a),this._con_f_used[1*s]&&(this._con_f_used[1*s]=i)}this._colls_loaded=!0}}),window.dataProcessor&&(dataProcessor.prototype.init_original=dataProcessor.prototype.init,dataProcessor.prototype.init=function(e){this.init_original(e),e._dataprocessor=this,this.setTransactionMode("POST",!0),this.serverProcessor+=(-1!=this.serverProcessor.indexOf("?")?"&":"?")+"editing=true"}),dhtmlxError.catchError("LoadXML",function(e,t,s){alert(s[0].responseText)});